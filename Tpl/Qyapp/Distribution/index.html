<include file="Common:header" />

<div id="myModal" class="modal fade" tabindex="-2" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"></div>
<script type="text/javascript">
	$(document).ready(function() {
		var cb1 = function(start, end, label) {  
			//console.log(start.toISOString(), end.toISOString(), label);
			//$('#select_0 input').val(start.format('YYYY/MM/DD'));
			$('#select_0 input').attr('value',start.format('YYYY/MM/DD'));
		}
		var cb2 = function(start, end, label) {
			//console.log(start.toISOString(), end.toISOString(), label);
			//$('#select_3 input').val(start.format('YYYY/MM/DD') + ' - ' + end.format('YYYY/MM/DD'));
			$('#select_3 input').attr('value',start.format('YYYY/MM/DD') + ' - ' + end.format('YYYY/MM/DD'));
		}

		var optionSet1 = {
			singleDatePicker: true,
			ranges: {
				'今天': [moment(), moment()],
				'昨天': [moment().subtract('days', 1), moment().subtract('days', 1)],
				'最近7天': [moment().subtract('days', 6), moment()],
				'最近30天': [moment().subtract('days', 29), moment()],
				'这个月': [moment().startOf('month'), moment().endOf('month')],
				'上个月': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
			},
			buttonClasses: ['btn btn-default'],
			applyClass: 'btn-small btn-primary',
			cancelClass: 'btn-small',
			format: 'YYYY/MM/DD',
			separator: ' to ',
			locale: {
				applyLabel: '确定',
				cancelLabel: '取消',
				fromLabel: '开始时间',
				toLabel: '结束时间',
				customRangeLabel: '自定义',
				daysOfWeek: ['日', '一', '二', '三', '四', '五', '六'],
				monthNames: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
				firstDay: 1
			}
		};
		var optionSet2 = {
			startDate: moment().subtract('days', 29),
			endDate: moment(),
			dateLimit: {
				days: 60
			},
			showDropdowns: true,
			showWeekNumbers: true,
			timePicker: true,
			timePickerIncrement: 1,
			timePicker12Hour: true,
			ranges: {
				'今天': [moment(), moment()],
				'昨天': [moment().subtract('days', 1), moment().subtract('days', 1)],
				'最近7天': [moment().subtract('days', 6), moment()],
				'最近30天': [moment().subtract('days', 29), moment()],
				'这个月': [moment().startOf('month'), moment().endOf('month')],
				'上个月': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
			},
			opens: 'right',
			buttonClasses: ['btn btn-default'],
			applyClass: 'btn-small btn-primary',
			cancelClass: 'btn-small',
			format: 'YYYY/MM/DD',
			separator: ' to ',
			locale: {
				applyLabel: '确定',
				cancelLabel: '取消',
				fromLabel: '开始时间',
				toLabel: '结束时间',
				customRangeLabel: '自定义',
				daysOfWeek: ['日', '一', '二', '三', '四', '五', '六'],
				monthNames: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
				firstDay: 1
			}
		};		
		//按天查询
		//$('#select_0 input').val(moment().format('YYYY/MM/DD'));
		$('#select_0').daterangepicker(optionSet1, cb1);
		//$('#select_0').on('apply.daterangepicker', function(ev, picker) {
		//   $('form').submit(); 
		//});		
		//按月查询select_1
		//按时间段查询
		//$('#select_3 input').val(moment().subtract('days', 29).format('YYYY/MM/DD') + ' - ' + moment().format('YYYY/MM/DD'));
		$('#select_3').daterangepicker(optionSet2, cb2);	
		//$('#select_3').on('apply.daterangepicker', function(ev, picker) {
		//   $('form').submit(); 
		//});
	});
</script>
 
    <section class="hbox stretch">
     <aside class="aside-md bg-white b-r" id="subNav">
		<include file="Distribution:navmenu" />
    </aside> 		       
        <aside>
            <section class="vbox">

                <header class="header bg-white b-b clearfix">
                    <form class="talbe-search" method="post" target="_self"  action="{lanrain::U('Distribution/index')}">
                         <div class="row m-t-sm">					
                            <div class="col-sm-4 m-b-xs">							
                                <div class="input-group">
                                    <div class="input-group-btn">
                                        <button class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
                                            <span class="dropdown-label" id="searchTypeTxt1">按用户名查询</span>
                                            <span class="caret"></span>
                                        </button>
                                       <ul class="dropdown-menu dropdown-select js_select_search" id="searchMenu">
                                             <li >
                                                <a href="javascript:void();">
                                                    <input type="radio" value="0" name="searchBy"/>按手机号查询
                                                </a>
                                            </li> 
                                            <li >
                                                <a href="javascript:void();">
                                                    <input type="radio" value="1" name="searchBy" />按用户名查询
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="input-group js_show_date js_show_date_0 " id="select_4" >
										<input type="text" class="form-control input-sm" name="username" id="searchUsername" value="" placeholder="请输入用户名"/>
										<input type="text" class="form-control input-sm" style="display:none" name="mobile" id="depart" value="" placeholder="请输入手机号" />									
										<span class="input-group-addon btn-sm" onclick="searchInfo();" id="clickSearch" style="cursor:pointer;"><i class="fa fa-search"></i></span>									
									</div>									
                                </div>
                            </div>
                        </div>
                       
                    </form>
					 <script>  
						function searchInfo(){
							//$('form').submit();
								var username = $('#searchUsername').val();
								var mobile = $('#depart').val();
								if(username&&mobile){
								if(username){
									$('#'+username+'').
								}
									
								}else{
									alert('请输入搜索内容');
								}
						}									
						$('#searchMenu li').each(function(){
						    $(this).click(function(){
							    if($(this).index() == 0){
								    $('#searchTypeTxt1').text('按手机号查询');
									$('#depart').css('display','block');
									$('#searchUsername').css('display','none');
								}else{
								    $('#searchTypeTxt1').text('按用户名查询');
									$('#searchUsername').css('display','block');
									$('#depart').css('display','none');																		
									
								}
								
							});
						
						});
                        </script>
                </header>
                <section class="scrollable wrapper w-f">
                    <section class="panel panel-default ">
                        <div class="table-responsive">
                            <table class="table table-hover m-b-none entity-view">
                                <thead>
                                    <tr>
                                        <th >ID</th>
                                        <th >姓名</th>
                                        <th >手机号码</th>
                                        <th >邮箱</th>
										<th >注册日期</th>
										<th >直接上级</th>
                                    </tr>
                                </thead>
                                <tbody id="mytable">
								<if condition="$data">
								<volist name="data" id="data">
                                        <tr onclick="userInfo({lanrain:$data.user_id});" id="{lanrain:$data.user_id}">
                                            <td>{lanrain:$data.user_id}</td>
                                            <td id="{lanrain:$data.user_name}">{lanrain:$data.user_name}</td>
											<td id="{lanrain:$data.mobile_phone}">{lanrain:$data.mobile_phone}</td>
                                            <td>{lanrain:$data.email}</td>
                                            <td>{lanrain:$data.reg_time|date="Y-m-d H:m:s",###}</td>
											<td>{lanrain:$data.parent_id}</td>
                                        </tr>
								</volist>
								<else/>
								<tr><td colspan='6' style='text-align: center'>暂无信息</td></tr>                            
								</if>								
                                 </tbody>
                            </table>
                        </div>
						<div id="addleader" class="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
						</div>
                    </section>
                </section>
                <footer class="footer bg-white b-t">
                    <div class="row text-center-xs">
                        <div class="col-md-6 hidden-sm">
                        </div>
                        <div class="col-md-6 col-sm-12 text-right text-center-xs">
                            {lanrain:$page}
                        </div>
                    </div>
                </footer>

            </section>
        </aside>
    </section>  

<section class="entity-panel hd" id="info">
</section>
		
<script type="text/javascript">
function userInfo(userId){
		$('#addleader').load("index.php?g=Qyapp&m=Distribution&a=userInfo&id="+userId, function(){
			 $('#addleader').modal();
			 if($('.modal-backdrop').length>0){
			     $('.modal-backdrop').remove();
			 }
		});		   
	}
$('#mytable111 tr').click(function(){
	$(this).each(function(){
        var userId = $(this).attr('id');
		if($('#user'+userId).length>0){
			var curId = $('#info').children().attr('id');			
		    if(curId == 'user'+userId){
				if($('.entity-panel').hasClass('hd')){
					$('.entity-panel').removeClass('hd');
				}else{
					$('.entity-panel').addClass('hd');
				}			    
			}else{
				$('#info').empty();   
				$('#info').load("index.php?g=Qyapp&m=Distribution&a=info&uid="+userId);
				$('.entity-panel').removeClass('hd');
				$('.entity-panel').css('right','0px');				    
			}
		}else{
		    $('#info').empty();   
			$('#info').load("index.php?g=Qyapp&m=Distribution&a=info&uid="+userId);
			$('.entity-panel').removeClass('hd');
			$('.entity-panel').css('right','0px');			    
		}

		
	});
	
});	
</script>		
	
<include file="Common:footer" />