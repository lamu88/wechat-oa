<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>进销存</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta content="" name="description"/>
<meta content="" name="author"/>
</head>
<link href="./Tpl/Qyapp/Erp/css/erp.css" rel="stylesheet" type="text/css" />
<!-- BEGIN GLOBAL MANDATORY STYLES -->
<link href="./Tpl/assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
<link href="./Tpl/assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css"/>
<link href="./Tpl/assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="./Tpl/assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
<link href="./Tpl/assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css"/>
<!-- END GLOBAL MANDATORY STYLES -->
<!-- BEGIN PAGE LEVEL STYLES -->
<link rel="stylesheet" type="text/css" href="./Tpl/assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.css"/>
<link rel="stylesheet" type="text/css" href="./Tpl/assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css"/>
<link rel="stylesheet" type="text/css" href="./Tpl/assets/global/plugins/jquery-tags-input/jquery.tagsinput.css"/>
<link rel="stylesheet" type="text/css" href="./Tpl/assets/global/plugins/bootstrap-markdown/css/bootstrap-markdown.min.css">
<link rel="stylesheet" type="text/css" href="./Tpl/assets/global/plugins/typeahead/typeahead.css">
<!-- END PAGE LEVEL STYLES -->
<!-- BEGIN THEME STYLES -->
<link href="./Tpl/assets/global/css/components.css" id="style_components" rel="stylesheet" type="text/css"/>
<link href="./Tpl/assets/admin/layout/css/layout.css" rel="stylesheet" type="text/css"/>
<link id="style_color" href="./Tpl/assets/admin/layout/css/themes/default.css" rel="stylesheet" type="text/css"/>
<link href="./Tpl/assets/admin/layout/css/custom.css" rel="stylesheet" type="text/css"/>

<!-- END THEME STYLES -->
<script src="./Tpl/static/scroll/dev/jquery-1.9.1.js"></script>		
<script language="javascript" type="text/javascript" src="./Lanrain/Lib/Widget/My97DatePickerBeta/My97DatePicker/WdatePicker.js"></script>
</head>
<style>
.promote{display:none;}
label{ margin-bottom:0;}
input[type=”button”], input[type=”submit”], input[type=”reset”] {
-webkit-appearance: none;
}
select{-webkit-appearance: none;}
.triangle_border_down{ 
    width:0; 
    height:0; 
    border-width:4px 4px 0; 
    border-style:solid; 
    border-color:#333 transparent transparent;/*灰 透明 透明 */ 
    position:relative; 
	left: 92%;
	top: 16px;
	z-index:123;
} 
</style>
<body>
<div class="form">
<input type="hidden" value="{lanrain:$goods.goods_id}" id="goods_id" name="goods_id" />
<div class="page-content-wrapper">
		<div class="page-content">
				<div class="row">
				<div class="col-md-12">
					<!-- BEGIN PORTLET-->
					<div class="portlet box green">
						<div class="portlet-title">
							<div class="caption">
								<i class="fa fa-gift"></i>添加商品
							</div>
						</div>
						<div class="portlet-body form">
							<form action="#" id="form-username" class="form-horizontal form-bordered">
								<div class="form-group">
									<label class="col-sm-3 control-label">所属分类</label>
									<div class="col-sm-4">
										<div class="input-group">
											<span class="input-group-addon">
											<i class="fa fa-user"></i>
											</span>
											<select id="one" name="cat_id" class="form-control">
                                              <option value="0">-----选择分类-----</option>
                                         <volist name="catelist" id="catelist">
                                              <option value="{lanrain:$catelist.cat_id}" <if condition="($catelist['cat_id'] eq $goods['cat_id'])" >selected="selected"</if> >
                                                {lanrain:$catelist.pre}{lanrain:$catelist.cat_name}
                                              </option>
                                        </volist>
                                            </select>
                                            <div class="triangle_border_down"> </div>
										</div>
										
									</div>
								</div>
								<div class="form-group">
										<label class="control-label col-md-3">商品条形码</label>
										<div class="col-md-4">
											<div class="input-group" style="text-align:left">
												<input type="text" value="{lanrain:$goods.goods_sn}" class="form-control" name="goods_sn" id="goods_sn" />
												<span class="input-group-btn">
												
												<input type="button" id="getbarcode" class="button btn green" value="生成条形码" />
												
												</span>
											</div>
											<div class="help-block">
												 <a id="img" style="display:none" href="" target="_blank">查看条形码</a>
											</div>
										</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label">商品名称</label>
									<div class="col-sm-4">
										<div class="input-group">
											<span class="input-group-addon">
											<i class="fa fa-cogs"></i>
											</span>
											<input type="text" value="{lanrain:$goods.goods_name}" class="form-control" name="goods_name" id="goods_name" />
										</div>
									</div>
								</div>
								<div class="form-group ">
									<label class="col-sm-3 control-label">商品售价</label>
									<div class="col-sm-4">
										<div class="input-group">
											<span class="input-group-addon">
											<i class="fa fa-check"></i>
											</span>
											<input type="tel" value="{lanrain:$goods.out_price}" class="form-control" name="out_price" id="out_price" />
										</div>
										
									</div>
								</div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">市场价</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                            <i class="fa fa-search"></i>
                                            </span>
                                            <input type="tel" value="{lanrain:$goods.market_price}"  id="market_price" class="form-control" name="market_price" />
                                        </div>
                                        <p class="help-block">
                                             默认市场价为售价的1.2倍</code>
                                        </p>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-4 control-label">商品进价</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                            <i class="fa fa-search"></i>
                                            </span>
                                            <input type="tel" value="" class="form-control" name="in_price" id="in_price" />
                                        </div>
                                        
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-4 control-label">入库数量</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                            <i class="fa fa-search"></i>
                                            </span>
                                            <input type="tel" value="" class="form-control" name="in_num" id="in_num"/>
                                        </div>
                                      	<p class="help-block">
                                             计重商品单位为千克</code>
                                        </p>  
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-4 control-label">商品重量</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                            <i class="fa fa-search"></i>
                                            </span>
                                            <input type="tel" value="{lanrain:$goods.weight}" class="form-control" name="weight" id="weight"/>
                                        </div>
                                        
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-4 control-label">商品单位</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                            <i class="fa fa-search"></i>
                                            </span>
                                            <input type="text" value="{lanrain:$goods.unit}" class="form-control" name="unit" id="unit" />
                                        </div>
                                        
                                    </div>
                                </div>
								<div class="form-group" id="liHeader">
									 <label class="col-sm-4 control-label">[产品图片]</label>
									<div id="addImg"></div>
									<a href="javascript:;" id="chooseImage"><img src="./Tpl/Qyapp/Announce/images/iconfont-zengjia.png" width="50px" height="50px"></a>
								<!-- <span class="pull-right"><img src="./Tpl/Qyapp/Task/images/iconfont-tianjia.png" width="20px"></span> -->
								
								</div>
                                <div class="form-group">
									<label class="col-md-2 control-label">会员优惠</label>
									<div class="col-md-2">
										<div class="input-group">
											<div class="icheck-inline">
												<label>
												<input name="ismemberprice" type="radio" value="1" class="icheck" <if condition="($goods.ismemberprice eq 1) || ($goods.goods_id eq '')">checked="checked"</if>/> 享受 </label>
												<label>
												<input name="ismemberprice" type="radio" value="0" class="icheck"  <if condition="($goods.ismemberprice eq 0) && ($goods.goods_id neq '')">checked="checked"</if>/> 不享受 </label>
											</div>
										</div>
									</div>
								</div>
                                    <div class="form-group">
															<label class="col-md-2 control-label">是否促销</label>
															<div class="col-md-2">
																<div class="input-group">
																	<div class="icheck-inline">
																		<label>
																		<input name="ispromote" id="ispromote1" class="ispromote icheck" type="radio" value="1" <if condition="$goods.ispromote eq 1">checked="checked"</if>/> 启动 </label>
																		<label>
																		<input name="ispromote"  id="ispromote2" class="ispromote icheck" type="radio" value="0" <if condition="($goods.ispromote eq 0) and ($goods.ispromote)">checked="checked"</if>/> 禁用 </label>
                                                                        <p class="promote">
                <label class="control-label">促&nbsp;&nbsp;销&nbsp;&nbsp;价：</label>
                <input type="tel" value="{lanrain:$goods.promote_price}" class="icheck" name="promote_price" id="promote_price" />
                <span>元 </span> </p>
              <p class="promote">
                <label class="control-label">开始时间：</label>
                <input type="text" readonly value="{lanrain:$goods.promote_start_date}" onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" class="icheck  text-input min-input" name="promote_start_date" id="promote_start_date" />
                <span> </span> </p>
              <p class="promote">
                <label class="control-label">结束时间：</label>
                <input type="text" readonly value="{lanrain:$goods.promote_end_date}" onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" class="icheck text-input min-input" name="promote_end_date" id="promote_end_date" />
                <span> </span> </p>
																	</div>
																</div>
															</div>
														</div>
								<div class="form-group">
										<label class="control-label col-md-3">商品介绍</label>
										<div class="col-md-9">
                                            <textarea style="height:100px;" name="goods_desc" id="goods_desc" class="form-control">{lanrain:$goods.goods_desc}</textarea>
											<span class="help-block">
											不超过200个汉字 </span>
										</div>
									</div>
							<div class="form-actions">
									<div class="row">
										<div class="col-md-offset-3 col-md-9">
										<a href="javascript:;"  id="buttonimg" class="btn green" style="width:100%;"><if condition="($goods.goods_id neq 0)">编辑<else/>添加</if></a>
                                      
									  <!-- <input type="submit"  id="button" style="width:100%;" class="btn green" value='<if condition="($goods.goods_id neq 0)">编辑<else/>添加</if>'/>
										-->
										</div>
									</div>
								</div>	
							
							
						</div>
					</div>
					<!-- END PORTLET-->
				</div>
			</div>
</div>
</div>
</div>
</body>
</html>
<script src="./Tpl/assets/global/scripts/metronic.js" type="text/javascript"></script>
<script src="./Tpl/assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="./Tpl/assets/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>
<script src="./Tpl/assets/admin/layout/scripts/demo.js" type="text/javascript"></script>
<script src="./Tpl/assets/admin/pages/scripts/form-samples.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
wx.config({
debug: false,
appId: '{lanrain:$jsssdk_info.appId}',
timestamp: {lanrain:$jsssdk_info.timestamp},
nonceStr: '{lanrain:$jsssdk_info.nonceStr}',
signature: '{lanrain:$jsssdk_info.signature}',
jsApiList: [
'checkJsApi',
'onMenuShareTimeline',
'onMenuShareAppMessage',
'onMenuShareQQ',
'onMenuShareWeibo',
'openCard',
'previewImage',
'chooseImage',
'uploadImage',
'downloadImage'
]
});
</script>

<script>

$('#chooseImage').click(function(){
	wx.chooseImage({
		success: function (res) {			
			var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片	
			$.each(localIds,function(k,v){
				var l = '';
				var num = Math.floor(Math.random()*999+1);
				l += '<div class="choose_pic"  id="appendsImg_'+num+'">';
				l +='<input type="hidden" value="'+v+'" name="pic'+num+'">';
				l += '<img id="img_'+num+'" src="'+v+'" width="35px" height="35px">';
				l += '<a href="javascript:;" onclick="delImg('+num+')">';
				l += '<img class="icon_reduce" src="./Tpl/Qyapp/Announce/images/iconfont-iconfontjian.png" width="15px" height="15px">';
				l += '</a></div>';
				$('#addImg').append(l);	
			});
		}
	});
});
</script>
<script>
function delImg(m){
	$('#appendsImg_'+m).remove();
}
</script>
<script>
    $(function(){ 
		e = $(".ispromote:checked").val();
		//alert(e);
		if(e==1) $(".promote").show();
        $(".ispromote").click (function(){
			if($(".ispromote").attr("checked")){
				$(".promote").show();
			}else{
				$(".promote").hide();
			}
		});
		$("#ispromote1").click(function (){
				$(".promote").show();
		})
		$("#getbarcode").click(function(){
		
			$.ajax({
				type: "post",  
				url:"{lanrain::U('wap_getbarcode',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id']))}",
				dataType:'json',
				success:function(json){
					if(json.code && json.imgsrc){
						alert("生成成功！");
						$("#goods_sn").val(json.code);
						$("#img").show();
						$("#img").attr("href",json.imgsrc);
					}else{
					
						alert("生成出错！");
					}
				}
			})
		})
		
		$("#buttonimg").click(function (){

			var goods_id= $('#goods_id').val();
			var cat_id = $('#one').val();
			var goods_sn = $('#goods_sn').val();
			var goods_name = $('#goods_name').val();
			var out_price = $('#out_price').val();
			var market_price = $("#market_price").val();
			var in_price = $('#in_price').val();		
			var in_num = $('#in_num').val();
			var weight = $('#weight').val();
			var unit = $('#unit').val();
			var ismemberprice = $('input[name="ismemberprice"]:checked').val();
			var ispromote = $('input[name="ispromote"]:checked').val();
			var promote_price = $('#promote_price').val();
			var promote_start_date = $('#promote_start_date').val();	
			var promote_end_date = $('#promote_end_date').val();
			var goods_desc = $('#goods_desc').val();
	
			$.ajax({
				type: "post",  
				url:"{lanrain::U('wap_goodsadd',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id']))}",
				dataType:'json',
			//	data:{'asd':'as'},
				data:{'goods_id':goods_id,'cat_id':cat_id,'goods_sn':goods_sn,'goods_name':goods_name,'out_price':out_price,'market_price':market_price,'in_price':in_price,'in_num':in_num,'weight':weight,'unit':unit,'ismemberprice':ismemberprice,'ispromote':ispromote,'promote_price':promote_price,'promote_start_date':promote_start_date,'promote_end_date':promote_end_date,'goods_desc':goods_desc},
				success:function(json){
					if(json==1){
						alert("保存成功");
						
						//window.location.href="index.php?g=Qyapp&m=Erp&a=wap_goods&token=$_GET['token']&wecha_id=$_GET['wecha_id']";
						window.location.href="{lanrain::U('wap_goods',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id']))}"
					}
					if(json==0){
						alert("保存失败");
					}
				}
			})
			
		})
    });
</script>