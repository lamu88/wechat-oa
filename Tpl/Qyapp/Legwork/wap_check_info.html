<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
    <title>外勤详情</title>
    <link rel="stylesheet" href="./Tpl/Qyapp/Legwork/css/style1.css">
    <link rel="stylesheet" href="./Tpl/Qyapp/Applyflow/css/date.css">
    <link rel="stylesheet" type="text/css" href="./Tpl/Qyapp/Applyflow/css/btm.css?v=<?php echo time();?>">	
<!-- <script src="./Tpl/Qyapp/Aftersale/js/layer.m/layer.m.js"></script>	 -->
</head>
<body class="bg1">
<!--header start-->
<!--header end-->
<!--sec02 start-->
<!--sec03-01 start-->
<section class="top" >
	<ul style="">
		<li style="width:25%;">
			<if condition="$user['pic']"><img src="{lanrain:$user.pic}" width="72px" height="72px" style="border-radius:10px;"><else/><img src="./Tpl/Qyapp/Applyflow/images/que.png" width="72px" height="72px" style="border-radius:10px;"></if>
		</li>
		<li style="width:55%;">
			<p class="top-p" style="font-size:24px;">{lanrain:$username}</p>
			<p class="top-p">职务:{lanrain:$user.position}</p>
			<p class="top-p">部门:{lanrain:$user.department}</p>		
		</li>
		<li style="width:20%;text-align:center;padding-top:10px;position:relative;"  tel="{lanrain:$user.mobile}"><!-- tel:123456789 -->
		    <a href="tel:{lanrain:$user.mobile}">
		    <img src="./Tpl/Qyapp/Applyflow/images/phone.png" width="50px" height="50px">
			</a>
		</li>		
	</ul>
</section>
<script src="./Tpl/Qyapp/Static/Js/jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="http://g.alicdn.com/ilw/ding/0.2.7/scripts/dingtalk.js"></script>
<script>
function tel(){
	dd.ready(function(){
		dd.biz.telephone.call({
			users: ['{lanrain:$user.userid}'], //默认选中的用户列表，工号；成功回调中应包含该信息
			corpId: 'dingf39f0ba524f7d2a3', //企业id
			onSuccess : function() {
			},
			onFail : function() {
			}
		});
	});
}
</script>
<!--sec03-01 end-->
<!--sec03-02 start-->
<section class="sec03-02">
    <div class="title">
        <ul>
<!--             <li>
                <div class="li-c"><div class="cc"><img src="./Tpl/Qyapp/Applyflow/images/04-01.png" width="20px" height="20px"><span style="word-wrap:break-word;">{lanrain:$info.name}</span><div class="clear"></div> </div> </div>
            </li>
            <li>
                <div class="li-c"><div class="cc"><img src="./Tpl/Qyapp/Applyflow/images/04-02.png" width="24px" height="24px"><span>{lanrain:$info.allmoney}元</span><div class="clear"></div> </div> </div>
            </li> -->

            <div class="clear"></div>
        </ul>
    </div>
    <!--------------------------->
    <!--sec02 start-->
    <section class="sec02-01">
        <ul>
			<if condition="$list neq ''">
				
            <li class="li2">
                <!--li-w start-->
                <div class="li-w">
                    <!--fl start-->
                    <div class="fl">
                        <div class="li-c">
                            <div class="fl-c">
                                <div class="icon">项目</div>
                            </div>
                        </div>
                    </div>
                    <!--fl end-->
                    <!--fr start-->
                    <div class="fr">
                        <div class="li-c">
                            <div class="fr-c">
                                <div class="ii"></div>
                                <div class="cc">
                                    <div class="c"><i><img src="./Tpl/Qyapp/Applyflow/images/sec02-01.png"></i><span>类型:</span><div class="input">{lanrain:$list.type}</div> </div>
                                    <div class="c"><i><img src="./Tpl/Qyapp/Applyflow/images/sec02-03.png"></i><span>时间:</span><div class="input">{lanrain:$list.checktime|date="Y-m-d H:i:s",###}</div> </div>
                                    <div class="c"><i><img src="./Tpl/Qyapp/Applyflow/images/sec02-04.png"></i><span>地点:</span><div class="input">{lanrain:$list.place}</div> </div>
									<if condition="$list['desc'] neq ''">
                                    <div class="c"><i><img src="./Tpl/Qyapp/Applyflow/images/sec02-05.png"></i><span>内容:</span><div class="input">{lanrain:$list.desc}</div>
                                    </div>
									</if>
									<if condition="$img neq ''">
                                    <div class="img">
											<volist name="img" id="img">
												<if condition="$img neq ''">
												<img src="{lanrain:$img}" width="30px" height="30px">	
												</if>												
											</volist>	
                                        <div class="clear"></div>
                                    </div>
									</if>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--fr end-->
                    <div class="clear"></div>
                </div>
                <!--li-w end-->
               <!--  <div class="add1"><img src="./Tpl/Qyapp/Applyflow/images/04-04.png"></div> -->
            </li>
			
			<else/>
			<p>
			该报销项目下无子报销项目!
			</p>	
			</if>			
        </ul>
    </section>
    <!--sec02 end-->
    <!--------------------------->
</section>
<!---sec03-02 end-->
<!--sec03-03 start-->
<section class="sec03-03">
    <article>

    </article>
</section>
<div class="sec03-bottom-top"></div>
<!-- 
	<if condition="$list['status'] eq 2">
		<div class="comment_row" id="control">
			<div id="menu" style="margin-left:0px;margin-right:2px;">
				<ul style="margin:0 auto;list-style-type:none;width:100%;height:100%;padding-left: 0;">
				<a href="{lanrain::U('wap_index',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id'],'status'=>1))}" ><li style="float:left;background:#de5045;"><div class="menu_li" >返回</div>
				</li></a>				
				<a href="{lanrain::U('wap_check',array('id'=>$_GET['id'],'token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id']))}" ><li style="float:right;background:#35aa47;"><div class="menu_li">签到</div></li></a>			
				</ul>
			</div>
		</div>
	</if>	
	-->
    <if condition="$status and ($status['status'] eq 0)">
	<div class="btm_comment" id="com2">
		<div class="comment_row" id="control">
			<div id="menu" style="margin-left:0px;margin-right:2px;">
				<ul style="margin:0 auto;list-style-type:none;width:100%;height:100%;padding-left: 0;">
				<a href="javascript:;" id="jujue"><li style="float:left;background:#de5045;"><div class="menu_li" >拒绝</div>
				</li></a>				
				<a href="javascript:;" id="tongyi"><li style="float:right;background:#35aa47;"><div class="menu_li">同意</div></li></a>			
				</ul>
			</div>
		</div>
		<div class="comment_row" style="display:none;" id="yes">
			<p style="text-align:left;padding-left:10px;float:left;">请输入拒绝理由(非必填)</p>
			<p style="float:right;"><!-- 手写输入: --><!-- <span onclick="shurujujue()"><img src="Tpl/Qyapp/Applyflow/images/iconfont-shuru.png" width="24px" height="24px"> --><!-- <input type="radio" name="type" value="0" checked="checked"/> --></span><!-- &nbsp;&nbsp;<span onclick="yuyinjujue()"><img src="Tpl/Qyapp/Applyflow/images/sec03-07.png" width="24px" height="24px"></span> --></p>		
			<div class="write" id="jujie_write_comment">				
				<textarea class="enter_font" type="text" value="" class="newimg info" id="reason1" name="name" style="width: 98%;height: 75px;background-color: #fff;border: 1px solid #ccc;border-radius: 3px;color: #999;margin-top: 10px;margin-bottom:10px;"></textarea> 
			</div>
			<div class="write" id="jujie_listice_comment">

				<div class="page-container">
					<div class="title">长按说话</div>
					<div class="icon">
						<!-- <img src="Tpl/Qyapp/Applyflow/images/mouth.png" class="mouth img_mouth"> -->
						<a href="javascript:;" id="record"><img src="Tpl/Qyapp/Applyflow/images/sec03-10.png" width="80px" height="80px" class="mouth img_mouth"></a>
						<a class="play img_play" href="javascript:playRecord()" style="display:none"><img src="Tpl/Qyapp/Applyflow/images/play.png"></a>
						<!-- <img src="Tpl/Qyapp/Applyflow/images/playlistice.gif" class="playgif img_recording" style="display:none"> -->
						<img src="Tpl/Qyapp/Applyflow/images/iconfont-yuyinshiting.png" class="playgif img_recording" style="display:none">
					</div>
					<!-- <div class="tips div_tips" >&nbsp;</div> -->
					<!-- <div class="btn">
						<a href="javascript:restartRecord()" class="gray div_start" style="font-size: 12px;color: #222;">开始录音</a>
						<a class="green div_stop" href="javascript:stopRecord()" style="display:none">停止录音</a>
					</div>
					<div class="bottomtext div_friendtxt" style="display:none">已保存，可分享</div> -->
				</div>
			
				<input type="hidden" name="jujie_listice">  
			</div>			
			<div id="menu" style="margin-left:0px;margin-right:2px;">
				<ul style="margin:0 auto;list-style-type:none;width:100%;height:100%;padding-left: 0;">
				<a href="javascript:;" id="queding1"><li style="float:left;background:#35aa47;"><div class="menu_li" >确定</div>
				</li></a> 				
				<a href="javascript:;" id="fanhui1"><li style="float:right;background:#de5045;"><div class="menu_li" >返回</div>
				</li></a>				
				</ul>
			</div>
		</div>	
		<div class="comment_row" style="display:none;height:20px;line-height:20px;" id="no">
		     <!-- <span style="text-align:left;padding-left:10px;float:left;">审批意见:</span> -->
			 请输入审批意见(非必填)
			 <span style="float:right;"><!-- 请选择：<span onclick="shurutongyi()"><img src="Tpl/Qyapp/Applyflow/images/iconfont-shuru.png" width="22px" height="22px"></span> --><!-- &nbsp;&nbsp;<span onclick="yuyintongyi()"><img src="Tpl/Qyapp/Applyflow/images/sec03-07.png" width="22px" height="22px"></span> --></span>
			<div class="write" id="tongyi_write_comment">
				<textarea class="enter_font" type="text" value="" class="newimg info" id="reason2" name="name" style="width: 98%;height: 75px;background-color: #fff;border: 1px solid #ccc;border-radius: 3px;color: #999;margin-top: 10px;margin-bottom:10px;"></textarea> 
			</div>
			<div class="write" id="tongyi_listice_comment">
			
					<div class="page-container">
						<!-- <div class="title">录制语音</div> -->
						<div class="icon">
							<img src="Tpl/Qyapp/Applyflow/images/sec03-10.png" width="80px" height="80px" class="mouth img_mouth">
							<a class="play img_play" href="javascript:playRecord()" style="display:none"><img src="Tpl/Qyapp/Applyflow/images/iconfont-yuyinshiting.png"><!-- <img src="Tpl/Qyapp/Applyflow/images/play.png"> --></a>
							<img src="Tpl/Qyapp/Applyflow/images/playlistice.gif" class="playgif img_recording" style="display:none">
						</div>
						<!-- <div class="tips div_tips" >&nbsp;</div> -->
						<div class="btn">
							<a href="javascript:restartRecord()" class="gray div_start" style="font-size: 12px;color: #222;">开始录音</a>
							<a class="green div_stop" href="javascript:stopRecord()" style="display:none">停止录音</a>
                        </div>
						<div class="bottomtext div_friendtxt" style="display:none">已保存，可分享</div>
					</div>  
					
				<input type="hidden" name="tongyi_listice"> 
			</div>			
			<div id="menu" style="margin-left:0px;margin-right:2px;">
				<ul style="margin:0 auto;list-style-type:none;width:100%;height:100%;padding-left: 0;">
				<a href="javascript:;" id="queding2"><li style="float:left;background:#35aa47;"><div class="menu_li" >确定</div>
				</li></a> 				
				<a href="javascript:;" id="fanhui2"><li style="float:right;background:#de5045;"><div class="menu_li" >返回</div>
				</li></a>				
				</ul>
			</div>
		</div>		
	</div>
</if>	
	<style>
	#menu{position:fixed;bottom:0px;width:95%;height:36px;line-height:36px;background:#fff;z-index:999;margin-left:3%;padding-bottom: 10px;}
	#menu ul li{float:left;width:49%;height:100%;text-align:center;position:relative;font-size:14px;border-radius: 3px;}
	#menu ul li .menu_li{position:absolute;top:0px;left:0px;z-index:20;width:100%;height:100%;color:#fff;}
	a{text-decoration:none;}
	</style>
	<input type="text" id="txt_serverID" style="display:none" />
	<input type="text" id="mylistice" name="listice" style="display:none" />
    <input type="hidden" id="token" value="<?php echo $_GET['token']?>"></input>
<script src="./Tpl/Qyapp/Applyflow/js/jquery.js"></script>
<script src="./Tpl/Qyapp/Applyflow/js/main.js"></script>
<script>
$('#jujie_listice_comment').css('display','none');
$('#tongyi_listice_comment').css('display','none');
$('.btm_comment').css('height','55px');
$('#jujue').on('click',function(){
$('.btm_comment').css('height','180px');
$('#jujie_write_comment').css('display','block');
$('#control').css('display','none');
$('#yes').css('display','block');
$('#no').css('display','none');
});
$('#tongyi').on('click',function(){
$('.btm_comment').css('height','180px');
$('#tongyi_write_comment').css('display','block');
$('#control').css('display','none');
$('#yes').css('display','none');
$('#no').css('display','block');
});
$('#fanhui1').on('click',function(){
$('.btm_comment').css('height','55px');
$('#control').css('display','block');
$('#yes').css('display','none');
$('#no').css('display','none');
});
$('#fanhui2').on('click',function(){
$('.btm_comment').css('height','55px');
$('#control').css('display','block');
$('#yes').css('display','none');
$('#no').css('display','none');
});
</script>
<script>
function shurujujue(){
   $('#jujie_write_comment').css('display','block');
   $('#jujie_listice_comment').css('display','none');
   $('.btm_comment').css('height','180px');
}
function yuyinjujue(){

    $('#jujie_write_comment').css('display','none');
   $('#jujie_listice_comment').css('display','block');
   $('.btm_comment').css('height','180px');
}
function shurutongyi(){
    $('#tongyi_write_comment').css('display','block');
    $('#tongyi_listice_comment').css('display','none');
	$('.btm_comment').css('height','180px');
}
function yuyintongyi(){
    $('#tongyi_write_comment').css('display','none');
    $('#tongyi_listice_comment').css('display','block');
	$('.btm_comment').css('height','180px');
}
</script>


<script>
//同意
$('#queding2').click(function(){
    var content = $('#reason2').val();
	var listice = '';
    if($('#mylistice').val()){
	    listice = $('#mylistice').val();
	}	
	//alert(listice);
	$.ajax({
			type: "post",  
			url:"{lanrain::U('wap_agree',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id'],'status'=>2,'a_id'=>$status['id']))}",
			data:{'content':content,'listice':listice},
			dataType:'json',
			//data:{'token':token,'wecha_id':wecha_id,'id':id,'status':status},
			success:function(json){
			    if(json==0){
				    alert('您已经审核过了');
					window.location.reload();
				}
				if(json==1){
				    alert('您同意了报销申请');
					//$('#com2').css('display','none');
					window.location.reload();
				}
				if(json==7){
					alert('审核失败或者您已经审核过了');
				}				
			}
		});
});

//拒绝
$('#queding1').click(function(){
    var content = $('#reason1').val();
	var listice = '';
    if($('#mylistice').val()){
	    listice = $('#mylistice').val();
	}	
	$.ajax({
			type: "post",  
			url:"{lanrain::U('wap_agree',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id'],'status'=>3,'a_id'=>$status['id']))}",
			data:{'content':content,'listice':listice},			
			dataType:'json',
			//data:{'token':token,'wecha_id':wecha_id,'id':id,'status':status},
			success:function(json){
			    //if(json==0){
				//    alert('您已经审核过了');
				//	window.location.reload();
				//}			
				if(json==1){
				    
				    alert('您拒绝了外勤申请');
					window.location.reload();
				}
				if(json==7){
					alert('审核失败或者您已经审核过了');
				}				
			}
		});
});
//取消
function closeLay(){
window.location.reload();
}
//发送理由
function submitLay(m,n){
	var token = "{lanrain::$_GET['token']}";
	var wecha_id = "{lanrain::$_GET['wecha_id']}";
	var content = $('#layContent').val();
	$.ajax({
		type: "post",  
		url:"{lanrain::U('wap_comment',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id']))}",
		dataType:'json',
		data:{'token':token,'wecha_id':wecha_id,'id':m,'status':n,'content':content},
		success:function(json){
			if(json==1){
				alert('修改成功');
				window.location.reload();
			}
			if(json==2){
				alert('修改失败');
				window.location.reload();
			}
			if(json==3){
				alert('发表成功');
				window.location.reload();
			}
			if(json==4){
				alert('发表失败');
				window.location.reload();
			}
		}
	});
}
</script>
<script type="text/javascript">

    //var play_time_ti;
    var is_playing = false;
    function playlistice(id) {
        is_playing = true;
        //play_time_ti = setInterval(function () {
        //    var tt = $('.div_tips').text().replace("s", "");
        //    var ss = tt * 1;
        //    $('.div_tips').text((ss > 1 ? ss - 1 : 0) + "s");
        //}, 1000);

        setTimeout(function () {
            is_playing = false;
            $(".img_recording").hide();
            $('.img_play').show();
            //$('.div_tips').text(listice_record_time * 1 + "s");

            //if (play_time_ti) {
           //     clearInterval(play_time_ti);
            //}

        }, listice_record_time * 1000);
        wx.playlistice({
            localId: id// 需要播放的音频的本地ID，由stopRecord接口获得
        });

    }

    function playlisticeByUser() {
        if (is_playing) return;

        playlistice(last_listice_localId);
    }
    function uploadlistice(localId) {
	    //alert(localId);
        wx.uploadlistice({
            localId: localId, // 需要上传的音频的本地ID，由stopRecord接口获得
            isShowProgressTips: 1, // 默认为1，显示进度提示
            success: function (res) {
                var serverId = res.serverId; // 返回音频的服务器端ID
                $("#txt_serverID").val(serverId);
				$("#mylistice").val(serverId);
				//alert($("#mylistice").val());
                //$("#div_friend").show();
                //$("#div_friendtxt").show();
				//wxShareDataArray[3] = serverId;
                //changeWeixinShareData();
            }
        });
    }

    var last_listice_localId;
    function onRecordDone(localId) {

        listice_record_time = Math.ceil(((new Date()).getTime() - listice_record_start) / 1000);
		//alert(listice_record_time+'aa');
        //$(".div_tips").text(listice_record_time * 1 + "s");
        last_listice_localId = localId;
		//alert(last_listice_localId+'bbbs');
        //wxShareDataArray[2] = listice_record_time * 1 + "\"";
        setTimeout(function () {
            uploadlistice(localId);
        }, 1000);

        playlistice(localId);

    }

    var isRecording = false;
    function startRecord() {
        if (isRecording) return;
        $(".img_mouth").hide();
        $(".div_start").hide();
        $('.img_play').hide();
        $(".img_recording").show();
        //$(".div_tips").show();
        //$(".div_tips").text("正在录音...");
        $(".div_stop").show();
        $(".div_friend").hide();
        $(".div_friendtxt").hide();
        isRecording = true;
        wx.onlisticeRecordEnd({
            // 录音时间超过一分钟没有停止的时候会执行 complete 回调
            complete: function (res) {
                var localId = res.localId;

                isRecording = false;
                onRecordDone(localId);
            }
        });


        listice_record_time = 0;
        listice_record_start = (new Date()).getTime();

        wx.startRecord({
            success: function () {
                isRecording = false;
                listice_record_start = (new Date()).getTime();
            },
            cancel: function () {
                isRecording = false;
            }
        });

    }


    function stopRecord() {
        isRecording = false;
		$('.img_recording').show();
		$('.img_play').show();
        //$(".div_stop").hide();
        $(".div_start").show();
        wx.stopRecord({
            success: function (res) {
                var localId = res.localId;
				//alert(localId);
                onRecordDone(localId);
				$('.img_recording').show();
				$('.img_play').show();
            }
        });
        //$(".img_recording").show();
        //$(".div_tips").show();
        //$(".div_tips").text("正在录音...");
        //$(".div_stop").show();		
		$('.img_recording').show();
		$('.img_play').show();		
    }

    function playRecord() {
        $(".img_recording").show();
        $('.img_play').hide();
        playlistice(last_listice_localId);
    }

    function restartRecord() {
        startRecord();
    }
	$('#record').mousedown(function(){
	    alert('aaa');
	});
	$('#record').mousedown(function(){
	    alert('bbb');
	});	
</script>
</body>
</html>