<include file="Common:header" />
	<link href="./Tpl/Qyapp/Static/Js/jstree/3.0.2/themes/default/style.min.css" rel="stylesheet">	
		<script src="./Tpl/Qyapp/Static/Js/jstree/3.0.2/jstree.min.js"></script>	
	<link rel="stylesheet" type="text/css" href="./Tpl/Qyapp/Static/Js/autocomplete/src/jquery.autocomplete.css">	
	<script type="text/javascript" src="./Tpl/Qyapp/Static/Js/autocomplete/src/jquery.autocomplete.js"></script>	
	<script src="./Tpl/Qyapp/Static/Js/autocomplete/test/test.js"></script>
	<link href="./Tpl/Qyapp/Static/Js/autocomplete/lib/google-code-prettify/prettify.css" type="text/css" rel="stylesheet" />
	<script type="text/javascript" src="./Tpl/Qyapp/Static/Js/autocomplete/lib/google-code-prettify/prettify.js"></script>
	<script type="text/javascript" src="./Tpl/Qyapp/Static/Js/autocomplete/lib/google-code-prettify/beautify.min.js"></script>
    <script type="text/javascript">
	$(document).ready(function(){
		selectAuto();	
	});
    </script>
<div id="myModal" class="modal fade" tabindex="-2" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"></div>
<script>
$(document).ready(function(){
	$('.b-light').click(function(){
		$('.b-light').removeClass('open');	
		$(this).addClass('open');
	}); 
});
</script>
<section class="hbox stretch">
<aside class="aside-md bg-white b-r" id="subNav">
<!-- 	<div class="wrapper b-b header"><b>微信外勤</b></div>
	<ul class="nav">
	
		 <li class="b-b b-light open"><a href="{lanrain::U('Legwork/manage',array('mid'=>$_GET['mid']))}"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>外勤管理</a></li>
		<li class="b-b b-light"><a href="{lanrain::U('Legwork/realtime',array('mid'=>$_GET['mid']))}"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>实时查岗</a></li>
		<li class="b-b b-light"><a href="{lanrain::U('Legwork/setting',array('mid'=>$_GET['mid']))}"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>设置</a></li>
		<li class="b-b b-light"><a href="{lanrain::U('Menu/menu',array('mid'=>$_GET['mid']))}"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>自定义菜单</a></li>
		<li class="b-b b-light"><a href="{lanrain::U('Appmsg/conf',array('mid'=>$_GET['mid']))}"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>应用管理</a></li>
		
	</ul> -->
	<include file="Legwork:navmenu" />
</aside>
<!--     <aside class="aside-md bg-white b-r" id="subNav">
        <div class="wrapper b-b header"><b>微信外勤</b></div>
        <ul class="nav">
		
			 <li class="b-b b-light open"><a href="{lanrain::U('Legwork/manage')}"  target="content"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>外勤管理</a></li>
			<li class="b-b b-light"><a href="{lanrain::U('Legwork/realtime')}"  target="content"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>实时查岗</a></li>
			<li class="b-b b-light"><a href="{lanrain::U('Legwork/setting')}"  target="content"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>设置</a></li>
			<li class="b-b b-light"><a href="{lanrain::U('Menu/menu',array('id'=>$_GET['id']))}" target="content"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>自定义菜单</a></li>
			<li class="b-b b-light"><a href="{lanrain::U('Appmsg/conf',array('id'=>$_GET['id']))}" target="content"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>应用管理</a></li>
            
        </ul>
    </aside> -->
	<aside>
            <section class="vbox">
                 <header class="header bg-white b-b clearfix">
                    <form class="talbe-search" method="post" target="_self" action="{lanrain::U('Legwork/index',array('mid'=>$_GET['mid']))}" id="form" target="_self">
                        <div class="row m-t-sm">					
                            <div class="col-sm-4 m-b-xs">							
                                <div class="input-group">
                                    <div class="input-group-btn">
                                        <button class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
                                            <span class="dropdown-label" id="searchTypeTxt1">按用户名查询</span>
                                            <span class="caret"></span>
                                        </button>
                                       <ul class="dropdown-menu dropdown-select js_select_search" id="searchMenu">
                                             <li >
                                                <a href="javascript:;" target="_self">
                                                    <input type="radio" value="0" name="searchBy"/>按部门名称查询
                                                </a>
                                            </li> 
                                            <li >
                                                <a href="javascript:;" target="_self">
                                                    <input type="radio" value="1" name="searchBy" />按用户名查询
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="input-group js_show_date js_show_date_0 " id="select_4" >
										<input type="text" class="form-control input-sm" name="username" id="searchUsername" value="{lanrain:$username}" placeholder="请输入用户名"/>
										<input type="text" class="form-control input-sm" style="display:none" name="departname" id="depart" value="{lanrain:$departname}" placeholder="请输入部门名称" onclick="openModel()"/>
										<input type="hidden" name="type" id="type" value="1">								
										<span class="input-group-addon btn-sm" onclick="searchInfo();" style="cursor:pointer;"><i class="fa fa-search"></i></span>									
									</div>									
									
                                </div> 
							
							<script>
							function searchInfo(){
								$('#form').submit();	
							}
							</script>
						<script>
							function openModel(){
								$('#depart').attr("value",'');
								$('#myModal').load("/index.php?g=Qyapp&m=Tree&a=myTree", function(){
									 $('#myModal').modal();
								});	
							}

							function cancel(){
								$('#depart').attr("value",'');
								$('#departId').attr("value",'');
								$('#myModal').modal('hide');
								$('#myModal').empty();
							}

							function guanbi(){
								$('#myModal').modal('hide');
								$('#myModal').empty();
							}
							function searchInfo(){
							    $('#form').submit();
							}
						</script>						
                        <script>  								
							$('#searchMenu li').each(function(){
								$(this).click(function(){
									if($(this).index() == 0){
										$('#searchTypeTxt1').text('按部门名称查询');
										$('#depart').css('display','block');
										$('#searchUsername').css('display','none');
										$('#searchUsername').attr('value','');
										$('#depart').attr('value','');
										$('#type').attr('value',0);									
									}else{
										$('#searchTypeTxt1').text('按用户名查询');
										$('#searchUsername').css('display','block');
										$('#depart').css('display','none');	
										$('#searchUsername').attr('value','');
										$('#depart').attr('value','');										
										$('#type').attr('value',1);										
										
									}
									
								});
							
							});
                        </script>	
                    </form>
                </header>
                <section class="scrollable  wrapper">
                    <section class="panel panel-default">
                         <div class="table-responsive">
                            <table class="table table-hover m-b-none entity-view">
                                <colgroup>
                                <col style="width:5%" />
                                <col style="width:20%" />
                                <col style="width:30%" />
                                <col style="width:15%" />
                                <col style="width:15%" />
                                </colgroup>						
                                <thead>
                                    <tr>
                                        <!-- <th>部门</th> -->
										<th>ID</th>
                                        <th>外勤人员</th>
                                        <th>所属部门</th>
                                        <th>职位</th>								
										<th>操作</th>
                                        <!-- <th>状态</th> -->
                                    </tr>
                                </thead>
                                <tbody id="mytable">
								<if condition="$arr">								
								<volist name="arr" id='vo'>
                                    <tr id="{lanrain:$vo.id}">
                                        <!-- <td class="nodata">{lanrain:$vo.id}</td> -->
                                        <td>{lanrain:$vo.id}</td>
                                        <!--<td> <if condition="$vo['creatime']">{lanrain:$vo.creatime|date="Y-m-d H:i",###}<else/>{lanrain:$vo.creatime} &nbsp;</if> </td>-->
										<td>{lanrain:$vo.name}</td>
                                        <td>{lanrain:$vo.department}</td>
										<if condition="!empty($vo['position'])">
                                        <td>{lanrain:$vo.position}</td>
										<else/>
										<td>无职位</td>
										</if>
										<td>
											<a href="{lanrain::U('Legwork/info',array('mid'=>$_GET['mid'],'id'=>$vo['id']))}" target="_self">
												<span class="dropdown-label" >查询</span>
											</a>
										</td>
                                      						
                                    </tr>
                                </volist> 
								<else/>
								<tr><td colspan='10' class="nodata">暂无信息</td></tr>                            
								</if>								
								</tbody>
                            </table>
                        </div>
					
                    </section>
                </section>
				<footer class="footer bg-white b-t">
                    <div class="row text-center-xs">
                        <div class="col-md-6 hidden-sm">
                            <p class="text-muted m-t">{lanrain:$page}</p>
                        </div>
                        <div class="col-md-6 col-sm-12 text-right text-center-xs">
                            <ul class="pagination pagination-sm m-t-sm m-b-none" data-pages-total="" data-page-current=""></ul>
                        </div>
                    </div>
                </footer>
            </section>	
	</aside>
	
      <!-- <iframe name="content" id="content" src="{lanrain::U('manage')}" frameborder="0" width="100%" height="100%" scrolling="no"></iframe> -->
</section>
<script type="text/javascript">	
	function selectAuto(){
		$.ajax({
			type:"POST",
			url:"index.php?g=Qyapp&m=Common&a=searchUsers",
			dataType:'json',
			success:function(json){
			var status = json.status;
			  if(status==1)
			  {
			    var users = json.data;			
					$('#searchUsername').AutoComplete({
						'data': users,
						'width':190,
						'listStyle': 'custom',
						'maxHeight': 240,
						'createItemHandler': function(index, data){
							var div = $("<div style='height:36px;padding-top:2px'></div>")
							var cell1 = $("<div style='display:table-cell;vertical-align:top;'></div>").appendTo(div);
							var cell1_1 = $("<img style='width:32px;height:32px;'></img>").attr('src', data.image).appendTo(cell1);
							var cell2 = $("<div style='display:table-cell;vertical-align:middle;padding-right:10px'></div>").appendTo(div);
							var cell2_1 = $("<div></div>").append(data.label).appendTo(cell2);
							var cell2_2 = $("<div style='vertical-align:top;'></div>").appendTo(cell2);
							return div;
						}
					});				
			  }
			  else
			  {
				  alert('你查找的用户不存在');
			  }
			}
		}); 
			
	}
	</script>
<div class="msgbox"></div>
<include file="Common:footer" />