<include file="Common:header" />
	<link href="./Tpl/Qyapp/Static/Js/jstree/3.0.2/themes/default/style.min.css" rel="stylesheet">	
	<link href="./Tpl/Qyapp/Static/Js/bootstrap/switch/docs/css/highlight.css" rel="stylesheet">		
    <link href="./Tpl/Qyapp/Static/Js/bootstrap/switch/dist/css/bootstrap3/bootstrap-switch.min.css" rel="stylesheet">	
	<link href="./Tpl/Qyapp/Static/Js/daterangepicker/daterangepicker-bs3.css" rel="stylesheet">		
	<script src="./Tpl/Qyapp/Static/Js/artTemplate/dist/template.js" type="text/javascript"></script>
	<script src="./Tpl/Qyapp/Static/Js/jstree/3.0.2/jstree.min.js"></script>	
	<script src="./Tpl/Qyapp/Static/Js/bootstrap/switch/docs/js/highlight.js" type="text/javascript"></script>	
	<script src="./Tpl/Qyapp/Static/Js/bootstrap/switch/dist/js/bootstrap-switch.min.js" type="text/javascript"></script>
	<script src="./Tpl/Qyapp/Static/Js/daterangepicker/moment.min.js" type="text/javascript"></script>
	<script src="./Tpl/Qyapp/Static/Js/daterangepicker/daterangepicker.js" type="text/javascript"></script>
<div id="myModal" class="modal fade" tabindex="-2" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"></div>
<script type="text/javascript">
	$(document).ready(function() {
		var cb1 = function(start, end, label) {  
			//console.log(start.toISOString(), end.toISOString(), label);
			//$('#select_0 input').val(start.format('YYYY/MM/DD'));
			$('#select_0 input').attr('value',start.format('YYYY/MM/DD'));
		}
		var cb2 = function(start, end, label) {
			//console.log(start.toISOString(), end.toISOString(), label);
			//$('#select_3 input').val(start.format('YYYY/MM/DD') + ' - ' + end.format('YYYY/MM/DD'));
			$('#select_3 input').attr('value',start.format('YYYY/MM/DD') + ' - ' + end.format('YYYY/MM/DD'));
		}

		var optionSet1 = {
			singleDatePicker: true,
			ranges: {
				'今天': [moment(), moment()],
				'昨天': [moment().subtract('days', 1), moment().subtract('days', 1)],
				'最近7天': [moment().subtract('days', 6), moment()],
				'最近30天': [moment().subtract('days', 29), moment()],
				'这个月': [moment().startOf('month'), moment().endOf('month')],
				'上个月': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
			},
			buttonClasses: ['btn btn-default'],
			applyClass: 'btn-small btn-primary',
			cancelClass: 'btn-small',
			format: 'YYYY/MM/DD',
			separator: ' to ',
			locale: {
				applyLabel: '确定',
				cancelLabel: '取消',
				fromLabel: '开始时间',
				toLabel: '结束时间',
				customRangeLabel: '自定义',
				daysOfWeek: ['日', '一', '二', '三', '四', '五', '六'],
				monthNames: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
				firstDay: 1
			}
		};
		var optionSet2 = {
			startDate: moment().subtract('days', 29),
			endDate: moment(),
			dateLimit: {
				days: 60
			},
			showDropdowns: true,
			showWeekNumbers: true,
			timePicker: true,
			timePickerIncrement: 1,
			timePicker12Hour: true,
			ranges: {
				'今天': [moment(), moment()],
				'昨天': [moment().subtract('days', 1), moment().subtract('days', 1)],
				'最近7天': [moment().subtract('days', 6), moment()],
				'最近30天': [moment().subtract('days', 29), moment()],
				'这个月': [moment().startOf('month'), moment().endOf('month')],
				'上个月': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
			},
			opens: 'right',
			buttonClasses: ['btn btn-default'],
			applyClass: 'btn-small btn-primary',
			cancelClass: 'btn-small',
			format: 'YYYY/MM/DD',
			separator: ' to ',
			locale: {
				applyLabel: '确定',
				cancelLabel: '取消',
				fromLabel: '开始时间',
				toLabel: '结束时间',
				customRangeLabel: '自定义',
				daysOfWeek: ['日', '一', '二', '三', '四', '五', '六'],
				monthNames: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
				firstDay: 1
			}
		};		
		//按天查询
		//$('#select_0 input').val(moment().format('YYYY/MM/DD'));
		$('#select_0').daterangepicker(optionSet1, cb1);
		//$('#select_0').on('apply.daterangepicker', function(ev, picker) {
		//   $('form').submit(); 
		//});		
		//按月查询select_1
		//按时间段查询
		//$('#select_3 input').val(moment().subtract('days', 29).format('YYYY/MM/DD') + ' - ' + moment().format('YYYY/MM/DD'));
		$('#select_3').daterangepicker(optionSet2, cb2);	
		//$('#select_3').on('apply.daterangepicker', function(ev, picker) {
		//   $('form').submit(); 
		//});
	});
</script>
 
    <section class="hbox stretch">
	<aside class="aside-md bg-white b-r" id="subNav">

		<include file="Legwork:navmenu" />
</aside>
        <aside>
            <section class="vbox">
                 <header class="header bg-white b-b clearfix">
                    <form class="talbe-search" method="post"  target="_self" action="">
                        <div class="row m-t-sm">					
                            <div class="col-sm-4 m-b-xs">							
                                <div class="input-group">
                                    <div class="input-group-btn">
                                        <button class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
                                            <span class="dropdown-label" id="searchTypeTxt1">按用户名查询</span>
                                            <span class="caret"></span>
                                        </button>
                                       <ul class="dropdown-menu dropdown-select js_select_search" id="searchMenu">
                                             <li >
                                                <a href="javascript:void();">
                                                    <input type="radio" value="0" name="searchBy"/>按部门名称查询
                                                </a>
                                            </li> 
                                            <li >
                                                <a href="javascript:void();">
                                                    <input type="radio" value="1" name="searchBy" />按用户名查询
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="input-group js_show_date js_show_date_0 " id="select_4" >
										<input type="text" class="form-control input-sm" name="username" id="searchUsername" value="{lanrain:$username}" placeholder="请输入用户名"/>
										<input type="text" class="form-control input-sm" style="display:none" name="department" id="searchDepartname" value="{lanrain:$departname}" placeholder="请输入部门名称" onclick="openModel()"/>									
										<span class="input-group-addon btn-sm" onclick="searchInfo();" id="clickSearch" style="cursor:pointer;"><i class="fa fa-search"></i></span>									
									</div>									
									
                                </div>
                            </div>
							<script>
							function openModel(){
								$('#searchDepartname').attr("value",'');
								$('#searchDepartname').attr("value",'');
								$('#myModal').load("/index.php?g=Qyapp&m=Tree&a=myTongji&mid={lanrain::$_GET['mid']}", function(){
									 $('#myModal').modal();
								});	
							}

							function cancel(){
								$('#depart').attr("value",'');
								$('#departId').attr("value",'');
								$('#myModal').modal('hide');
								$('#myModal').empty();
							}

							function guanbi(){
								$('#myModal').modal('hide');
								$('#myModal').empty();
							}

							</script>
														 
 
                        </div>
						
                        <input type="hidden" name="pageNumber" id="pageNumber" value="1" />
                        <input type="hidden" name="orderBy" id="orderBy" value="desc"/>
                        <input type="hidden" name="order" id="order" value="time" />
                        <script>  
						function searchInfo(){
						   $('form').submit();						   
						}									
						$('#searchMenu li').each(function(){
						    $(this).click(function(){
							    if($(this).index() == 0){
								    $('#searchTypeTxt1').text('按部门名称查询');
									$('#searchDepartname').css('display','block');
									$('#searchUsername').css('display','none');
								}else{
								    $('#searchTypeTxt1').text('按用户名查询');
									$('#searchUsername').css('display','block');
									$('#searchDepartname').css('display','none');																		
									
								}
								
							});
						
						});
                        </script>
                    </form>
                </header>
                <section class="scrollable  wrapper">
                    <section class="panel panel-default">
                         <div class="table-responsive">
                            <table class="table table-hover m-b-none entity-view">
                                <colgroup>
                                <col style="width:5%" />
                                <col style="width:20%" />
                                <col style="width:30%" />
                                <col style="width:15%" />
                                <col style="width:15%" />
                                </colgroup>						
                                <thead>
                                    <tr>
                                        <!-- <th>部门</th> -->
										<th>ID</th>
                                        <th>外勤人员</th>
                                        <th>所属部门</th>
                                        <th>职位</th>								
										<th>操作</th>
                                        <!-- <th>状态</th> -->
                                    </tr>
                                </thead>
                                <tbody id="mytable">
								<if condition="$arr">								
								<volist name="arr" id='vo'>
                                    <tr id="{lanrain:$vo.id}">
                                        <!-- <td class="nodata">{lanrain:$vo.id}</td> -->
                                        <td>{lanrain:$vo.id}</td>
                                        <!--<td> <if condition="$vo['creatime']">{lanrain:$vo.creatime|date="Y-m-d H:i",###}<else/>{lanrain:$vo.creatime} &nbsp;</if> </td>-->
										<td>{lanrain:$vo.name}</td>
                                        <td>{lanrain:$vo.department}</td>
										<if condition="!empty($vo['position'])">
                                        <td>{lanrain:$vo.position}</td>
										<else/>
										<td>无职位</td>
										</if>
										<td>
											<a href="{lanrain::U('Legwork/info',array('mid'=>$_GET['mid'],'id'=>$vo['id']))}" target="_self">
												<span class="dropdown-label" >查询</span>
											</a>
										</td>
                                      						
                                    </tr>
                                </volist> 
								<else/>
								<tr><td colspan='10' class="nodata">暂无信息</td></tr>                            
								</if>								
								</tbody>
                            </table>
                        </div>
					
                    </section>
                </section>
				<footer class="footer bg-white b-t">
                    <div class="row text-center-xs">
                        <div class="col-md-6 hidden-sm">
                            <p class="text-muted m-t">{lanrain:$page}</p>
                        </div>
                        <div class="col-md-6 col-sm-12 text-right text-center-xs">
                            <ul class="pagination pagination-sm m-t-sm m-b-none" data-pages-total="" data-page-current=""></ul>
                        </div>
                    </div>
                </footer>
            </section>
        </aside>
    </section> 					
<include file="Common:footer" />