<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script>var SITEURL='';</script>
<title>微易科技</title>
<link href="./Tpl/Qyapp/Home/js/style.css" rel="stylesheet" type="text/css" />
<link href="./Tpl/Qyapp/Home/js/stylet.css" rel="stylesheet" type="text/css" />
<script src="./Tpl/Qyapp/Static/Js/jquery-1.9.1.min.js" type="text/javascript"></script>
<script type="text/javascript" src="./Tpl/Qyapp/Home/js/main.js"></script>
<script type="text/javascript" src="./Tpl/Qyapp/Home/js/common.js"></script>
<script src="./Tpl/static/artDialog/jquery.artDialog.js?skin=default"></script>
<script src="./Tpl/static/artDialog/plugins/iframeTools.js"></script>
<link rel="stylesheet" href="./Tpl/static/kindeditor/themes/default/default.css" />
<link rel="stylesheet" href="./Tpl/static/kindeditor/plugins/code/prettify.css" />
<script src="./Tpl/static/kindeditor/kindeditor.js" type="text/javascript"></script>
<script src="./Tpl/static/kindeditor/lang/zh_CN.js" type="text/javascript"></script>
<script src="./Tpl/static/kindeditor/plugins/code/prettify.js" type="text/javascript"></script>
<!-- <script type="text/javascript" src="./Tpl/Apps/Home/Js/jQuery-1.8.3.js"></script> -->
<script type="text/javascript" src="./Tpl/Qyapp/Home/js/jQueryUI.js"></script>
<!-- <script src="./Tpl/Apps/Upyun/Js/upyun.js"></script> -->
<script src="./Tpl/Qyapp/Home/js/jscolor.js" type="text/javascript"></script>
</head>
<body>
<style type="text/css">
.plug-menu {
width:36px;
height:36px;
border-radius:36px;
-moz-box-shadow:0 0 0 4px #FFFFFF, 0 2px 5px 4px rgba(0, 0, 0, 0.25);
-webkit-box-shadow:0 0 0 4px #FFFFFF, 0 2px 5px 4px rgba(0, 0, 0, 0.25);
box-shadow:0 0 0 4px #FFFFFF, 0 2px 5px 4px rgba(0, 0, 0, 0.25);
background-color: FF0000;
position:relative
}
.plug-menu span {
display: block;
width:28px;
height:28px;
background: url(tpl/Apps/Home/Images/plugmenu.png) no-repeat;
background-size: 28px 28px;
text-indent: -999px;
position:absolute;
top:4px;
left:4px;
overflow: hidden;
}
.ddcolor{background:#eee;}
</style>
<div class="content" style="width:95%; background:none;border:none;margin:10px 0 30px 10px;">
<ul id="tags">
  <li class="selectTag"><a href="{lanrain::U('Apps/Home/plugmenu')}">底部菜单分类设置</a> </li>
  <li ><a href="{lanrain::U('Apps/Catemenu/styleSet')}">底部菜单风格选择</a> </li>
  <div class="clr"></div>
</ul>
<div id="msgWrap" style="background:#eee;">
<form action="" method="post" enctype="multipart/form-data">
<table class="ListProduct" border="0" cellSpacing="0" cellPadding="0" width="100%">
<tbody>
<tr class="ddcolor">
<td width="60"><div class="plug-menu" id="plugmenucolor" style="background-color:{lanrain:$homeInfo.plugmenucolor}"><span class="close"></span></div></td>
<td width="140"><strong>请选择快捷菜单的颜色：</strong></td>
<td width="95"><input type="text" name="plugmenucolor" id="themeStyle" value="{lanrain:$homeInfo.plugmenucolor}" class="px color" style="width: 55px; background-image: none; background-color:{lanrain:$homeInfo.plugmenucolor}; color: rgb(255, 255, 255);" onblur="document.getElementById('plugmenucolor').style.backgroundColor=document.getElementById('themeStyle').value;"></td>
<td width="536">请在手机上查看效果！</td>

</tr>

                    <tr style="background:#fff;">
<td width="60"> </td>
<td><strong>设置页面版权：</strong></td>
 
<td colspan="2"><textarea class="px" style="width:550px; height:35px" name="copyright">{lanrain:$homeInfo.copyright}</textarea><br>例如：© 2001-2013 某某版权所有 </td>

</tr>
</tbody>
</table>
<table class="ListProduct" id="listTable" border="0" cellSpacing="0" cellPadding="0" width="100%">
		<thead>
				<tr>
					<th style=" width:200px;">菜单名称</th>
					<th style=" width:30px;">顺序</th>
					<th>图标地址(100X100像素的透明png图标)</th>
					<th>外链地址</th>
					<th style=" width:30px;"  >显隐</th>
					<th style=" width:70px;" class="norightborder">操作</th>
				</tr>
		</thead>
<script type="text/JavaScript">var i=0;</script>

	
<volist name='arr' id='v'>





<tr class="hover">
	<td>
		<input type="hidden" value="0" name="ps[{lanrain:$v.id}][pid]"/>
		<input type="hidden" class="key_type" value="1" name="ps[{lanrain:$v.id}][type]">
		<input class="px" type="text" style="width:100px;" required="" value="{lanrain:$v.name}" name="ps[{lanrain:$v.id}][name]" />
				<a class="green add" href="javascript:void(0)" rel="{lanrain:$v.id}">添加子菜单</a>
	</td>
	<td><input class="px" type="text" style="width:50px;" value="{lanrain:$v.orders}" name="ps[{lanrain:$v.id}][orders]" /></td>
	<td>
		<input class="px"  style="width:160px;" type="text" value="{lanrain:$v.picurl}" id="{lanrain:$v.id}" name="ps[{lanrain:$v.id}][picurl]" readonly />	
		<a  href="###" style="margin-top:3px;margin-left:5px;" onclick="upyunPicUpload('{lanrain:$v.id}',700,420,'{lanrain:$token}')" class="ke-button-common ">
			<input type="button" class="ke-button-common ke-button" value="上传">
		</a>
		<a href="###" onclick="viewImg('{lanrain:$v.id}')" style="margin-top: 3px;margin-left: 5px;" class="ke-button-common">
			<input type="button" class="ke-button-common ke-button" value="预览">
		</a>
		
	</td>
	<td>
		<input class="px" type="text" value="{lanrain:$v.url}" name="ps[{lanrain:$v.id}][url]"  id="link_{lanrain:$v.id}"/>
		<a  href="###" style="margin-top:3px;margin-left:5px;" onclick="addLink('link_{lanrain:$v.id}',0)" class="ke-button-common ">
			<input type="button" class="ke-button-common ke-button" value="从功能库添加">
		</a>
	</td>
		<td><input class="checkbox" type="checkbox" value="1" name="ps[{lanrain:$v.id}][display]" <if condition="$v['display'] eq 1" > checked="true" </if> />
	</td>
	<td><a class="green" href="{lanrain::U('Home/del_zhu',array('id'=>$v['id'],'token'=>$token))}">删除</a>
	</td>
</tr>




		<volist name='data[$v["id"]]' id='vo' key='k'>
				<tr class="hover">
					<td class="td25">
						<input type="hidden" value="{lanrain:$v.id}" name="ps[{lanrain:$vo.id}][pid]"/>
						<input type="hidden" class="key_type" value="1" name="ps[{lanrain:$vo.id}][type]">
						<div class="board"><input class="px" type="text" style="width:100px;" required="" value="{lanrain:$vo.name}" name="ps[{lanrain:$vo.id}][name]" /></div>
					</td>
					<td>
						<input class="px" type="text" style="width:50px;" value="{lanrain:$vo.orders}" name="ps[{lanrain:$vo.id}][orders]" />
					</td>
					<td>
						<input class="px"  style="width:160px;" type="text" name="ps[{lanrain:$vo.id}][picurl]" id="{lanrain:$vo.id}" value="{lanrain:$vo.picurl}" readonly  />
						<a  href="###" style="margin-top:3px;margin-left:5px;" onclick="upyunPicUpload('{lanrain:$vo.id}',700,420,'{lanrain:$token}')" class="ke-button-common ">
							<input type="button" class="ke-button-common ke-button" value="上传">
						</a>
						<a href="###" onclick="viewImg('{lanrain:$vo.id}')" style="margin-top: 3px;margin-left: 5px;" class="ke-button-common">
							<input type="button" class="ke-button-common ke-button" value="预览">
						</a>
					</td>
					<td>
						<input class="px" type="text" value="{lanrain:$vo.url}" name="ps[{lanrain:$vo.id}][url]" id="links_{lanrain:$vo.id}" />
						<a  href="###" style="margin-top:3px;margin-left:5px;" onclick="addLink('links_{lanrain:$vo.id}',0)" class="ke-button-common ">
							<input type="button" class="ke-button-common ke-button" value="从功能库添加">
						</a>
					</td>
					<td><input class="checkbox" type="checkbox" value="1"  name="ps[{lanrain:$vo.id}][display]" <if condition="$vo['display'] eq 1" > checked="true" </if> /></td>
					<td><a class="green" href="{lanrain::U('Home/del_zi',array('zid'=>$vo['id'],'token'=>$token))}">删除</a></td>
				</tr>
				</volist>
		</volist>
	<tbody id="subnav_1" ></tbody>
	 <tr class="hover"><td colspan="7" class="norightborder"><div><a href="javascript:void(0)" class="btnGrayS btn" id="add_menu"><i class="icon-plus"></i>添加主菜单</a></div></td></tr>
	 <tr style="background:#fff;"> <td colspan="7" class="norightborder"><div class="fixsel"><button type="submit" name="batchsubmit" value="true" class="btnGreen vm"><strong>保存</strong></button></div></td></tr>
</table>
</form>
<script type="text/JavaScript">
function app(obj) {
var inputs = obj.parentNode.parentNode.getElementsByTagName('input');
for(var i = 0; i < inputs.length; i++) {
if(inputs[i].name == 'newname[]') {
inputs[i].value = obj.options[obj.options.selectedIndex].innerHTML;
} else if(inputs[i].name == 'newurl[]') {
inputs[i].value = obj.value;
}
}
}


function addtouser(obj, type) {

document.getElementById("ss"+type).value =obj.getAttribute('user');
 
}

function changpic(objj,typee){
 document.getElementById("showpica"+typee).src =objj.value;
document.getElementById("showpicb"+typee).src =objj.value;
}
function addsuicaitouser(obj, type) {

document.getElementById("pic"+type).value =obj.getAttribute('src');
document.getElementById("showpica"+type).src =obj.getAttribute('src');
document.getElementById("showpicb"+type).src =obj.getAttribute('src');

 
}

 
</script>



	<script type="text/javascript">
$().ready(function () {
 var $add_menu = $("#add_menu");
 var $add_zmenu = $("a.add");
 var $menu_index = 0;


$add_menu.live('click',function (e) {
	 e.preventDefault();
	 $menu_index++;
	 var _menuPtrtmp = '<tr class="hover">'
+ ' <td>'
+ '  <input name="new[name][' + $menu_index + ']" class="px" type="text" style="width:100px;" /></td>'
+ ' <td>'
+ '<input name="new[orders][' + $menu_index + ']" class="px" type="text" style="width:50px;" value="0" /></td>'
+ ' <td>'
+ ' <input id="' + $menu_index + '" name="new[picurl][' + $menu_index + ']" class="px" style="width:160px;" type="text" readonly="readonly" />'
+ '<a  href="###" style="margin-top:3px;margin-left:5px;" onclick="upyunPicUpload('+"'"+ $menu_index + "'" +',700,420,' + "'{lanrain:$token}'" + ')" class="ke-button-common "><input type="button" class="ke-button-common ke-button" value="上传"></a><a href="###" onclick="viewImg('+"'"+ $menu_index + "'" +')" style="margin-top: 3px;margin-left: 5px;" class="ke-button-common"><input type="button" class="ke-button-common ke-button" value="预览"></a>'
+ '  <input type="hidden" name="new[pid][' + $menu_index + ']" value="{pid}" />'
+ '  <input type="hidden" name="new[type][' + $menu_index + ']" class="key_type" value="1" /></td>'
+ ' <td>'
+ '  <input type="text" name="new[url][' + $menu_index + ']" class="px" type="text"  id="' + 'link_' + $menu_index + '" />'
+ '  <a  href="###" style="margin-top:3px;margin-left:5px;" onclick="addLink('+"'"+ 'link_' + $menu_index + "'" +',0)" class="ke-button-common "><input type="button" class="ke-button-common ke-button" value="从功能库添加"></a>'
+ ' </td>'
+ ' <td>'
+ '  <input type="checkbox" name="new[display][' + $menu_index + ']" type="text" value="1" checked /></td>'
+ ' <td><a href="javascript:void(0)" class="del">删除</a></td>'
+ '</tr> ';
	 $("#listTable").append(_menuPtrtmp.replace("{pid}", 0));
 })
$add_zmenu.click(function myfunction() {
	 var $pid = $(this).attr("rel");
	 var $thistr = $(this).parent().parent();
	 var next = $thistr.nextAll("tr");
	 $menu_index++;
	 var _menuPtrtmp = '<tr class="hover">'
+ ' <td>'
+ '  <div class="board"><input name="new[name][' + $menu_index + ']" class="px" type="text" style="width:100px;" /></td>'
+ ' <td>'
+ '<input name="new[orders][' + $menu_index + ']" class="px" type="text" style="width:50px;" value="0" /></td>'
+ ' <td>'
+ ' <input id="' + $menu_index + '"  name="new[picurl][' + $menu_index + ']" class="px" style="width:160px;" type="text" readonly="readonly" />'
+ '<a  href="###" style="margin-top:3px;margin-left:5px;" onclick="upyunPicUpload('+"'"+ $menu_index + "'" +',700,420,' + "'{lanrain:$token}'" + ')" class="ke-button-common "><input type="button" class="ke-button-common ke-button" value="上传"></a><a href="###" onclick="viewImg('+"'"+ $menu_index + "'" +')" style="margin-top: 3px;margin-left: 5px;" class="ke-button-common"><input type="button" class="ke-button-common ke-button" value="预览"></a>'
+ '  <input type="hidden" name="new[pid][' + $menu_index + ']" value="{pid}" />'
+ '  <input type="hidden" name="new[type][' + $menu_index + ']" class="key_type" value="1" /></td>'
+ ' <td>'
+ '  <input type="text" name="new[url][' + $menu_index + ']" class="px" type="text" id="' + 'links_' + $menu_index + '" />'
+ '  <a  href="###" style="margin-top:3px;margin-left:5px;" onclick="addLink('+"'"+ 'links_' + $menu_index + "'" +',0)" class="ke-button-common "><input type="button" class="ke-button-common ke-button" value="从功能库添加"></a>'
+ ' </td>'
+ ' <td>'
+ '  <input type="checkbox" name="new[display][' + $menu_index + ']" type="text" value="1" checked /></td>'
+ ' <td><a href="javascript:void(0)" class="del">删除</a></td>'
+ '</tr> ';
	 var tp = _menuPtrtmp.replace("{pid}", $pid).replace("{z}", "<i class='board'></i>  ");
	 if (next.length > 0) {
		 next.first().before(tp);

	 } else {
		 $("#listTable").append(tp);
	 }


 });
 $("#listTable .del").live("click", (function () {
	 $(this).parents("tr").remove();
 }));
 $("input.type").live("change", function () {
	 var $this = $(this);
	 var $val = $this.val();
	 var $nex = $this.nextAll("input.key_type");
	 var re = /^((http|https|ftp):\/\/)?(\w(\:\w)?@)?([0-9a-z_-]+\.)*?([a-z0-9-]+\.[a-z]{2,6}(\.[a-z]{2})?(\:[0-9]{2,6})?)((\/[^?#<>\/\\*":]*)+(\?[^#]*)?(#.*)?)?$/i;
	 if (re.test($val)) { $nex.val(2) } else { $nex.val(1) };
 });
 $("#create_menu").click(function () {
	 var $idsCheck = $("#listTable :checkbox");
	 var $isnew = false;
	 $idsCheck.each(function () {
		 var $hidden_name = $(this).parents("tr").find("input[type=hidden]").attr("name");
		 if ($hidden_name.indexOf("new") >= 0) $isnew = true; return;
	 });
	 if ($isnew) {
		 G.ui.tips.info("当前页面存在有保存菜单 请保存后生成!")
	 } else {
		 var $p = 0;
		 var $z = 0;
		 var $ftr = $("#listTable .ptr");
		 $ftr.each(function (k, v) {
			 if ($p > 3) return false;
			 if ($z > 5) return false;
			 $z = 0;
			 var $this = $(this);
			 if ($this.find("input[type='checkbox']:checked").length > 0) {
				 $p++;
				 $this.nextUntil(".ptr").each(function () {
					 if ($(this).find("input[type='checkbox']:checked").length > 0) {
						 $z++;
					 }
				 });
				 if ($z == 0 && k == $ftr.length) {
					 $this.nextAll(".ztr").each(function () {
						 if ($(this).find("input[type='checkbox']:checked").length > 0) {
							 $z++;
						 }
					 });
				 }
			 }

		 });
		 if ($p > 3) { G.ui.tips.info("1级菜单最多只能开启3个"); return false };
		 if ($z > 5) { G.ui.tips.info("2级菜单最多只能开启5个"); return false };
		 $.get('/wechat/createmenu/aid/' + $('#aid').val(), {}, function (data) {
			 alert(data.error);
		 }, 'json');


	 }



 });

});
</script>	
	<div style="clear:both;"></div>
</div>
</body>
</html>