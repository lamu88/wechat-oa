<include file="Common:header" />
<link rel="stylesheet" href="./Tpl/Qyapp/Static/Js/jrating/jquery/jRating.jquery.css" type="text/css" />
<script src="./Tpl/Qyapp/Static/Js/Highcharts/4.0.3/js/highcharts.js" type="text/javascript"></script>
<script src="./Tpl/Qyapp/Static/Js/Highcharts/4.0.3/js/modules/exporting.js" type="text/javascript"></script>
<script type="text/javascript" src="./Tpl/Qyapp/Static/Js/jrating/jquery/jRating.jquery.js"></script>
<style>
   dev.hidden{display:none}
   #container{min-height:500px;margin:0px}
</style>
<section class="hbox stretch">
<aside class="aside-md bg-white b-r" id="subNav">
<!-- 	<div class="wrapper b-b header"><b>调研</b></div>
	<ul class="nav">
		<li class="b-b b-light open">
			<a href="{lanrain::U('Research/index',array('mid'=>$_GET['mid']))}" target="_self"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>问卷管理</a>
		</li>
		<li class="b-b b-light"><a href="{lanrain::U('Menu/menu',array('mid'=>$_GET['mid']))}"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>自定义菜单</a></li>
		<li class="b-b b-light">
			<a href="{lanrain::U('Appmsg/conf',array('mid'=>$_GET['mid']))}"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>应用管理</a>
		</li>
		
	</ul> -->
	<include file="Research:navmenu" />	
</aside>
<aside>
<section class="vbox">
<header class="header bg-white b-b clearfix">
    <form class="talbe-search" method="post" target="_self" action="{lanrain::U('Research/analysis',array('mid'=>$_GET['mid'],'id'=>$data['id']))}">
        <div class="row m-t-sm">
            <div class="col-sm-12 m-b-xs">
<!--                 <div class="btn-group">
                    <a data-toggle="dropdown" class="btn btn-sm btn-default dropdown-toggle">
                        <span class="dropdown-label">基本图表</span>
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu dropdown-select dropdown-select-50" data-change="submit" style="max-height:300px;overflow-y:auto">
						<li>
							<a href="javascript:;"><input type="radio" name="post" value="0" />1.单选</a>
						</li>

						<li>
							<a href="javascript:;"><input type="radio" name="post" value="1" />2.多选</a>
						</li>

						<li>
							<a href="javascript:;"><input type="radio" name="post" value="2" />3.打分</a>
						</li>

						<li>
							<a href="javascript:;"><input type="radio" name="post" value="3" />4.清空</a>
						</li>

						 <li>
							<a href="javascript:;"><input type="radio" name="post" value="4" />5.问答</a>
						</li>

                    </ul>
                </div> -->
				 <div class="btn-group">
					 <a class="btn btn-sm btn-default m-l" href="{lanrain::U('Research/analysisInfo',array('mid'=>$_GET['mid'],'id'=>$pid))}" target="_self">
					<i class="fa fa-plus m-r-xs"></i>
						答卷详情
					</a>                          
				</div>			
                <a class="text-muted pull-right m-t pointer" href="javascript:history.go(-1);" title="返回"><i class="fa fa-reply"></i></a>
            </div>
        </div>
    </form>
</header>
<section class="scrollable  wrapper">
<form class="form-horizontal form-validate" method="post" target="_self"  data-ignore="[]" action="">
<div class="alert alert-warning errorContainer hd">
    <h5><i class="fa fa-bell-o m-r-xs"></i><b>以下信息填写有误,请重新填写!</b>
    </h5>

    <div class="errorLabelContainer m-l-md"></div>
</div>
<section class="panel panel-default">
<div class="panel-body">
<div class="tab-content">
            <volist name="data" key="k" id="info">
             <if condition="$info['type'] eq 1">
            <div data-typeId="0" class="js_select_box m-t">
                <div class="panel panel-default">
                    <div class="col-sm-12 m-t">
                        <span>{lanrain:$k}、</span>{lanrain:$info.p_description}（单选题）
                    </div>
                    <div class="form-group" id="container{lanrain:$info.id}"></div>
                </div>
                <div class="panel panel-default">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                               <th>序号</th>							
                                <th>答案选项</th>
                                <th class="th-sortable" data-sort-name="depart">人数</th>
                                <th class="th-sortable" data-sort-name="number">占比</th>
                            </tr>
                            </thead>
                            <tbody>
							    <volist name="info.table" id="vo">
                                <tr>
								    <td>{lanrain:$vo.number}</td>
                                    <td>{lanrain:$vo.option_title}</td>
                                    <td>{lanrain:$vo.nums}</td>
                                    <td>{lanrain:$vo.rate}</td>
                                </tr>
								</volist>
                                <td colspan="4">
                                调研总人数:<span class="m-l">{lanrain:$info.total}</span>
                            </td>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

			<elseif condition="$info['type'] eq 2"/>
            <div data-typeId="0" class="js_select_box m-t">
                <div class="panel panel-default">
                    <div class="col-sm-12 m-t">
                        <span>{lanrain:$k}、</span>{lanrain:$info.p_description}（多选题）
                    </div>
                    <div class="form-group" id="container{lanrain:$info.id}"></div>
                </div>
                <div class="panel panel-default">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                               <th>序号</th>							
                                <th>答案选项</th>
                                <th class="th-sortable" data-sort-name="depart">人数</th>
                                <th class="th-sortable" data-sort-name="number">占比</th>
                            </tr>
                            </thead>
                            <tbody>
							    <volist name="info.table" id="vo">
                                <tr>
								    <td>{lanrain:$vo.number}</td>
                                    <td>{lanrain:$vo.option_title}</td>
                                    <td>{lanrain:$vo.nums}</td>
                                    <td>{lanrain:$vo.rate}</td>
                                </tr>
								</volist>
                                <td colspan="4">
                                调研总人数:<span class="m-l">{lanrain:$info.total}</span>
                            </td>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

			
			<elseif condition="$info['type'] eq 3"/>
            <div data-typeId="0" class="js_select_box m-t">
                <div class="panel panel-default">
                    <div class="col-sm-12 m-t">
                        <span>{lanrain:$k}、</span>{lanrain:$info.p_description}（评分题）
                    </div>
                    <div class="form-group" id="container{lanrain:$info.id}">&nbsp;</div>
                </div>
                <div class="panel panel-default">
                    <div class="table-responsive">
                        <table class="table table-hover">
							<colgroup>
							<col style="width:10%" />
							<col style="width:50%" />
							<col style="width:15%" />
							<col style="width:25%" />
							<!-- <col style="width:15%" />
							<col style="width:15%" /> -->
							</colgroup>						
                            <thead>
                            <tr>
							   <th>编号</th>
                               <th>选项</th>							
                               <th>评分图</th>
                               <th>综合评分</th>
                               <!-- <th>调研人数</th> -->
                               <!-- <th>占比</th>	 -->						   
                            </tr>
                            </thead>
                            <tbody>							
							    <volist name="info.table" id="vo">
                                <tr>
								    <td>{lanrain:$vo.option_number}</td>
                                    <td>{lanrain:$vo.option_title}</td>
                                    <td id="id_{lanrain:$info.id}_{lanrain:$vo.option_number}" data-average="{lanrain:$vo.rate}"></td>	
                                    <td>{lanrain:$vo.rate}</td>									
                                    <!-- <td>{lanrain:$vo.nums}</td> -->
                                    <!-- <td>{lanrain:$vo.rate}</td> -->
                                </tr>
								</volist>
                                <td colspan="4">
                                调研总人数:<span class="m-l">{lanrain:$info.total}</span>
                            </td>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
	
			
			<elseif condition="$info['type'] eq 4"/>
            <div data-typeId="0" class="js_select_box m-t">
                <div class="panel panel-default">
                    <div class="col-sm-12 m-t">
                        <span>{lanrain:$k}、</span>{lanrain:$info.p_description}（填空题）
                    </div>
                    <div class="form-group" id="container{lanrain:$info.id}">&nbsp;</div>
                </div>
                <div class="panel panel-default">
                    <div class="table-responsive">
                        <table class="table table-hover">
							<colgroup>
							<col style="width:10%" />
							<col style="width:90%" />
							</colgroup>						
                            <thead>
                            <tr>
							   <th>编号</th>
                               <th>填空内容</th>													   
                            </tr>
                            </thead>
                            <tbody>							
							    <volist name="info.table" id="vo">
                                <tr>
								    <td>{lanrain:$vo.number}</td>
                                    <td>{lanrain:$vo.answer}</td>
                                </tr>
								</volist>
                                <td colspan="4">
                                调研总人数:<span class="m-l" style="margin-right:30px;">{lanrain:$info.total}</span>查看更多填空内容请
								<a href="{lanrain::U('detail',array('type'=>'4','pid'=>$info['id']))}">
								<span class="m-l" style="color:red">点击这里</span>
								</a>
                                </td>
                                <td colspan="4">
                                
                                </td>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

			
			<elseif condition="$info['type'] eq 5"/>
            <div data-typeId="0" class="js_select_box m-t">
                <div class="panel panel-default">
                    <div class="col-sm-12 m-t">
                        <span>{lanrain:$k}、</span>{lanrain:$info.p_description}（简答题）
                    </div>
                    <div class="form-group" id="container{lanrain:$info.id}">&nbsp;</div>
                </div>
                <div class="panel panel-default">
                    <div class="table-responsive">
                        <table class="table table-hover">
							<colgroup>
							<col style="width:10%" />
							<col style="width:90%" />
							</colgroup>						
                            <thead>
                            <tr>
							   <th>编号</th>
                               <th>填空内容</th>													   
                            </tr>
                            </thead>
                            <tbody>							
							    <volist name="info.table" id="vo">
                                <tr>
								    <td>{lanrain:$vo.number}</td>
                                    <td>{lanrain:$vo.answer}</td>
                                </tr>
								</volist>
                                <td colspan="4">
                                调研总人数:<span class="m-l" style="margin-right:30px;">{lanrain:$info.total}</span>查看更多填空内容请
								<a href="{lanrain::U('detail',array('type'=>'5','pid'=>$info['id']))}">
								<span class="m-l" style="color:red">点击这里</span>
								</a>
                                </td>
                                <td colspan="4">
                                
                                </td>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            </if>			
			</volist>
				

</div>
</div>
</div>
</section>
</form>
</section>
</section>
</aside>
</section>


<script>
 var rId = "{lanrain:$id}";
$.ajax({
	type:"POST",
	url:"index.php?g=Qyapp&m=Research&a=getData&mid={lanrain::$_GET['mid']}&id="+rId,
	data:"id="+rId,
	dataType:'json',
	success:function(json){
	
	     json = eval(json);  
		 for(var i=0; i<json.length; i++)  
		 {  
			var type = json[i].type;
			var optionId = json[i].id;			
			if(type == 1){
				var data = json[i].data;		
				var title = json[i].title;	
				var datetime = json[i].datetime;					
				var chartId = 'container'+optionId;			
			    var categories = json[i].categories;
				var colors = Highcharts.getOptions().colors,  //颜色
				categories = categories,
				name = title+'统计分析',  //底部信息
				data = data;

				function setChart(name, categories, data, color) { 
				chart.xAxis[0].setCategories(categories, false);
				chart.series[0].remove(false);
				chart.addSeries({
					name: name,
					data: data,
					color: color || 'white'
				}, false);
				chart.redraw();
				}

				$('#'+chartId).highcharts({  
					chart: {
						width:950,
						height:400,		
						type:'pie',
						renderTo: chartId
					},
					title: {  //主标题
						text: title
					},
					subtitle: {  //子标题
						text: '统计日期：'+datetime
					},
					xAxis: {  //x轴
						categories: categories
					},
					yAxis: {  //y轴
						title: {
							text: '调研人数'
						}
					},
					tooltip: {  //提示信息
						formatter: function() {
							var point = this.point,
								//s = this.x +':<b>'+ this.y +'% market share</b><br>';
								//s = this.x +':<br><b>'+ this.y +'% </b>选择了该选项<br>';
								//s = '<b>'+ this.y +'% </b>用户选择了<br>“'+this.x +'”<br>';
								s = '<b>'+this.y +'% </b>';
							return s;
						}
					},
					series: [{
						name: name,
						data: data,
						color: 'white'
					}],
					exporting: {
						enabled: false
					}
				})
				.highcharts(); // return chart	
			}else if(type == 2){
				var data = json[i].data;		
				var title = json[i].title;	
				var datetime = json[i].datetime;				
				var chartId = 'container'+json[i].id;			
			    var categories = json[i].categories;
                var colors = Highcharts.getOptions().colors,  //颜色
				categories = categories,
				name = '统计报表',  //底部信息
				data = data;		
						
				function setChart(name, categories, data, color) {
				chart.xAxis[0].setCategories(categories, false);
				chart.series[0].remove(false);
				chart.addSeries({
					name: name,
					data: data,
					color: color || 'white'
				}, false);
				chart.redraw();
				}
                //alert(chartId);
				$('#'+chartId).highcharts({
					chart: {
						width:950,
						height:400,		
						type: 'column',
						renderTo: chartId
					},
					title: {  //主标题
						text: title
					},
					subtitle: {  //子标题
						text: '统计日期：'+datetime
					},
					xAxis: {  //x轴
						categories: categories
					},
					yAxis: {  //y轴
						title: {
							text: '调研人数'
						}
					},
					plotOptions: {
						column: {
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
								color: colors[0],
								style: {
									fontWeight: 'bold'
								},
								formatter: function() {
									return this.y +'%';
								}
							}
						}
					},					
					tooltip: {
						formatter: function() {
							var point = this.point,
								s = this.y +'% </b>选择了<br>“'+this.x +'”<br><b>';
							return s;
						}
					},
					series: [{
						name: name,
						data: data
					}],
					exporting: {
						enabled: false
					}
				})
				.highcharts(); // return chart
			
			}else if(type = 3){			
				var myScore = json[i].score;	
                for(var n=0;n<myScore.length;n++){
				    var scoreId = 'id_'+optionId+'_'+myScore[n].option_number;
					$('#'+scoreId).jRating({
						bigStarsPath : './Tpl/Qyapp/Static/Js/jrating/jquery/icons/stars.png', // path of the icon stars.png
						step:false,
						length : 5,
						isDisabled:true, // if true, user could not rate				
						rateInfosX : 0, // relative position in X axis of the info box when mouseover				
						rateMax : 5, // maximal rate - integer from 0 to 9999 (or more)				
						decimalLength:1,				
					});				    
				}				
				
			
			}			
		 } 

	}
});
</script>

<include file="Common:footer" />                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      