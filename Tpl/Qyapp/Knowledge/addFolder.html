<include file="Common:header" />
	<link href="./Tpl/Qyapp/Static/Js/jstree/3.0.2/themes/default/style.min.css" rel="stylesheet">	
	<link href="./Tpl/Qyapp/Static/Js/jrating/jquery/jRating.jquery.css" rel="stylesheet">		
	<link href="./Tpl/Qyapp/Static/Js/bootstrap/switch/docs/css/highlight.css" rel="stylesheet">		
    <link href="./Tpl/Qyapp/Static/Js/bootstrap/switch/dist/css/bootstrap3/bootstrap-switch.min.css" rel="stylesheet">	
	<link href="./Tpl/Qyapp/Static/Js/daterangepicker/daterangepicker-bs3.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="./Tpl/Qyapp/Static/Js/clockpicker/dist/bootstrap-clockpicker.min.css">
    <link rel="stylesheet" type="text/css" href="./Tpl/Qyapp/Static/Js/clockpicker/assets/github.min.css">			
	<script src="./Tpl/Qyapp/Static/Js/artTemplate/dist/template.js" type="text/javascript"></script>
	<script src="./Tpl/Qyapp/Static/Js/jstree/3.0.2/jstree.min.js"></script>	
	<script src="./Tpl/Qyapp/Static/Js/bootstrap/switch/docs/js/highlight.js" type="text/javascript"></script>	
	<script src="./Tpl/Qyapp/Static/Js/bootstrap/switch/dist/js/bootstrap-switch.min.js" type="text/javascript"></script>
	<script src="./Tpl/Qyapp/Static/Js/daterangepicker/moment.min.js" type="text/javascript"></script>
	<script src="./Tpl/Qyapp/Static/Js/daterangepicker/daterangepicker.js" type="text/javascript"></script>
	<script src="./Tpl/Qyapp/Static/Js/clockpicker/dist/bootstrap-clockpicker.min.js" type="text/javascript"></script>
	<script src="./Tpl/Qyapp/Static/Js/jrating/jquery/jRating.jquery.min.js" type="text/javascript"></script>	
	<script charset="utf-8" src="./Tpl/Qyapp/Index/index/kindeditor/kindeditor-min.js"></script>
	<script charset="utf-8" src="./Tpl/Qyapp/Index/index/kindeditor/lang/zh_CN.js"></script>
	<link rel="stylesheet" href="./Tpl/Qyapp/Index/index/kindeditor/themes/default/default.css" />

<div class="modal fade" id="preModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	   <div class="modal-dialog">
		  <div class="modal-content">
			 <div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title" id="myModalLabel">图标预览</h4>
			 </div>
			 <div class="modal-body">
				<div class="row" style="padding-bottom:15px;">
				    <div class="col-md-12" style="margin:0 auto;" align="center">
					        <img src="" width="128px" height="128px" id="preicon">
					</div>							
				</div>				
			 </div>
		  </div>
		</div>	
	</div>		
	<div class="modal fade" id="iconModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	   <div class="modal-dialog">
		  <div class="modal-content">
			 <div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title" id="myModalLabel">请选择图标</h4>
			 </div>
			 <div class="modal-body">
				<div class="row" style="padding-bottom:15px;">
				    <div class="col-md-2 icon">
					    <a href="javascript:;" target="_self">
					        <img src="./Tpl/Qyapp/Workflow/images/icon/01.png" width="64px" height="64px">
						</a>
					</div>
				    <div class="col-md-2 icon">
					    <a href="javascript:;" target="_self">
					        <img src="./Tpl/Qyapp/Workflow/images/icon/02.png" width="64px" height="64px">
						</a>
					</div>
				    <div class="col-md-2 icon">
					    <a href="javascript:;" target="_self">
					        <img src="./Tpl/Qyapp/Workflow/images/icon/03.png" width="64px" height="64px">
						</a>
					</div>
				    <div class="col-md-2 icon">
					    <a href="javascript:;" target="_self">
					        <img src="./Tpl/Qyapp/Workflow/images/icon/04.png" width="64px" height="64px">
						</a>
					</div>
				    <div class="col-md-2 icon">
					    <a href="javascript:;" target="_self">
					        <img src="./Tpl/Qyapp/Workflow/images/icon/05.png" width="64px" height="64px">
						</a>
					</div>
				    <div class="col-md-2 icon">
					    <a href="javascript:;" target="_self">
					        <img src="./Tpl/Qyapp/Workflow/images/icon/06.png" width="64px" height="64px">
						</a>
					</div>					
				    <div class="col-md-2 icon">
					    <a href="javascript:;" target="_self">
					        <img src="./Tpl/Qyapp/Workflow/images/icon/07.png" width="64px" height="64px" style="margin-top:20px;">
						</a>
					</div>							
				</div>				
			 </div>
			 <!-- <div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
				<button type="button" class="btn btn-primary"> 确定</button>
			 </div> -->
		  </div>
		</div>	
	</div>
	<div class="modal fade bs-modal-lg" id="range" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-dialog" style="width:760px;">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
				<h4 class="modal-title">选择范围</h4>
			</div>
			<div class="modal-body" style="padding-bottom:0px;">	
				<div class="row">
					<div class="col-md-12" id="selectObj" style="margin-top:-20px;">													
					
					
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" id="queding" onclick="queding()" data-id="" data-num="">确定</button>									
				<button type="button" data-dismiss="modal" class="btn btn-default">取消</button>
			</div>
		</div>
	</div>
</div>
	<section class="hbox stretch">
    <aside class="aside-md bg-white b-r" id="subNav">
		<include file="Knowledge:navmenu" />
    </aside>
	<aside>
   <section class="vbox">
        <header class="header bg-white b-b b-light">
            <p>新增文件夹</p>
            <a class="text-muted pull-right m-t pointer" data-toggle="back" title="返回" href="javascript:history.go(-1)"><i class="fa fa-reply"></i></a>
        </header>
        <section class="scrollable  wrapper">
            <section class="panel panel-default">
                <div class="panel-body">
                   <form class="form-horizontal form-validate" method="post" target="_self" action="{lanrain::U('Knowledge/addFolder',array('mid'=>$_GET['mid'],'id'=>$data['id'],'a_id'=>$_GET['a_id']))}" id="form">
                    <div class="form-group">
                        <label class="col-sm-2 control-label must">文件夹名称：</label>
                        <div class="col-sm-3 ">
                            <input type="text" class="form-control" data-rule-required="true" value="{lanrain:$data.name}" name="name" />
                        </div>
                    </div>
					<div class="form-group">
                        <label class="col-sm-2 control-label must">关键词：</label>
                        <div class="col-sm-3 ">
                            <input type="text" class="form-control" data-rule-required="true" value="{lanrain:$data.keyword}" name="keyword" />
                        </div>
                    </div>
					
					<div class="form-group">
						<label class="col-sm-2 control-label must">自定义图标</label>
						<div class="col-sm-3 ">
							<input class="form-control" data-rule-required="true" type="text" value="{lanrain:$data.pic}" name="pic" id="icon"/>                            
						</div>
						<div class="col-sm-1">
							<button type="button" class="btn btn-default js_delfield btn-sm" data-toggle="modal" data-target="#preModal">图标预览</button>
						</div>									
						<div class="col-sm-1">
							<button type="button" class="btn btn-default js_delfield btn-sm" data-toggle="modal" data-target="#iconModal">选择图标</button>
						</div>
						<div class="col-sm-1">
							<button type="button" class="btn btn-default js_delfield btn-sm" id="upload">上传图标</button>
						</div>
						
					</div>	
					
					<div class="form-group">
                        <label class="col-sm-2 control-label must">幻灯片</label>
                        <div class="col-sm-3 ">
							<div id="picList"></div>
							<?php foreach($pics as $k=>$v){?>
								<div class="pic_list" id="pic_<?php echo $k?>">
									<img src="<?php echo $v['pic']?>" width="100px" height="100px">
									<input name="s_pic[]" type="hidden" value="<?php echo $v['pic']?>">
									<div class="del" onclick="del_pic(<?php echo $k?>)">X</div>
								</div>
							<?php }?>
                             <a href="javascript:void();" target="_self" id="image3" class="btn btn-default js_new_message button_image"style="position: relative; z-index: 1;">上传图片</a>
						</div>
                    </div>
					
                  <div class="form-group">
                        <label class="col-sm-2 control-label">权限设置：</label>
                         <div class="col-sm-9">
                            <label class="checkbox-inline"><input type="checkbox"   name="power">转发邮箱</label>
                        </div>
                    </div>

                   <!--  <div class="form-group">
                        <label class="col-sm-2 control-label must">可见范围:</label>
                      
                           <div class="col-sm-3 ">
                               <input class="form-control" data-rule-required="true" data-toggle="tokeninputtree" name="depart" onclick="openModel()" placeholder="+请选择部门" type="text" value="{lanrain:$data.departname}" id="depart" />
							</div>
                       
                    </div> -->
					 <div class="form-group">
                            <label class="col-sm-2 control-label must">发送范围</label>
                            <div class="col-sm-8">
                                  <input type="text" class="form-control" value="{lanrain:$data.range}" id="selects" name="range" onclick="address('1','selects','n')" placeholder="+选择部门人员"/>
								  <input type="hidden" class="form-control" value="" id="follow" name="depart"/>
                            </div>
                        </div>	
					

                    <div class="form-group">
                        <label class="col-sm-2 control-label must">是否公开显示：</label>
                         <div class="col-sm-9">
                            <label class="radio-inline"><input type="radio" value="1" checked  name="display">公开显示</label>
                            <label class="radio-inline"><input type="radio" value="0"    name="display">不公开显示</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-4 col-sm-offset-2">
                            <input type="hidden" name="method" id="method" value="0" />
							<input type="hidden" value="<?php echo $_GET['id'];?>" name="id"/>
                            <button type="submit"  class="btn btn-primary"  data-loading-text="保存中...">保存</button>
                            <button type="button" onclick="subMit();" data-toggle="method" data-method="1" class="btn btn-primary" data-confirm="false" data-loading-text="保存中..." id="butTon">保存并新增文档</button>
                            <button type="button" class="btn btn-default"  data-toggle="back">取消</button>
                        </div>
                    </div>
                </form>
                </div>
            </section>
        </section>
    </section>	
	</aside>
    </section>	
<style>
.pic_list{position:relative;margin-right:10px;float:left;text-align:center;
}
.pic_list .del{position:absolute;right:-10px;top:-10px;width:20px;height:20px;border-radius:50%;background:red;line-height:20px;color:#fff;
}
</style>
<script type="text/javascript">
	KindEditor.ready(function(K) 
	{
		var editor = K.editor({
			allowFileManager : false,
			uploadJson:'{lanrain::U("Adminupload/uploadType",array("is_url"=>1,"file_type"=>"image"))}',
			formatUploadUrl:false
		});	
		var n = 0;		
		K('#image3').click(function() {
			editor.loadPlugin('image', function() {
				editor.plugin.imageDialog({
					showRemote : false,
					imageUrl : K('#url3').val(),
					clickFn : function(url, title, width, height, border, align) {
						//$('.sucai_img').attr("src", url); 
						$('#pic').attr('value',url);
						n ++ ;
						var html = '<div class="pic_list" id="pic_'+n+'"><img src="'+ url +'" width="100px" height="100px"><input name="s_pic[]" type="hidden" value="'+ url +'"><div class="del" onclick="del_pic('+n+')">X<\/div><\/div>';	
						$('#picList').append(html);	
						editor.hideDialog();
					}
				});
			});
		});
	});
	function del_pic(n){
		$('#pic_'+n).remove();
	}
	$('.icon').click(function(){
		var pic = $(this).find('img').attr('src');
		$('#icon').attr('value',pic);
		$('#preicon').attr('src',pic);	
		$('#iconModal').modal('hide');
		
	});
		KindEditor.ready(function(K) 
		{
			var editor = K.editor({
				allowFileManager : false,
				uploadJson:'/index.php?g=Qyapp&m=Adminupload&a=uploadType&is_url=1&file_type=image',
				formatUploadUrl:false
			});	
			K('#upload').click(function() {

				editor.loadPlugin('image', function() {
					editor.plugin.imageDialog({
						showRemote : false,
						imageUrl : K('#url3').val(),
						clickFn : function(url, title, width, height, border, align) {
							$('#icon').val(url);					
							$('#preicon').attr('src',url);		
							editor.hideDialog();
						}
					});
				});
			});			
		});
</script>
<script>
function address(type,id,num){
	$("#range").modal('show');
	$('#queding').attr('data-id',id);
	$('#queding').attr('data-num',num);
	var selected = $('#'+id).attr('value');
	$('#selectObj').load("{lanrain::U('Common/address',array('type'=>'"+type+"','sign'=>'"+id+"','selected'=>'"+selected+"'))}");
}	
function queding(){
	$("#range").modal('hide');
	var id = $('#queding').attr('data-id');
	var num = $('#queding').attr('data-num');	
	//$('#list-'+id+' div.bg-circle').remove();
	var dept_id = '';
	var dept_name = '';
	var follow = '';
	var users_id = '';
	var users_name = '';
	$('#selected-dept li').each(function(){
		var id_1 = $(this).attr('id');
		var str_1 = id_1.replace('selected-dept-','');		
		var dept_name = $('#selected-dept-name-'+str_1).text().replace(/[\r\n]/g,"").trim();
		follow += dept_name+',';			
		users_id += id_1+',';
	});		
	$('#selected-users li').each(function(){
		var id_2 = $(this).attr('id');
		var str_2 = id_2.replace('selected-users-','');		
		var users_name = $('#selected-users-name-'+str_2).text().replace(/[\r\n]/g,"").trim();
		follow += users_name+',';			
		users_id += id_2+',';
	});	 		
	$('#'+id).attr('value',follow);
	$('#follow').attr('value',users_id);
}
String.prototype.trim=function() {
	return this.replace(/(^\s*)|(\s*$)/g,'');
}	
</script>
<script>
function openModel(){
	$('#depart').attr("value",'');
	$('#departId').attr("value",'');
	$('#myModal').load("/index.php?g=Qyapp&m=Tree&a=myTree", function(){
		 $('#myModal').modal();
	});	
}

function cancel(){
	$('#depart').attr("value",'');
	$('#departId').attr("value",'');
	$('#myModal').modal('hide');
	$('#myModal').empty();
}

function guanbi(){
	$('#myModal').modal('hide');
	$('#myModal').empty();
}

</script>
<script>
function subMit(){
	$('#method').attr('value',1);
	$('#form').submit();
}
</script>
<include file="Common:footer" />