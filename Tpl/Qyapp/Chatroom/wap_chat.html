<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
<meta charset="utf-8"/>
<title>聊天室</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta content="" name="description"/>
<meta content="" name="author"/>
<!-- BEGIN GLOBAL MANDATORY STYLES -->
<!-- <link href="./Tpl/assets/global/css/gfonts1.css" rel="stylesheet" type="text/css"/> -->
<link href="./Tpl/assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
<!-- <link href="./Tpl/assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css"/> -->
<link href="./Tpl/assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<!-- <link href="./Tpl/assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
<link href="./Tpl/assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css"/>
<link href="./Tpl/Qyapp/Static/Css/style.min.css" rel="stylesheet" type="text/css"/> -->
<!-- END GLOBAL MANDATORY STYLES -->
<!-- BEGIN THEME STYLES -->
<link href="./Tpl/assets/global/css/components.css" id="style_components" rel="stylesheet" type="text/css"/>
<!-- <link href="./Tpl/assets/global/css/plugins.css" rel="stylesheet" type="text/css"/> -->
<link href="./Tpl/assets/admin/layout/css/layout.css" rel="stylesheet" type="text/css"/>
<!-- <link id="style_color" href="./Tpl/assets/admin/layout/css/themes/default.css" rel="stylesheet" type="text/css"/>
<link href="./Tpl/assets/admin/layout/css/custom.css" rel="stylesheet" type="text/css"/> -->
<link href="./Tpl/assets/admin/layout/css/weiyi.css" rel="stylesheet" type="text/css"/>

<!-- END THEME STYLES -->
<link rel="shortcut icon" href="favicon.ico"/>
<style type="text/css">
        .picture{
                float: left;width: 18%;margin-right: 4%;
        }
        .picture a{
                /*margin-left: 3px;*/
        }
        .picture img{
                width: 25px;height: 25px;
                margin-top: 3px;
        }
        .input-cont{
                /*margin-right: 60px !important;*/
                width: 63%;
                float: left;
        }
        .btn-cont{
            right: 2px;
                overflow: hidden;
                width: 15% !important;
        }
</style>
</head>
<body class="page-quick-sidebar-over-content " style="background:#fff;" id="main">
<!-- BEGIN CONTAINER -->
<div class="page-container" style="overflow-y:hidden;">
<!-- BEGIN CONTENT -->
<div class="page-content-wrapper"> 
<div class="" style="background-color:#fff;margin-left:0;padding:0;">

<div class="page-quick-sidebar-wrapper" style="background-color:#fff;" id="allusers">

</div>

<div class="row ">
<div class="col-md-12 col-sm-12">
<!-- BEGIN PORTLET-->
<div class="portlet">
<div class="portlet-title" style="background-color:#35aa47;position: fixed;top: 0px;right: 0px;width: 100%;z-index:123;">
<div class="caption" style="color:#fff;">
<span>&nbsp;&nbsp;<i class="fa fa-comments"></i>&nbsp;&nbsp;聊天室</span>

</div>
<div class="tools" style="margin-right:15px;">
<if condition="$info['isleader'] eq 1">
<a href="javascript:;"  onclick="selectPlus('plus');" style="color:#fff;" id="plus">
<i class="fa fa-plus"></i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</a>
<if/>
<a href="javascript:;"  onclick="selectBars('bars');" style="color:#fff;" id="bars">
<i class="fa fa-users"></i>
</a>										
<!-- <a href="javascript:;"  onclick="selectMinus('minus');" style="color:#fff;" id="minus">
<i class="fa fa-minus"></i>&nbsp;&nbsp;&nbsp;&nbsp;
</a> -->								
<!-- <a href="javascript:;" onclick="selectUser('user');" style="color:#fff;" id="user">
<i class="fa fa-user"></i>&nbsp;&nbsp;&nbsp;&nbsp;
</a>	 -->								
</div>

</div>
<div class="portlet-body" id="chats">
<!-- <div class="scroller" data-always-visible="1" data-rail-visible1="1"> -->
<ul class="chats scroller" id="word" style="margin:40px 0px 0px 0px;padding-bottom:80px;">
<volist name="data" id="data">
<if condition="$data['wecha_id'] eq $_GET['wecha_id']">								
<li class="out" style="margin-left:85px;" id="{lanrain:$data.id}">
<img class="avatar" alt="" src="./Tpl/assets/admin/layout/img/avatar2.jpg"/>
<div class="message" style="background: none repeat scroll 0 0 #778899;border-radius: 8px !important;padding: 12px 15px;position: relative;border-right:0px solid #1bbc9b;color: white !important;">
<div class="triangle" style="width: 0;height: 0;border-width:0px 11px 8px 0px;border-style:solid;border-color: #fff #fff #789 #fff;position: absolute;top:10px;right: -11px;"></div>
<a href="#" class="name" style="color: white !important;">{lanrain:$data.wecha_id} </a>
<span class="datetime" style="color: white !important;">{lanrain:$data.time|date="Y-m-d H:i",###} </span>
<span class="body">{lanrain:$data.content} </span>
</div>
</li>
<else/>	

<li class="in" style="margin-right:65px;padding-left:20px;" id="{lanrain:$data.id}">
<img class="avatar" alt="" src="./Tpl/assets/admin/layout/img/avatar1.jpg"/>
<div class="message" style="background: none repeat scroll 0 0 #178efe;border-radius: 8px !important;padding: 12px 15px;position: relative;border-left:0px solid #1bbc9b;color: white !important;">
<div class="triangle" style="width: 0;height: 0;border-width:0px 0px 8px 11px;border-style:solid;border-color: #fff #fff #178EFE #fff;position: absolute;top:10px;left: -11px;"></div>
<a href="#" class="name" style="color: white !important;">{lanrain:$data.wecha_id} &nbsp;&nbsp;&nbsp;&nbsp;</a>
<span class="datetime" style="color: white !important;">{lanrain:$data.time|date="Y-m-d H:i",###} </span>
<span class="body">{lanrain:$data.content}</span>
</div>
</li>


</if>
</volist>	

</ul>
<!-- </div> -->
<div class="chat-form" style="bottom: 0;left: 0;position: fixed;right: 0;background:#fff; z-index: 10000; margin:0 !important;overflow:hidden;" id="chat-form">
<div class="picture"><a href="#"><img src="./Tpl/Qyapp/Chatroom/images/iconfont-emotion.png"></a>
<a href="#" style="float:right;"><img src="./Tpl/Qyapp/Chatroom/images/iconfont-fatietupian.png"></a></div>
<div class="input-cont">
<input class="form-control" type="text" id="content" placeholder="说几句吧..."/>
</div>
<div class="btn-cont">
<a href="javascript:;" onclick="postData();" class="btn blue icn-only">
发送
</a>
</div>
</div>
</div>
</div>
<!-- END PORTLET-->
</div>
</div>	


</div>
</div>
</div>
</div>				
<!--[if lt IE 9]>
<script src="./Tpl/assets/global/plugins/respond.min.js"></script>
<script src="./Tpl/assets/global/plugins/excanvas.min.js"></script> 
<![endif]-->
<script src="./Tpl/assets/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="./Tpl/assets/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
<script>
$('#userlist li').each(function(){
$(this).mouseover(function(){
$('#userlist li').css('background','#fff');
$(this).css('background','#f0f0f0');
});
});
</script>
<!-- IMPORTANT! Load jquery-ui-1.10.3.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<!-- <script src="./Tpl/assets/global/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script> -->
<script src="./Tpl/assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<!-- <script src="./Tpl/assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>-->
<script src="./Tpl/assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<!--<script src="./Tpl/assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="./Tpl/assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script src="./Tpl/assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<script src="./Tpl/assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<script type="text/javascript" src="./Tpl/assets/global/plugins/select2/select2.min.js"></script> -->
<script src="./Tpl/assets/global/scripts/metronic.js" type="text/javascript"></script>
<!-- <script src="./Tpl/assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="./Tpl/assets/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>
<script src="./Tpl/assets/admin/layout/scripts/demo.js" type="text/javascript"></script>
<script src="./Tpl/assets/admin/pages/scripts/form-samples.js"></script> -->
<!-- END PAGE LEVEL SCRIPTS -->

<script>
jQuery(document).ready(function() {    
// initiate layout and plugins
Metronic.init(); // init metronic core components
//Layout.init(); // init current layout
//QuickSidebar.init(); // init quick sidebar
//Demo.init(); // init demo features
//FormSamples.init();
  Index.initChat();
//$('#word').scrollTop = $('#word').scrollHeight;  
});

</script>
<script>
function selectBars(id){
$('body').addClass('page-quick-sidebar-open');
$('#allusers').css('width','100%');
$('#allusers').css('top','0');
$('#chat-form').css('z-index','0');
$('#allusers').load("{lanrain::U('Chatroom/wap_bars',array('wecha_id'=>$_GET['wecha_id'],'token'=>$_GET['token'],'id'=>$_GET['id']))}");
//$('#getdata').html('');
//$('#submit').attr('mydata',type);
//$('#media-list li.media').children('div.media-status').children().children().children().attr("class",'');
}
function selectPlus(id){
$('body').addClass('page-quick-sidebar-open');
$('#allusers').css('width','100%');
$('#allusers').css('top','0');
$('#chat-form').css('z-index','0');	
$('#allusers').load("{lanrain::U('Chatroom/wap_plus',array('wecha_id'=>$_GET['wecha_id'],'token'=>$_GET['token'],'id'=>$_GET['id']))}");
//$('#getdata').html('');
//$('#submit').attr('mydata',type);
//$('#media-list li.media').children('div.media-status').children().children().children().attr("class",'');
}
function selectUser(id){
$('body').addClass('page-quick-sidebar-open');
$('#allusers').css('width','100%');
$('#allusers').css('top','0');
$('#chat-form').css('z-index','0');	
$('#allusers').load("{lanrain::U('Chatroom/wap_user',array('wecha_id'=>$_GET['wecha_id'],'token'=>$_GET['token'],'id'=>$_GET['id']))}");
//$('#getdata').html('');
//$('#submit').attr('mydata',type);
//$('#media-list li.media').children('div.media-status').children().children().children().attr("class",'');
}
function closeList(){
$('body').removeClass('page-quick-sidebar-open');
$('#allusers').css('width','0');
//$('#getdata').html('');	
//$('#allusers').html('');
$('#chat-form').css('z-index','9999');	
}
$('#word').scrollTop = $('#word').scrollHeight;

function postData(){
var content = $('#content').val();
if(content == ''){
alert('请输入内容');
return false;
}
$.ajax({
	type:"POST",
	url:"index.php?g=Qyapp&m=Chatroom&a=wap_post",
	data:{content:content,id:"{lanrain:$_GET['id']}",token:"{lanrain:$_GET['token']}",wecha_id:"{lanrain:$_GET['wecha_id']}"},
	dataType:'json',
	success:function(json){
		var status = json.status;
		if(status==0)
		{
		    alert('发送失败');
		}
		else
		{
		    var content = json.content;
		    $('#content').val('');

		}
	}
});

}
</script>
<script>
$(document).ready(function() {
 $("#word").scrollTop($("#word")[0].offsetHeight);
});
</script>
<script>  
var lastId = $('#word').children().last().attr('id');
setInterval("getData()",1000);
function getData(){
//var recordId = $('#word').children().last().attr('id');
//alert(time);
$.ajax({
	type:"POST",
	url:"index.php?g=Qyapp&m=Chatroom&a=wap_get_data",
	data:{recordId:lastId,id:"{lanrain:$_GET['id']}",token:"{lanrain:$_GET['token']}",wecha_id:"{lanrain:$_GET['wecha_id']}"},
	dataType:'json',
	success:function(json){
		var status = json.status;		
		if(status==1)
		{
			var content = json.content;
			var time = json.time;
			var wecha_id = json.wecha_id;
			var id = json.id;
            lastId = id;			
			if(wecha_id == "{lanrain:$_GET['wecha_id']}"){		
$('#word').append('<li class="out" style="margin-left:85px;" id="{lanrain:$data.id}"><img class="avatar" alt="" src="./Tpl/assets/admin/layout/img/avatar2.jpg"/><div class="message" style="background: none repeat scroll 0 0 #778899;border-radius: 8px !important;padding: 12px 15px;position: relative;border-right:0px solid #1bbc9b;color: white !important;"><div class="triangle" style="width: 0;height: 0;border-width:0px 11px 8px 0px;border-style:solid;border-color: #fff #fff #789 #fff;position: absolute;top:10px;right: -11px;"></div><a href="#" class="name" style="color: white !important;">'+wecha_id+'</a><span class="datetime" style="color: white !important;">'+time+'</span><span class="body">'+content+'</span></div></li>');				
			}else{					
$('#word').append('<li class="in" style="margin-right:65px;padding-left:20px;" id="{lanrain:$data.id}"><img class="avatar" alt="" src="./Tpl/assets/admin/layout/img/avatar1.jpg"/><div class="message" style="background: none repeat scroll 0 0 #178efe;border-radius: 8px !important;padding: 12px 15px;position: relative;border-left:0px solid #1bbc9b;color: white !important;"><div class="triangle" style="width: 0;height: 0;border-width:0px 0px 8px 11px;border-style:solid;border-color: #fff #fff #178EFE #fff;position: absolute;top:10px;left: -11px;"></div><a href="#" class="name" style="color: white !important;">'+time+'&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="datetime" style="color: white !important;">'+wecha_id+'</span><span class="body">'+content+'</span></div></li>');			
			}
			//document.getElementByIdx ( 'main').scrollTop=document.getElementByIdx ( 'main').scrollHeight ;
$("#word").scrollTop($("#word")[0].offsetHeight);
		}
		else if(status == 0) 
		{
			return false;
		}
	}
});
}
</script>
<script>
$('#media-list li').on('click',function(){
var mytype = $('#submit').attr('mydata');
var userName = $(this).children('div.media-body').children('h4').html();

if(mytype == 1){
$('#media-list li.media').children('div.media-status').children().children().children().attr("class",'');
$(this).children('div.media-status').children().children().children().attr("class",'checked');
$('#getdata').html('<span id="'+userName+'"></span>'); 
}else{
$(this).children('div.media-status').children().children().children().attr("class",'checked');
$('#getdata').append('<span id="'+userName+'"></span>'); 
}
});	
$('#submit').on('click',function(){
var mytype = $('#submit').attr('mydata');
$('body').removeClass('page-quick-sidebar-open');
$('#allusers').css('width','0');
if(mytype == 1){
var back = $('#getdata span').attr('id');
$('#truename').attr('value',back);
$('#myinput').html(back);
}else{
var back = '';
$('#getdata span').each(function(){
var id= $(this).attr('id')+';';
back+=id;
});	
$('#name').attr('value',back);	
$('#myinput2').html(back);		
}
$('#getdata').html('');
});
</script>	
<script>
$('#userlist li').each(function(){
$(this).mouseover(function(){
$('#userlist li').css('background','#fff');
$(this).css('background','#f0f0f0');
});
});
</script>
<!-- END JAVASCRIPTS -->
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
wx.config({
debug: false,
appId: '{lanrain:$jsssdk_info.appId}',
timestamp: {lanrain:$jsssdk_info.timestamp},
nonceStr: '{lanrain:$jsssdk_info.nonceStr}',
signature: '{lanrain:$jsssdk_info.signature}',
jsApiList: [
'checkJsApi',
'onMenuShareTimeline',
'onMenuShareAppMessage',
'onMenuShareQQ',
'onMenuShareWeibo',
'openCard'
]
});
</script>

<script>
wx.ready(function () {
// 2.1 监听“分享给朋友”，按钮点击、自定义分享内容及分享结果接口
var newUrl="http://{lanrain::$_SERVER['HTTP_HOST']}";
wx.onMenuShareAppMessage({
title: '分享招聘岗位挣红包',
desc: '分享招聘岗位挣红包',
link: newUrl+"{lanrain::U('wap_positionInfo',array('token'=>$_GET['token'],'pid'=>$_GET['pid'],'wecha_id'=>$_GET['wecha_id'],'type'=>'up'))}",
imgUrl: newUrl+"/Tpl/Qyapp/Hiring/images/logo.jpg",
trigger: function (res) {
},
success: function (res) {
},
cancel: function (res) {
},
fail: function (res) {
}
});
// 2.2 监听“分享到朋友圈”按钮点击、自定义分享内容及分享结果接口
wx.onMenuShareTimeline({
title: '分享招聘岗位挣红包',
link: newUrl+"{lanrain::U('wap_positionInfo',array('token'=>$_GET['token'],'pid'=>$_GET['pid'],'wecha_id'=>$_GET['wecha_id'],'type'=>'up'))}",
imgUrl: newUrl+"/Tpl/Qyapp/Hiring/images/logo.jpg",
trigger: function (res) {
},
success: function (res) {
},
cancel: function (res) {
},
fail: function (res) {
}
});

// 2.3 监听“分享到QQ”按钮点击、自定义分享内容及分享结果接口
wx.onMenuShareQQ({
title: '分享招聘岗位挣红包',
desc: '分享招聘岗位挣红包',
link: newUrl+"{lanrain::U('wap_positionInfo',array('token'=>$_GET['token'],'pid'=>$_GET['pid'],'wecha_id'=>$_GET['wecha_id'],'type'=>'up'))}",
imgUrl: newUrl+"/Tpl/Qyapp/Hiring/images/logo.jpg",
trigger: function (res) {
},
complete: function (res) {
},
success: function (res) {
},
cancel: function (res) {
},
fail: function (res) {
}
});
// 2.4 监听“分享到微博”按钮点击、自定义分享内容及分享结果接口
wx.onMenuShareWeibo({
title: '分享招聘岗位挣红包',
desc: '分享招聘岗位挣红包',
link:  newUrl+"{lanrain::U('wap_positionInfo',array('token'=>$_GET['token'],'pid'=>$_GET['pid'],'wecha_id'=>$_GET['wecha_id'],'type'=>'up'))}",
imgUrl: newUrl+"/Tpl/Qyapp/Hiring/images/logo.jpg",
trigger: function (res) {
},
complete: function (res) {
},
success: function (res) {
},
cancel: function (res) {
},
fail: function (res) {
}
});

});
</script>
</body>
<!-- END BODY -->
</html>