define(function(n){var t=n("jquery"),i=n("$");t.extend({handleError:function(n,i,r,u){n.error&&n.error.call(n.context||n,i,r,u);n.global&&(n.context?t(n.context):t.event).trigger("ajaxError",[i,n,u])},createUploadIframe:function(n,i){var u="jUploadFrame"+n,r='<iframe id="'+u+'" name="'+u+'" style="position:absolute; top:-9999px; left:-9999px"';return window.ActiveXObject&&(typeof i=="boolean"?r+=' src="javascript:false"':typeof i=="string"&&(r+=' src="'+i+'"')),r+=" />",t(r).appendTo(document.body),t("#"+u).get(0)},createUploadForm:function(n,i,r){var o="jUploadForm"+n,h="jUploadFile"+n,u=t('<form  action="" method="POST" name="'+o+'" id="'+o+'" enctype="multipart/form-data"><\/form>'),e,f,s;if(r)for(e in r)t('<input type="hidden" name="'+e+'" value="'+r[e]+'" />').appendTo(u);return f=i,s=t(f).clone(),t(f).attr("id",h),t(f).before(s),t(f).appendTo(u),t(u).css("position","absolute"),t(u).css("top","-1200px"),t(u).css("left","-1200px"),t(u).appendTo("body"),u},ajaxFileUpload:function(n){var e,i,o,r;n=t.extend({},t.ajaxSettings,n);var u=(new Date).getTime(),r=t.createUploadForm(u,n.fileElement,typeof n.data=="undefined"?!1:n.data),c=t.createUploadIframe(u,n.secureuri),f="jUploadFrame"+u,s="jUploadForm"+u;n.global&&!t.active++&&t.event.trigger("ajaxStart");e=!1;i={};n.global&&t.event.trigger("ajaxSend",[i,n]);o=function(u){var o=document.getElementById(f),s,c;try{o.contentWindow?(i.responseText=o.contentWindow.document.body?o.contentWindow.document.body.innerHTML:null,i.responseXML=o.contentWindow.document.XMLDocument?o.contentWindow.document.XMLDocument:o.contentWindow.document):o.contentDocument&&(i.responseText=o.contentDocument.document.body?o.contentDocument.document.body.innerHTML:null,i.responseXML=o.contentDocument.document.XMLDocument?o.contentDocument.document.XMLDocument:o.contentDocument.document)}catch(h){t.handleError(n,i,null,h)}if(i||u=="timeout"){e=!0;try{s=u!="timeout"?"success":"error";s!="error"?(c=t.uploadHttpData(i,n.dataType),n.success&&n.success(c,s),n.global&&t.event.trigger("ajaxSuccess",[i,n])):t.handleError(n,i,s)}catch(h){s="error";t.handleError(n,i,s,h)}n.global&&t.event.trigger("ajaxComplete",[i,n]);n.global&&!--t.active&&t.event.trigger("ajaxStop");n.complete&&n.complete(i,s);t(o).unbind();setTimeout(function(){try{t(o).remove();t(r).remove()}catch(u){t.handleError(n,i,null,u)}},100);i=null}};n.timeout>0&&setTimeout(function(){e||o("timeout")},n.timeout);try{r=t("#"+s);t(r).attr("action",n.url);t(r).attr("method","POST");t(r).attr("target",f);r.encoding?t(r).attr("encoding","multipart/form-data"):t(r).attr("enctype","multipart/form-data");t(r).submit()}catch(h){t.handleError(n,i,null,h)}return t("#"+f).load(o),{abort:function(){}}},uploadHttpData:function(r,type){var data=!type;return data=type=="xml"||data?r.responseXML:r.responseText,type=="script"&&t.globalEval(data),type=="json"&&eval("data = "+data),type=="html"&&t("<div>").html(data).evalScripts(),data}})});