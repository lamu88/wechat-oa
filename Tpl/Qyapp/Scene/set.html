<include file="Common:header" />
<script src="./Tpl/Qyapp/Static/Js/jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="./Tpl/Qyapp/Static/Js/bootstrap/3.1.1/dist/js/bootstrap.min.js"></script>	
<script src="./Tpl/Qyapp/Index/index/artDialog/jquery.artDialog.js?skin=default"></script>
<script src="./Tpl/Qyapp/Index/index/artDialog/plugins/iframeTools.js"></script>
<script src="./Tpl/Qyapp/Static/Js/jstree/3.0.2/jstree.min.js"></script>
<script charset="utf-8" src="./Tpl/Qyapp/Index/index/kindeditor/kindeditor-min.js"></script>
<script charset="utf-8" src="./Tpl/Qyapp/Index/index/kindeditor/lang/zh_CN.js"></script>
<link href="./Tpl/Qyapp/Static/Js/jstree/3.0.2/themes/default/style.min.css" rel="stylesheet">	
<link href="./Tpl/Qyapp/Static/Js/bootstrap/switch/docs/css/highlight.css" rel="stylesheet">		
<link href="./Tpl/Qyapp/Static/Js/bootstrap/switch/dist/css/bootstrap3/bootstrap-switch.min.css" rel="stylesheet">	
<link href="./Tpl/Qyapp/Static/Js/daterangepicker/daterangepicker-bs3.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="./Tpl/Qyapp/Static/Js/clockpicker/dist/bootstrap-clockpicker.min.css">
<link rel="stylesheet" type="text/css" href="./Tpl/Qyapp/Static/Js/clockpicker/assets/github.min.css">		
<script src="./Tpl/Qyapp/Static/Js/jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="./Tpl/Qyapp/Static/Js/bootstrap/3.1.1/dist/js/bootstrap.min.js"></script>		
<script src="./Tpl/Qyapp/Static/Js/artTemplate/dist/template.js" type="text/javascript"></script>
<script src="./Tpl/Qyapp/Static/Js/jstree/3.0.2/jstree.min.js"></script>	
<script src="./Tpl/Qyapp/Static/Js/bootstrap/switch/docs/js/highlight.js" type="text/javascript"></script>	
<script src="./Tpl/Qyapp/Static/Js/bootstrap/switch/dist/js/bootstrap-switch.min.js" type="text/javascript"></script>
<script src="./Tpl/Qyapp/Static/Js/daterangepicker/moment.min.js" type="text/javascript"></script>
<script src="./Tpl/Qyapp/Static/Js/daterangepicker/daterangepicker.js" type="text/javascript"></script>
<script src="./Tpl/Qyapp/Static/Js/clockpicker/dist/bootstrap-clockpicker.min.js" type="text/javascript"></script>
<div id="myModal" class="modal fade" tabindex="-2" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

</div>
<script type="text/javascript">
	KindEditor.ready(function(K) {
		var editor;
		editor = K.create('textarea[name="content"]', {
			resizeType : 0,
			allowPreviewEmoticons :false,
			allowImageUpload :true,
			uploadJson:'{lanrain::U("Upload/ajaxUpload",array("is_url"=>1,"file_type"=>"image"))}',
			formatUploadUrl:false,
			items : [
				'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold', 'italic', 'underline',
				'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
				'insertunorderedlist', '|', 'emoticons', 'image', 'link']
		});		
	});	
</script>
<script type="text/javascript">
	KindEditor.ready(function(K) 
	{
		var editor = K.editor({
			allowFileManager : false,
			uploadJson:'{lanrain::U("Upload/ajaxUpload",array("is_url"=>1,"file_type"=>"image"))}',
			formatUploadUrl:false
		});				
		K('#image1').click(function() {
			editor.loadPlugin('image', function() {
				editor.plugin.imageDialog({
					showRemote : false,
					imageUrl : K('#url3').val(),
					clickFn : function(url, title, width, height, border, align) {
						$('#pic1').attr("value", url); 
						//$('.img_view').attr('src',url);
						editor.hideDialog();
					}
				});
			});
		});
		K('#image2').click(function() {
			editor.loadPlugin('image', function() {
				editor.plugin.imageDialog({
					showRemote : false,
					imageUrl : K('#url3').val(),
					clickFn : function(url, title, width, height, border, align) {
						$('#logo').attr("value", url); 
						//$('.img_view').attr('src',url);
						editor.hideDialog();
					}
				});
			});
		});
		K('#image3').click(function() {
			editor.loadPlugin('image', function() {
				editor.plugin.imageDialog({
					showRemote : false,
					imageUrl : K('#url3').val(),
					clickFn : function(url, title, width, height, border, align) {
						$('#background').attr("value", url); 
						//$('.img_view').attr('src',url);
						editor.hideDialog();
					}
				});
			});
		});		
		K('#image4').click(function() {
			editor.loadPlugin('image', function() {
				editor.plugin.imageDialog({
					showRemote : false,
					imageUrl : K('#url3').val(),
					clickFn : function(url, title, width, height, border, align) {
						$('#qrcode').attr("value", url); 
						//$('.img_view').attr('src',url);
						editor.hideDialog();
					}
				});
			});
		});				
	});
</script>

<section class="hbox stretch">
	<aside class="aside-md bg-white b-r" id="subNav">
	<include file="Scene:navmenu" />		
	</aside>
 	<aside>
	<section class="vbox">	
        <section class="scrollable  wrapper">
			<div class="cLineB"><h4>微现场设置</h4></div> 			
            <section class="panel panel-default">
                <div class="panel-body">
                    <form class="form-horizontal form-validate" target="_self" method="post" action="{lanrain::U('Scene/index',array('mid'=>$_GET['mid']))}">
                        <div class="form-group">
                            <label class="col-sm-2 control-label must">现场名称</label>
                            <div class="col-sm-3 ">
                                  <input type="text" class="form-control"  data-rule-required="true" name="title" value="{lanrain:$info.title}" />
                            </div>
                        </div>
						<div class="modal fade bs-modal-lg" id="range" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog" style="width:760px;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
					<h4 class="modal-title">选择范围</h4>
				</div>
				<div class="modal-body" style="padding-bottom:0px;">	
					<div class="row">
						<div class="col-md-12" id="selectObj" style="margin-top:-20px;">													
						
						
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" id="queding" onclick="queding1()" data-id="" data-num="">确定</button>									
					<button type="button" data-dismiss="modal" class="btn btn-default">取消</button>
				</div>
			</div>
		</div>
	</div>
						<div class="line line-dashed line-lg pull-in"></div>
                        <div class="form-group">
						<label class="col-sm-2 control-label must">发送范围</label>
						<div class="col-sm-8">
							  <input type="text" class="form-control" value="{lanrain:$info.range}" id="selects" name="range" onclick="address('1','selects','n')" placeholder="+选择部门人员"/>
							  <input type="hidden" class="form-control" value="" id="depart" name="depart"/>
						</div>
					</div>	
                        <div class="line line-dashed line-lg pull-in"></div>						

                        <div class="form-group">
                            <label class="col-sm-2 control-label must">LOGO</label>
                            <div class="col-sm-3 ">
								<td>
									 <input type="text" name="logo" value="{lanrain:$info.logo}" class="form-control"  id="logo" style="width:320px;" />  
									<a href="javascript:void();"   id="image2" class="btn btn-default js_new_message button_image"style="position: relative; z-index: 1;">上传图片</a>
									<p>微信目前只支持jpg格式的图片</p>
									<!-- <a href="###" onclick="viewImg('logo')">预览</a>[280*75] -->
								</td> 
                            </div>
                        </div>
						<div class="line line-dashed line-lg pull-in"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label must">背景图</label>
                            <div class="col-sm-3 ">
								<input type="text" name="background" value="{lanrain:$info.background}" class="form-control"  id="background" style="width:320px;" />
								<a href="javascript:void();"   id="image3" class="btn btn-default js_new_message button_image"style="position: relative; z-index: 1;">上传图片</a>
								<p>微信目前只支持jpg格式的图片</p>
<!-- 							<a href="###" onclick="upyunPicUpload('background',700,420,'{lanrain:$token}')" class="a_upload">上传</a>
								<a href="###" onclick="viewImg('background',700,420)">预览</a> -->
                            </div>
                        </div>
						<div class="line line-dashed line-lg pull-in"></div>
						<div class="form-group">
                            <label class="col-sm-2 control-label must">背景音乐</label>
                            <div class="col-sm-3 ">
                                    <input type="input"  class="form-control"  value="{lanrain:$info.pass2}" name="pass2" placeholder="定义前台背景音乐，为URL地址" value="" > 
                            </div>
                        </div>
						<div class="line line-dashed line-lg pull-in"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label must">简介</label>
                            <div class="col-sm-3 ">
								<textarea name="intro" class="px" style="width:400px;height:80px;">{lanrain:$info.intro}</textarea>
                            </div>
                        </div>
						<input type="hidden" class="form-control"  data-rule-required="true" name="acttitle" value="摇一摇" />
						
						<input id="radio1" class="radio" type="hidden" name="shaketype" value="{lanrain:$exst.shaketype}"  checked="checked" style="float:left">

                        <input type="hidden" class="form-control" id="clienttime" placeholder="数字越大服务器负担越小，但是要考虑客户体验!"  name="clienttime"  value="3" > 
					
                        <input type="hidden" class="form-control"  id="showtime"  name="showtime" placeholder="数字越大服务器负担越小，但是要考虑客户体验!" value="3" >  

                        <input type="hidden" class="form-control"  id="starttime"  name="starttime" placeholder="倒数计时开始游戏" value="10" >  

						<div class="form-group">
                            <label class="col-sm-2 control-label must">摇一摇截止摇晃数</label>
                            <div class="col-sm-3 ">
                                  <input type="input" class="form-control"  id="endshake"  name="endshake" placeholder="当有用户达到此数值时，游戏结束。" value="{lanrain:$shake.endshake}" >  
                            </div>
                        </div>
						
                        <input type="hidden"  class="form-control" id="shownum"  name="shownum" placeholder="成绩将以进度条形式显示在前台页面上的n个人" value="10" >  
					
						<input type="hidden" class="form-control"  data-rule-required="true" name="shake_id" value="{lanrain:$shake.id}" />
						<input type="hidden" class="form-control"  data-rule-required="true" name="wall_id" value="{lanrain:$wall_id.id}" />
                        <div class="form-group">
                            <label class="col-sm-2 control-label must">投票开关</label>
                            <div class="col-sm-3 ">
								<td>
								  <input type="radio" name="open_vote" value="1" <if condition="$info.open_vote neq '0'">checked</if>>开启
								  <input type="radio" name="open_vote" value="0" <if condition="$info.open_vote eq '0'">checked</if>>关闭
								</td> 
                            </div>
                        </div>
						<div class="line line-dashed line-lg pull-in"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label must">抽奖开关</label>
                            <div class="col-sm-3 ">
								<td>
								  <input type="radio" name="open_lottery" value="1" <if condition="$info.open_lottery neq '0'">checked</if>>开启
								  <input type="radio" name="open_lottery" value="0" <if condition="$info.open_lottery eq '0'">checked</if>>关闭
								</td> 
                            </div>
                        </div>
						<div class="line line-dashed line-lg pull-in"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label must">对对碰开关</label>
                            <div class="col-sm-3 ">
								<td>
								  <input type="radio" name="open_zzle" value="1" <if condition="$info.open_zzle neq '0'">checked</if>>开启
								  <input type="radio" name="open_zzle" value="0" <if condition="$info.open_zzle eq '0'">checked</if>>关闭
								</td> 
                            </div>
                        </div>
						<div class="line line-dashed line-lg pull-in"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label must">现场开关</label>
                            <div class="col-sm-3 ">
								<td>
									<input type="radio" name="is_open" value="1" <if condition="$info.is_open neq '0'">checked</if>>开启
									<input type="radio" name="is_open" value="0" <if condition="$info.is_open eq '0'">checked</if>>关闭
									<input type="hidden" id="sid" name="id" value="{lanrain:$info.id}">
								</td> 
                            </div>
                        </div>
						<div class="line line-dashed line-lg pull-in"></div>
                        <div class="form-group">
                            <label class="col-sm-2"></label>
                            <div class="col-sm-3 ">
								<button type="submit"  name="button"  class="btnGreen left" style="background:#65BD77;color:#fff;border:none;padding:4px 12px;border-radius:3px;">保存</button>
                            </div>
                        </div>
						<div class="line line-dashed line-lg pull-in"></div>							
					</form>	
				</div>		
			</section>			
		</section>	
		</section>	
	</aside>
</section>	
<script>	
	function queding1(){
	$("#range").modal('hide');
	var id = $('#queding').attr('data-id');
	var num = $('#queding').attr('data-num');	
	//$('#list-'+id+' div.bg-circle').remove();
	var dept_id = '';
	var dept_name = '';
	var follow = '';
	var users_id = '';
	var users_name = '';
	$('#selected-dept li').each(function(){
		var id_1 = $(this).attr('id');
		var str_1 = id_1.replace('selected-dept-','');		
		var dept_name = $('#selected-dept-name-'+str_1).text().replace(/[\r\n]/g,"").trim();
		follow += dept_name+' ';			
		users_id += id_1+',';
	});		
	$('#selected-users li').each(function(){
		var id_2 = $(this).attr('id');
		var str_2 = id_2.replace('selected-users-','');		
		var users_name = $('#selected-users-name-'+str_2).text().replace(/[\r\n]/g,"").trim();
		follow += users_name+' ';			
		users_id += id_2+',';
	});	 		
	$('#selects').attr('value',follow);
	//$('#selects').html(follow);
	$('#depart').attr('value',users_id);
}
function address(type,id,num){
	$("#range").modal('show');
	$('#queding').attr('data-id',id);
	$('#queding').attr('data-num',num);
	var selected = $('#'+id).attr('value');
	$('#selectObj').load("{lanrain::U('Common/address',array('type'=>'"+type+"','sign'=>'"+id+"','selected'=>'"+selected+"'))}");
}
String.prototype.trim=function() {
	return this.replace(/(^\s*)|(\s*$)/g,'');
}	
	</script>
<script>
function openModel(){
	$('#depart').attr("value",'');
	$('#departId').attr("value",'');
	$('#myModal').load("/index.php?g=Qyapp&m=Tree&a=myTree", function(){
		 $('#myModal').modal();
	});	
}

function cancel(){
	$('#depart').attr("value",'');
	$('#departId').attr("value",'');
	$('#myModal').modal('hide');
	$('#myModal').empty();
}

function guanbi(){
	$('#myModal').modal('hide');
	$('#myModal').empty();
}

</script>
<script type="text/javascript">
var num = 0;
function addDate(){
	var id = num++;
	var data = {
	index: id,	
	};			
	var html = template('js_excludedata_tem', data);
	$('#adddate').before(html);		

	var cb = function(start, end, label) {
		console.log(start.toISOString(), end.toISOString(), label);
		$('#range_'+id+' input').val(start.format('YYYY/MM/DD'));
		$('#datetime').attr('value',start.format('YYYY/MM/DD'));
	}

	var optionSet1 = {
		singleDatePicker: true,
		buttonClasses: ['btn btn-default'],
		applyClass: 'btn-small btn-primary',
		cancelClass: 'btn-small',
		format: 'YYYY/MM/DD',
		separator: ' to ',
		locale: {
			applyLabel: '确定',
			cancelLabel: '取消',
			fromLabel: '开始时间',
			toLabel: '结束时间',
			customRangeLabel: '自定义',
			daysOfWeek: ['日', '一', '二', '三', '四', '五', '六'],
			monthNames: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
			firstDay: 1
		}
	};
	$('#range_'+id+' input').val(moment().format('YYYY/MM/DD'));
	$('#range_'+id).daterangepicker(optionSet1, cb);	
}
function delDate(obj){
	obj.parent().parent().remove();		
}
</script>							
<include file="Common:footer" />