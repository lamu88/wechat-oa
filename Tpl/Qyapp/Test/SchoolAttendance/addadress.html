<include file="Common:header" />
<script language="javascript">
new PCAS("province3","city3","area3");
</script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=2b79c282b0f365ca9782cceb499e6022"></script>
<script src="./Tpl/Qyapp/Static/Js/artTemplate/dist/template.js" type="text/javascript"></script>
<script type="text/javascript" src="./Tpl/Qyapp/Public/Js/PCASClass.js" charset="utf-8"></script>
<!-- <script>
 $("#province").val("{lanrain:$data.province}");
 $("#city").val("{lanrain:$data.city}");
 $("#area").val("{lanrain:$data.area}");
$(function(){
  $("#submit").click(function() {
    var range = $("#range").val();
	var province = $("#province").val();
	var city = $("#city").val();
	var area = $("#area").val();
	var address = $("#address").val();
	var longitude = $("#longitude").val();
	var latitude = $("#latitude").val();
	$.ajax({
			type: "post",  
			url:"{lanrain::U('Attendance/editadress')}",
			dataType:'json',
			data:'long='+range+'&province='+province+'&city='+city+'&area='+area+'&address='+address+'&longitude='+longitude+'&latitude='+latitude+'&id={lanrain:$data.id}',
			success:function(json){
				var status = json.status;
				if(status==0){
					alert('设置成功');
					window.location.reload();
				}else{
					alert('设置失败');
				}

			}
		});
  });
  
})
</script>  -->
<section class="hbox stretch">
	<aside class="aside-md bg-white b-r" id="subNav">
<!-- 		<div class="wrapper b-b header"><b>微信考勤</b></div>
		<ul class="nav">
		
			 <li class="b-b b-light open"><a href="{lanrain::U('Attendance/index',array('mid'=>$_GET['mid']))}" target="_self"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>考勤设置</a></li>
			<li class="b-b b-light"><a href="{lanrain::U('Attendance/rule',array('mid'=>$_GET['mid']))}" target="_self"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>考勤规则</a></li>
			<li class="b-b b-light"><a href="{lanrain::U('Attendance/address',array('mid'=>$_GET['mid']))}" target="_self"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>考勤地点</a></li>
			<li class="b-b b-light"><a href="{lanrain::U('Attendance/tongji',array('mid'=>$_GET['mid']))}" target="_self"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>考勤统计</a></li>
						
			<li class="b-b b-light"><a href="{lanrain::U('Menu/menu',array('mid'=>$_GET['mid']))}" target="_self"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>自定义菜单</a></li>
			<li class="b-b b-light">
				<a href="{lanrain::U('Appmsg/conf',array('mid'=>$_GET['mid']))}" target="_self"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>应用管理</a>
			</li>
			
		</ul> -->
<include file="Attendance:navmenu" />			
	</aside> 
    <aside>
		<section class="vbox">
			<header class="header bg-white b-b b-light">
				<p>新增考勤地点</p>
				<a class="text-muted pull-right m-t pointer" data-toggle="back" href="javascript:history.go(-1)" title="返回"><i class="fa fa-reply"></i></a>
			</header>
			<section class="scrollable  wrapper">
				<section class="panel panel-default">
					<div class="panel-body">
						<form class="form-horizontal form-validate" method="post" target="_self" action="{lanrain::U('Attendance/addadress',array('mid'=>$_GET['mid']))}"> 
					   <!-- <input type="hidden" value="{lanrain:$data.id}" name="id" aria-invalid="false"> -->

							<div class="form-group">
								<label class="col-sm-2 control-label must">考勤范围</label>
								<div class="col-sm-4">
									<div class="input-group">
									  <input class="form-control valid" type="text" value="{lanrain:$data.long}" name="range" id="range" aria-invalid="false">
									  <div class="input-group-addon">米</div>
									</div>
								</div>
								<div class="col-sm-5">
									<span class="help-block form-control-static">（该范围内员工可以签到/签退）</span>
								</div>
							</div>
						   <div class="form-group">
								<label class="col-sm-2 control-label">企业所在地</label>
								<div class="col-sm-10">
									<div class="form-inline" data-toggle="location">

										<div class="form-group ">
											<div class="col-lg-12">
												<select  class="text tip" name="province3" id="province" title="请选择"  style="min-height:30px;"></select>
											</div></div>
										<div class="form-group ">
											<div class="col-lg-12">
												<select  class="text tip" name="city3" id="city" title="请选择"  style="min-height:30px;"></select>
												</div>
										</div>
										<div class="form-group ">
											<div class="col-lg-12">
												<select  class="text tip" name="area3" id="area" title="请选择"  style="min-height:30px;"></select>
												</div>
										</div>
									</div>

								</div>
							</div>
					
							<div class="form-group">
								<label class="col-sm-2 control-label">考勤地点</label>
								<div class="col-sm-4 ">
									<div class="input-group col-sm-8 pull-left">
										<input type="text" class="form-control js_map_key valid" data-rule-required="true" id="mapsearch" name="address" value="{lanrain:$data.address}" aria-required="true" aria-invalid="false">
										<span class="input-group-btn">
											<button class="btn btn-default js_map_search" type="button" onclick="GetAdd();">搜索</button>
										</span>
									</div> 
								</div>
									<div class="col-sm-4">
										<span class="help-block form-control-static">（这个只是模糊定位，准确位置请地图上标注!）</span>
									</div>					
								<!-- <label class="col-sm-4 control-label"></label> -->
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label must">地图标注</label>
								<div class="col-sm-10 js_map">
									<div class="clearfix">
										<div class="maroon pull-left m-t-sm">注意：请将准确位置在地图上标注，否则无法签到或签退!</div>
									</div>
									<div class="map_container js_map_container" id="allmap" style="overflow: hidden; position: relative; z-index: 0; color: rgb(0, 0, 0); text-align: left; background-color: rgb(243, 241, 236);" id="allmap">
									</div>
									<div class="col-sm-12">
										<div class="form-inline">
											<div class="form-group">
												<input type="text" class="form-control js_map_lat" data-rule-required="true" name="lng" id="point_x" value="{lanrain:$data.longitude}"   aria-required="true">
											</div>
											<div class="form-group">
												<input type="text" class="form-control js_map_lng" data-rule-required="true" name="lat"  id="point_y"  value="{lanrain:$data.latitude}"aria-required="true">
											</div>
										</div>
									</div>

								</div>
							</div>					
						
							<div class="form-group">
								<div class="col-sm-4 col-sm-offset-2">
									<input type="hidden" name="method" id="method" />
									<button type="submit" data-toggle="method" data-method="release" class="btn btn-primary" data-confirm="false" data-loading-text="保存中...">保存</button>
								</div>
							</div>
						</form>					
					</div>
				</section>
			</section>
		</section>
	</aside>
    </section>	
<script language="javascript">
new PCAS("province3","city3","area3");  
</script> 

<script>
var map = new BMap.Map("allmap");
var px=<empty name="wapinfo.point_x">116.403909<else/><#$wapinfo.point_x#></empty>;
var py =<empty name="wapinfo.point_y">39.915156<else/><#$wapinfo.point_y#></empty>;
var myGeo = new BMap.Geocoder();
map.addControl(new BMap.NavigationControl());  //添加默认缩放平移控件
map.enableScrollWheelZoom();
map.centerAndZoom(new BMap.Point(px, py), 15);
var marker1 = new BMap.Marker(new BMap.Point(px, py));  // 创建标注
marker1.enableDragging();    //可拖拽
// 将标注添加到地图中
marker1.addEventListener("click", showInfo);
marker1.addEventListener("dragend",showInfo);
function showInfo(e){
 $("#point_x").val(e.point.lng);
 $("#point_y").val(e.point.lat);
 var s=""+e.point.lng+","+e.point.lat+"";
 $("#point").val(s);
}
map.addOverlay(marker1);   
map.addEventListener("click", function(e){
	  	marker1.setPosition(e.point);
	    $("#point_x").val(e.point.lng);
	    $("#point_y").val(e.point.lat);
	    var s=""+e.point.lng+","+e.point.lat+"";
	    $("#point").val(s);
});
function GetAdd(){
	add=$('#mapsearch').val();
	myGeo.getPoint(add, function(point){
		  if (point) {
		    map.centerAndZoom(point, 16);
		    marker1.setPosition(point);
		    $("#point_x").val(point.lng);
		    $("#point_y").val(point.lat);
		    var s=""+point.lng+","+point.lat+"";
		    $("#point").val(s);
		  }else{
			  alert('没有找到匹配的坐标信息,请检查搜索的地址是否存在');
		  }
	}, "全国");
}
$(document).ready(function(){
	$('#web3g').trigger('click');
});
</script>

<include file="Common:footer" />