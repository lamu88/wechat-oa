<include file="Common:header" />
<link href="./Tpl/Qyapp/Static/Js/jstree/3.0.2/themes/default/style.min.css" rel="stylesheet">	
<link href="./Tpl/Qyapp/Static/Js/bootstrap/switch/docs/css/highlight.css" rel="stylesheet">		
<link href="./Tpl/Qyapp/Static/Js/bootstrap/switch/dist/css/bootstrap3/bootstrap-switch.min.css" rel="stylesheet">	
<link href="./Tpl/Qyapp/Static/Js/daterangepicker/daterangepicker-bs3.css" rel="stylesheet">	
<script src="./Tpl/Qyapp/Static/Js/jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="./Tpl/Qyapp/Static/Js/bootstrap/3.1.1/dist/js/bootstrap.min.js"></script>		
<script src="./Tpl/Qyapp/Static/Js/artTemplate/dist/template.js" type="text/javascript"></script>
<script src="./Tpl/Qyapp/Static/Js/jstree/3.0.2/jstree.min.js"></script>	
<script src="./Tpl/Qyapp/Static/Js/bootstrap/switch/docs/js/highlight.js" type="text/javascript"></script>	
<script src="./Tpl/Qyapp/Static/Js/bootstrap/switch/dist/js/bootstrap-switch.min.js" type="text/javascript"></script>
<script src="./Tpl/Qyapp/Static/Js/daterangepicker/moment.min.js" type="text/javascript"></script>
<script src="./Tpl/Qyapp/Static/Js/daterangepicker/daterangepicker.js" type="text/javascript"></script>
<div id="myModal" class="modal fade" tabindex="-2" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

</div>
<script type="text/javascript">
	$(document).ready(function() {
		var cb1 = function(start, end, label) {  
			//console.log(start.toISOString(), end.toISOString(), label);
			//$('#select_0 input').val(start.format('YYYY/MM/DD'));
			$('#select_0 input').attr('value',start.format('YYYY/MM/DD'));
		}
		var cb2 = function(start, end, label) {
			//console.log(start.toISOString(), end.toISOString(), label);
			//$('#select_3 input').val(start.format('YYYY/MM/DD') + ' - ' + end.format('YYYY/MM/DD'));
			$('#select_3 input').attr('value',start.format('YYYY/MM/DD') + ' - ' + end.format('YYYY/MM/DD'));
		}

		var optionSet1 = {
			singleDatePicker: true,
			ranges: {
				'今天': [moment(), moment()],
				'昨天': [moment().subtract('days', 1), moment().subtract('days', 1)],
				'最近7天': [moment().subtract('days', 6), moment()],
				'最近30天': [moment().subtract('days', 29), moment()],
				'这个月': [moment().startOf('month'), moment().endOf('month')],
				'上个月': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
			},
			buttonClasses: ['btn btn-default'],
			applyClass: 'btn-small btn-primary',
			cancelClass: 'btn-small',
			format: 'YYYY/MM/DD',
			separator: ' to ',
			locale: {
				applyLabel: '确定',
				cancelLabel: '取消',
				fromLabel: '开始时间',
				toLabel: '结束时间',
				customRangeLabel: '自定义',
				daysOfWeek: ['日', '一', '二', '三', '四', '五', '六'],
				monthNames: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
				firstDay: 1
			}
		};
		var optionSet2 = {
			startDate: moment().subtract('days', 29),
			endDate: moment(),
			dateLimit: {
				days: 60
			},
			showDropdowns: true,
			showWeekNumbers: true,
			timePicker: true,
			timePickerIncrement: 1,
			timePicker12Hour: true,
			ranges: {
				'今天': [moment(), moment()],
				'昨天': [moment().subtract('days', 1), moment().subtract('days', 1)],
				'最近7天': [moment().subtract('days', 6), moment()],
				'最近30天': [moment().subtract('days', 29), moment()],
				'这个月': [moment().startOf('month'), moment().endOf('month')],
				'上个月': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
			},
			opens: 'right',
			buttonClasses: ['btn btn-default'],
			applyClass: 'btn-small btn-primary',
			cancelClass: 'btn-small',
			format: 'YYYY/MM/DD',
			separator: ' to ',
			locale: {
				applyLabel: '确定',
				cancelLabel: '取消',
				fromLabel: '开始时间',
				toLabel: '结束时间',
				customRangeLabel: '自定义',
				daysOfWeek: ['日', '一', '二', '三', '四', '五', '六'],
				monthNames: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
				firstDay: 1
			}
		};		
		//按天查询
		//$('#select_0 input').val(moment().format('YYYY/MM/DD'));
		$('#select_0').daterangepicker(optionSet1, cb1);
		//$('#select_0').on('apply.daterangepicker', function(ev, picker) {
		//   $('form').submit(); 
		//});		
		//按月查询select_1
		//按时间段查询
		//$('#select_3 input').val(moment().subtract('days', 29).format('YYYY/MM/DD') + ' - ' + moment().format('YYYY/MM/DD'));
		$('#select_3').daterangepicker(optionSet2, cb2);	
		//$('#select_3').on('apply.daterangepicker', function(ev, picker) {
		//   $('form').submit(); 
		//});
	});
</script>
 
    <section class="hbox stretch">
		<aside class="aside-md bg-white b-r" id="subNav">
<!-- 			<div class="wrapper b-b header"><b>微信考勤</b></div>
			<ul class="nav">
			
				 <li class="b-b b-light open"><a href="{lanrain::U('Attendance/index',array('mid'=>$_GET['mid']))}" target="_self"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>考勤设置</a></li>
				<li class="b-b b-light"><a href="{lanrain::U('Attendance/rule',array('mid'=>$_GET['mid']))}" target="_self"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>考勤规则</a></li>
				<li class="b-b b-light"><a href="{lanrain::U('Attendance/address',array('mid'=>$_GET['mid']))}" target="_self"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>考勤地点</a></li>
				<li class="b-b b-light"><a href="{lanrain::U('Attendance/tongji',array('mid'=>$_GET['mid']))}" target="_self"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>考勤统计</a></li>
							
				<li class="b-b b-light"><a href="{lanrain::U('Menu/menu',array('mid'=>$_GET['mid']))}" target="_self"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>自定义菜单</a></li>
				<li class="b-b b-light">
					<a href="{lanrain::U('Appmsg/conf',array('mid'=>$_GET['mid']))}" target="_self"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>应用管理</a>
				</li>
				
			</ul> -->
<include file="Attendance:navmenu" />				
		</aside>        
        <aside>
            <section class="vbox">
                 <header class="header bg-white b-b clearfix">
					<form class="talbe-search" target="_self" method="post" action="">
                        <div class="row m-t-sm">						

                        <!-- <div class="col-sm-4 m-b-xs col-sm-offset-1"> -->						
                            <div class="col-sm-4 m-b-xs">
                                <div class="input-group">
                                    <div class="input-group-btn">
                                        <button class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
                                            <span class="dropdown-label" id="searchTypeTxt">按天查询</span>
                                            <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu dropdown-select js_select_search" id="searchTime">
                                            <li >
                                                <a href="javascript:void();">
                                                    <input type="radio" value="0" name="searchBy" checked="checked" />按天查询
                                                </a>
                                            </li>
                                            <li >
                                                <a href="javascript:void();">
                                                    <input type="radio" value="1" name="searchBy" />按月查询
                                                </a>
                                            </li>
                                            <li >
                                                <a href="#">
                                                    <input type="radio" value="2" name="searchBy" />按时间段查询
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="input-group js_show_date js_show_date_0 " id="select_0" >
										<input type="text" style="width:240px" class="form-control input-sm" id="myinput1" name="searchday" value="{lanrain:$searchday}" readonly="readonly"/>
										<!-- <span class="input-group-addon btn-sm"><i class="fa fa-calendar"></i></span> -->
									</div>
															
                                    <select class="js_show_date js_show_date_1 input-sm form-control btn-s-sm hide" id="select_1" name="monthy" style="margin-left:10px;width:100px;" value="{lanrain:$monthy}">
									    <option value="" >年份</option>									
									    <option value="2014" >2014</option>
                                        <option value="2015" >2015</option>
                                        <option value="2016" >2016</option>
                                        <option value="2017" >2017</option>
                                        <option value="2018" >2018</option>
                                        <option value="2019" >2019</option>
                                        <option value="2020" >2020</option>
                                        <option value="2021" >2021</option>										
                                    </select>
                                    <select class="js_show_date js_show_date_1 input-sm form-control btn-s-sm hide" id="select_2" name="monthm" style="margin-left:10px;width:100px;" value="{lanrain:$monthm}">
                                        <option value="" >月份</option>									
                                        <option value="1" >1</option>
                                        <option value="2" >2</option>
                                        <option value="3" >3</option>
                                        <option value="4" >4</option>
                                        <option value="5" >5</option>
                                        <option value="6" >6</option>
                                        <option value="7" >7</option>
                                        <option value="8" >8</option>
                                        <option value="9" >9</option>
                                        <option value="10" >10</option>
                                        <option value="11" >11</option>
                                        <option value="12" >12</option>
                                    </select> 
                                    <div class="input-group js_show_date js_show_date_2 hd" id="select_3">
										<input type="text" style="width:220px" id="myinput2" class="form-control input-sm" name="searchmoment" value="{lanrain:$searchmoment}" readonly="readonly" data-toggle="daterangepicker"/>
										<!-- <span class="input-group-addon btn-sm"><i class="fa fa-calendar"></i></span> -->
									</div>  
                                </div>		
                            </div>	
							<button class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" style="height:30px; width:50px;" onclick="searchInfo();">
								<span class="dropdown-label" ><i class="fa fa-search"></i></span>  
							</button>	
							<script>
							$('#clickSearch').css('cursor','hand');
							var searchday = "{lanrain:$searchday}";
							var monthy = "{lanrain:$monthy}";
							var monthm = "{lanrain:$monthm}";
							var searchmoment = "{lanrain:$searchmoment}";
							var username = "{lanrain:$username}";
							var departname = "{lanrain:$departname}";
							if(searchday != ''){
								$('#searchTypeTxt').html('按天查询');
								$('#select_0').css('display','table');
								$('#select_1').css('display','none');
								$('#select_2').css('display','none');	
								$('#select_3').css('display','none');								
							}else if(monthy != '' && monthm != ''){
								$('#searchTypeTxt').html('按月查询');									
								$('#select_0').css('display','none');
								$('#select_1').removeClass('hide');
								$('#select_1').css('display','inline-block');
								$('#select_2').removeClass('hide');										
								$('#select_2').css('display','inline-block');										
								$('#select_3').css('display','none');
								$('#select_1 option').each(function(){
									if($(this).attr('value') == monthy){
										$(this).attr('selected',true);
									}								
								});
								$('#select_2 option').each(function(){
									if($(this).attr('value') == monthm){
										$(this).attr('selected',true);
									}								
								});							
							}else if(searchmoment != ''){
								$('#searchTypeTxt').html('按时间段查询');									
								$('#select_0').css('display','none');	
								$('#select_1').css('display','none');
								$('#select_2').css('display','none');	
								$('#select_3').css('display','block');							
							}else{
								$('#searchTypeTxt').html('按天查询');							    
							}
							
							if(username != ''){
								$('#searchTypeTxt1').text('按用户名查询');
								$('#searchUsername').css('display','block');
								$('#searchDepartname').css('display','none');							
							}else if(departname != ''){
								$('#searchTypeTxt1').text('按部门名称查询');
								$('#searchDepartname').css('display','block');
								$('#searchUsername').css('display','none');								
							}else{
								$('#searchTypeTxt1').text('按用户名查询');							
							}
							$('#searchTime li').each(function(){
								$(this).click(function(){
								    var val = $(this).children().find('[name = searchBy]:radio').attr('value');
									if(val == 0){
									    $('#searchTypeTxt').html('按天查询');
									    $('#select_0').css('display','table');
									    $('#select_1').css('display','none');
									    $('#select_2').css('display','none');	
									    $('.js_show_date_2').css('display','none');											
									}else if(val == 1){
									    $('#searchTypeTxt').html('按月查询');									
									    $('#select_0').css('display','none');
										$('#select_1').removeClass('hide');
									    $('#select_1').css('display','inline-block');
										$('#select_2').removeClass('hide');										
									    $('#select_2').css('display','inline-block');										
									    $('.js_show_date_2').css('display','none');											
									}else if(val == 2){
									    $('#searchTypeTxt').html('按时间段查询');									
									    $('#select_0').css('display','none');	
									    $('#select_1').css('display','none');
									    $('#select_2').css('display','none');	
									    $('.js_show_date_2').css('display','block');											
									}
								});
							}); 
							</script>	
							
							 <a class="btn btn-default" href="index.php?g=Qyapp&m=Attendance&a=exportSN&id={lanrain:$Think.get.id}" target="_self" style="display:black; float:right;margin-right:20px;">导出数据</a>
                        </div>
						
                        <input type="hidden" name="pageNumber" id="pageNumber" value="1" />
                        <input type="hidden" name="orderBy" id="orderBy" value="desc"/>
                        <input type="hidden" name="order" id="order" value="time" />
                        <script>  
						function searchInfo(){
						   $('form').submit();						   
						}									
                        </script>											
                    </form>
                </header>
                <section class="scrollable  wrapper">
                    <section class="panel panel-default">
                         <div class="table-responsive">
                            <table class="table table-hover m-b-none entity-view">
                                <colgroup>
                                <col style="width:10%" />
                                <col style="width:20%" />
                                <col style="width:20%" />
                                <col style="width:15%" />
                                <col style="width:15%" />
                                <col style="width:10%" />
                                </colgroup>						
                                <thead>
                                    <tr>
                                        <!-- <th>部门</th> -->
										<th>姓名</th>
										<th>部门</th>
                                        <th>签到</th>
                                        <th>签退</th>	
										<th>签到地点</th>										
										<th>迟到</th>
										<th>早退</th>
                                        <!-- <th>状态</th> -->
                                    </tr>
                                </thead>
                                <tbody id="mytable">
								<if condition="$arr">								
								<volist name="arr" id='vo'>
                                    <tr id="{lanrain:$vo.id}">
                                        <!-- <td class="nodata">{lanrain:$vo.id}</td> -->
                                        <td>{lanrain:$vo.name}</td>
                                        <!--<td> <if condition="$vo['creatime']">{lanrain:$vo.creatime|date="Y-m-d H:i",###}<else/>{lanrain:$vo.creatime} &nbsp;</if> </td>-->
										<td>{lanrain:$department}</td>
                                        <td>{lanrain:$vo.creatime}</td>
										<td>{lanrain:$vo.outtime}</td>
										<td>{lanrain:$vo.place}</td>
										<if condition="!empty($vo['latime'])">	
										<td>{lanrain:$vo.latime}分钟</td>
										<else/>
										<td>无</td>
										</if>
										<if condition="!empty($vo['earlytime'])">	
										<td>{lanrain:$vo.earlytime}分钟</td>
										<else/>
										<td>无</td>
										</if>
										<!--<td><img src="{lanrain:$vo.creatmind}" width="25px" height="25px" style="margin-right:10px"><span>{lanrain:$vo.word}</span></td>-->					
                                    </tr>
                                </volist> 
								<else/>
								<tr><td colspan='10' class="nodata">暂无信息</td></tr>                            
								</if>								
								</tbody>
                            </table>
                        </div>
                    </section>
                </section>
      <footer class="footer bg-white b-t">
                    <div class="row text-center-xs">
                        <div class="col-md-6 hidden-sm">
                            <!--<p class="text-muted m-t">{lanrain:$page}</p>-->
								<span>总签到数：{lanrain:$ctime}天</span>&nbsp;&nbsp;
							    <span>总签退数：{lanrain:$otime}天</span>&nbsp;&nbsp;								
								<span>迟到总数：{lanrain:$latetime}小时</span>&nbsp;&nbsp;
								<span>早退总数：{lanrain:$earlytime}小时</span> 
                        </div>
						
                        <div class="col-md-6 col-sm-12 text-right text-center-xs">
                           <p class="text-muted m-t">{lanrain:$page}</p>
                        </div>
                    </div>
                </footer>
            </section>
        </aside>
    </section> 
	
<section class="entity-panel hd" id="info">
</section>	
<script src="./Tpl/Qyapp/Static/Js/weiyi.js" type="text/javascript"></script>							
<include file="Common:footer" />