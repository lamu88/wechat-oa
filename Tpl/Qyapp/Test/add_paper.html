<include file="Common:header" />
<link href="./Tpl/Qyapp/Static/Js/datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
<script src="./Tpl/Qyapp/Static/Js/datetimepicker/js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>	
<script src="./Tpl/Qyapp/Static/Js/datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>
<link href="./Tpl/Qyapp/Static/Js/jstree/3.0.2/themes/default/style.min.css" rel="stylesheet">
<script src="./Tpl/Qyapp/Static/Js/jstree/3.0.2/jstree.min.js"></script>
<script>
$(document).ready(function(){
	$('.b-light').click(function(){
		$('.b-light').removeClass('open');	
		$(this).addClass('open');
	});
	
	  
});
</script>
<section class="hbox stretch">
    <aside class="aside-md bg-white b-r" id="subNav">
<!--         <div class="wrapper b-b header"><b>考试</b></div>
        <ul class="nav">
			<li class="b-b b-light">
                <a href="{lanrain::U('Test/index',array('id'=>$_GET['id']))}"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>试卷管理</a>
            </li>
			<li class="b-b b-light">
                <a href="{lanrain::U('Test/lists',array('id'=>$_GET['id']))}"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>用户管理</a>
            </li>		
            <li class="b-b b-light">
                <a href="{lanrain::U('Test/test_question',array('id'=>$_GET['id']))}"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>题库管理</a>
            </li>			
			<li class="b-b b-light"><a href="{lanrain::U('Menu/menu',array('id'=>$_GET['id']))}"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>自定义菜单</a></li>
            <li class="b-b b-light">
                <a href="{lanrain::U('Appmsg/conf',array('id'=>$_GET['id']))}"><i class="fa fa-chevron-right pull-right m-t-xs text-xs icon-muted"></i>应用管理</a>
            </li>
            
        </ul> -->
				<include file="Test:navmenu" />
    </aside>

    <aside>
	
	
<section class="vbox">
    <header class="header bg-white b-b b-light">
        <p>新增试卷</p>
        <a class="text-muted pull-right m-t pointer" data-toggle="back" href="javascript:history.go(-1)" title="返回"><i class="fa fa-reply"></i></a>
    </header>
    <section class="scrollable  wrapper">
        <section class="panel panel-default">
            <div class="panel-body">
                <form class="form-horizontal form-validate" method="post"  target="_self" action="{lanrain::U('Test/index',array('mid'=>$_GET['mid']))}">
                 <!-- <input type="hidden" name="id" value='{lanrain:$info.id}'>  -->
                     <div class="form-group">
                        <label class="col-sm-2 control-label">试卷类型</label>
                        <div class="col-sm-3 ">
                                <div class="input-group">
                                    <div class="input-group-btn">
                                        <button class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
                                            <span class="dropdown-label" id="searchTypeTxt">题数</span>
                                            <span class="caret"></span>
                                        </button>
                                       <ul class="dropdown-menu dropdown-select js_select_search" id="searchMenu">
                                             <li >
                                                <a href="javascript:void();">分数</a>
                                            </li> 
                                            <li >
                                                <a href="javascript:void();">题数</a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="input-group js_show_date js_show_date_0 " id="select_4" >
										<!-- <input type="text" class="form-control input-sm" name="condition" id="inputFen" value="" placeholder="10"/>
										<input type="text" class="form-control input-sm" style="display:none;" name="condition" id="inputTi" value="" placeholder="100"/> -->
										<input type="text" class="form-control input-sm" name="condition" id="inputTi" value="" placeholder="100"/>										
                                        <input type="hidden" name="type" id="type" value='{lanrain:$info.type}'> 										
										<div class="input-group-addon btn-sm"  id="ti">题</div>
										<!-- <div class="input-group-addon btn-sm"  id="ti">题</div>		
										<div class="input-group-addon btn-sm" id="fen" style="display:none;">分</div> -->										
									</div>			
                                </div>
                        </div>
                    </div> 
					<script>
					$('#searchMenu li').each(function(){
					    $(this).click(function(){
							var text = $(this).children().text();
							//alert(text);
							if(text == '分数'){
							    $('#type').attr('value',1);
							    $('#searchTypeTxt').text('分数');
								$('#ti').text('分');							
							}else if(text == '题数'){	
							    $('#type').attr('value',2);
							    $('#searchTypeTxt').text('题数');
								$('#ti').text('题');																
							}
						});;
					});
					</script>
					<div class="form-group">
                        <label class="col-sm-2 control-label">试卷标题</label>

                        <div class="col-sm-3 ">
                            <input type="text" class="form-control" placeholder="" value="{lanrain:$info.title}" name="title" data-rule-maxlength="30" />							
                        </div>
                        <div class="col-sm-4 ">
							<p class="form-control-static"> 如三年级上学期语文测试题 </p>						
                        </div>						
                    </div>
				 
					<div class="form-group">
                        <label class="col-sm-2 control-label must">考试开始时间</label>

                        <div class="col-sm-3">
                            <div class="input-group">
                                <input type="text" class="form-control mydate" id="starttime" name="starttime" value="<if condition="$info neq ''">{lanrain:$info.starttime|date="Y-m-d",###}</if>" data-minutestep="5" data-rule-required="true" data-position="top-left"  readonly="readonly" data-toggle="datetimepicker" /><span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label must">考试结束时间</label>
                        <div class="col-sm-3">
                            <div class="input-group">
                                <input type="text" class="form-control mydate" id="endtime" name="endtime" value="<if condition="$info neq ''">{lanrain:$info.endtime|date="Y-m-d",###}</if>" data-minutestep="5" data-rule-required="true"  readonly="readonly"   data-toggle="datetimepicker" /><span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                            </div>
                        </div>					
                    </div>
                    <div class="js_append_div">
                    </div>
					<script type="text/javascript">
						$(".mydate").datetimepicker({
							format: 'yyyy-mm-dd hh:ii',
							language: 'zh-CN',	
						});
					</script>
					<div class="form-group">
                        <label class="col-sm-2 control-label">重复考试次数</label>

                        <div class="col-sm-3 ">
                            <input type="text" class="form-control" placeholder="" value="{lanrain:$info.sum}" name="sum" data-rule-maxlength="30" />
						
                        </div>
                        <div class="col-sm-4 ">
							<p class="form-control-static"> 填写数字表示次数，不填或填0则次数不限 </p>						
                        </div>						
                    </div>	
                     <div class="form-group">
						<label class="col-sm-2 control-label must">发送范围</label>
						<div class="col-sm-4">
							  <input type="text" class="form-control" value="{lanrain:$data.range}" id="selects" name="range" onclick="address('1','selects','n')" placeholder="+选择部门人员"/>
							  <input type="hidden" class="form-control" value="" id="depart" name="departid"/>
						</div>
					</div>	 
					
					<div class="modal fade bs-modal-lg" id="range" tabindex="-1" role="dialog" aria-hidden="true">
						<div class="modal-dialog" style="width:760px;">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
									<h4 class="modal-title">选择范围</h4>
								</div>
								<div class="modal-body" style="padding-bottom:0px;">	
									<div class="row">
										<div class="col-md-12" id="selectObj" style="margin-top:-20px;">													
										
										
										</div>
									</div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-primary" id="queding" onclick="queding1()" data-id="" data-num="">确定</button>									
									<button type="button" data-dismiss="modal" class="btn btn-default">取消</button>
								</div>
							</div>
						</div>
					</div>	
<script>
function expSelect(){
    if($('select[name="experience"]').val() == 'set'){
	    $('#exphide').removeClass('hide');
	}else{
	    $('#exphide').addClass('hide');
	}
}
$('.js_select_money').on('change',function(){
    if($(this).val() == 0){
	    $(this).parent().siblings('.col-sm-1').css('display','block');
		$(this).parent().siblings('.col-sm-3').css('display','block');
		$(this).parent().siblings('.col-sm-3').children().children().css('display','inline');
	}else if($(this).val() == 1){
	    $(this).parent().siblings('.col-sm-1').css('display','block');
		$(this).parent().siblings('.col-sm-3').css('display','block');
		$(this).parent().siblings('.col-sm-3').children().children().css('display','none');	
	}else if($(this).val() == 2){
	    $(this).parent().siblings('.col-sm-1').css('display','none');
		$(this).parent().siblings('.col-sm-3').css('display','none');
	}
});
function queding1(){
	$("#range").modal('hide');
	var id = $('#queding').attr('data-id');
	var num = $('#queding').attr('data-num');	
	//$('#list-'+id+' div.bg-circle').remove();
	var dept_id = '';
	var dept_name = '';
	var follow = '';
	var users_id = '';
	var users_name = '';
	$('#selected-dept li').each(function(){
		var id_1 = $(this).attr('id');
		var str_1 = id_1.replace('selected-dept-','');		
		var dept_name = $('#selected-dept-name-'+str_1).text().replace(/[\r\n]/g,"").trim();
		follow += dept_name+' ';			
		users_id += id_1+',';
	});		
	$('#selected-users li').each(function(){
		var id_2 = $(this).attr('id');
		var str_2 = id_2.replace('selected-users-','');		
		var users_name = $('#selected-users-name-'+str_2).text().replace(/[\r\n]/g,"").trim();
		follow += users_name+' ';			
		users_id += id_2+',';
	});	 		
	$('#selects').attr('value',follow);
	//$('#selects').html(follow);
	$('#depart').attr('value',users_id);
}
function address(type,id,num){
	$("#range").modal('show');
	$('#queding').attr('data-id',id);
	$('#queding').attr('data-num',num);
	var selected = $('#'+id).attr('value');
	$('#selectObj').load("{lanrain::U('Common/address',array('type'=>'"+type+"','sign'=>'"+id+"','selected'=>'"+selected+"'))}");
}
String.prototype.trim=function() {
	return this.replace(/(^\s*)|(\s*$)/g,'');
}	
</script>				
                    <div class="form-group">
                        <label class="col-sm-2 control-label">提示答案</label>
                        <div class="col-sm-1">
                            <div class="pull-left m-t-sm" id="mySwitch" style="width:500px;"> 
							是<input   type="radio" name="is_tip"  value="2" <if condition="$info.is_radio eq 0">checked</if> >
							<span>否<input type="radio" name="is_tip"   value="1" <if condition="$info.is_radio eq 1">checked</if> ></span>
                            </div>
                        </div>		
                    </div>
									

                    <div class="form-group">
                        <div class="col-sm-4 col-sm-offset-2">
                        <div class="col-sm-4 col-sm-offset-2">
							<button class="btn btn-primary" data-loading-text="保存中..." type="submit">保存</button>
                        </div>
                    </div>
                </form>
            </div>
        </section>
    </section>
</section>
		
		
    </aside>
</section>
		  
</section>
   <div id="myModal" class="modal fade" tabindex="-2" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

  </div>
<script>
function openModel(){
    $('#depart').attr("value",'');
	$('#departId').attr("value",'');
	
	$('#myModal').load("{lanrain::U('Tree/myTree')}", function(){
		 $('#myModal').modal();
	});	
}

function cancel(){
    $('#depart').attr("value",'');
	$('#departId').attr("value",'');
	$('#myModal').modal('hide');
    $('#myModal').empty();
}

function guanbi(){
    $('#myModal').modal('hide');
    $('#myModal').empty();
}
</script>
<div class="msgbox"></div>
<include file="Common:footer" />