<include file="Common:header" />
	<link href="./Tpl/Qyapp/Static/Js/jstree/3.0.2/themes/default/style.min.css" rel="stylesheet">
	<script src="./Tpl/Qyapp/Static/Js/jstree/3.0.2/jstree.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./Tpl/Qyapp/Static/Js/autocomplete/src/jquery.autocomplete.css">	
	<script src="./Tpl/Qyapp/Static/Js/artTemplate/dist/template.js" type="text/javascript"></script>
	<script type="text/javascript" src="./Tpl/Qyapp/Static/Js/autocomplete/src/jquery.autocomplete.js"></script>	
    <script src="./Tpl/Qyapp/Static/Js/autocomplete/test/test.js"></script>
    <link href="./Tpl/Qyapp/Static/Js/autocomplete/lib/google-code-prettify/prettify.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="./Tpl/Qyapp/Static/Js/autocomplete/lib/google-code-prettify/prettify.js"></script>
    <script type="text/javascript" src="./Tpl/Qyapp/Static/Js/autocomplete/lib/google-code-prettify/beautify.min.js"></script>	
	<script charset="utf-8" src="./Tpl/static/kindeditor/kindeditor-min.js"></script>
	<script charset="utf-8" src="./Tpl/static/kindeditor/lang/zh_CN.js"></script>
	<link rel="stylesheet" href="./Tpl/static/kindeditor/themes/default/default.css" />
	<link rel="stylesheet" href="./Tpl/Qyapp/Static/Css/uploadify.min.css" />
	<script type="text/javascript">
		KindEditor.ready(function(K) {
			var editor;
			editor = K.create('textarea[name="content"]', {
				resizeType : 0,
				allowPreviewEmoticons :false,
				allowImageUpload :true,
				uploadJson:'/index.php?g=Qyapp&m=Adminupload&a=uploadType&is_url=1&file_type=image',
				formatUploadUrl:false,
				items : [
					'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold', 'italic', 'underline',
					'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
					'insertunorderedlist', '|', 'emoticons', 'image', 'link']
			});		
		});	
	</script>
	<script type="text/javascript">
		KindEditor.ready(function(K) 
		{
			var editor = K.editor({
				allowFileManager : false,
				uploadJson:'/index.php?g=Qyapp&m=Adminupload&a=uploadType&is_url=1&file_type=image',
				formatUploadUrl:false
			});	
			K('#apiclient_cert_p12').click(function() {

				editor.loadPlugin('image', function() {
					editor.plugin.imageDialog({
						showRemote : false,
						imageUrl : K('#url3').val(),
						clickFn : function(url, title, width, height, border, align) {
							$('#icon').val(url);					
							$('#preicon').attr('src',url);		
							editor.hideDialog();
						}
					});
				});
			});			
		});
	</script>	
	<script type="text/javascript">
		KindEditor.ready(function(K) 
		{
			var editor = K.editor({
				allowFileManager : false,
				uploadJson:'/index.php?g=Qyapp&m=Adminupload&a=uploadType&is_url=1&file_type=image',
				formatUploadUrl:false
			});	
			K('#apiclient_cert').click(function() {

				editor.loadPlugin('image', function() {
					editor.plugin.imageDialog({
						showRemote : false,
						imageUrl : K('#url3').val(),
						clickFn : function(url, title, width, height, border, align) {
							$('#icon2').val(url);					
							$('#preicon').attr('src',url);		
							editor.hideDialog();
						}
					});
				});
			});			
		});
	</script>
<script type="text/javascript">
		KindEditor.ready(function(K) 
		{
			var editor = K.editor({
				allowFileManager : false,
				uploadJson:'/index.php?g=Qyapp&m=Adminupload&a=uploadType&is_url=1&file_type=image',
				formatUploadUrl:false
			});	
			K('#apiclient_key').click(function() {

				editor.loadPlugin('image', function() {
					editor.plugin.imageDialog({
						showRemote : false,
						imageUrl : K('#url3').val(),
						clickFn : function(url, title, width, height, border, align) {
							$('#icon3').val(url);					
							$('#preicon').attr('src',url);		
							editor.hideDialog();
						}
					});
				});
			});			
		});
	</script>
	<script type="text/javascript">
		KindEditor.ready(function(K) 
		{
			var editor = K.editor({
				allowFileManager : false,
				uploadJson:'/index.php?g=Qyapp&m=Adminupload&a=uploadType&is_url=1&file_type=image',
				formatUploadUrl:false
			});	
			K('#rootca').click(function() {

				editor.loadPlugin('image', function() {
					editor.plugin.imageDialog({
						showRemote : false,
						imageUrl : K('#url3').val(),
						clickFn : function(url, title, width, height, border, align) {
							$('#icon4').val(url);					
							$('#preicon').attr('src',url);		
							editor.hideDialog();
						}
					});
				});
			});			
		});
	</script>
	</head>	

	
	<section class="hbox stretch">
		<aside class="aside-md bg-white b-r" id="subNav">
		<include file="Bonus:navmenu" />		
		</aside>
        <aside>
			<section class="vbox">
				<header class="header bg-white b-b b-light">
					<p>红包设置</p>
					<a class="text-muted pull-right m-t pointer" data-toggle="back" href="javascript:history.go(-1)" title="返回"><i class="fa fa-reply"></i></a>
				</header>
				<section class="scrollable  wrapper">
					<section class="panel panel-default">
						<div class="panel-body">
							<form class="form-horizontal form-validate" method="post" target="_self" action="{lanrain::U('Bonus/index',array('mid'=>$_GET['mid']))}">
								<div class="form-group">
									<label class="col-sm-2 control-label must">商户号</label>
									<div class="col-sm-3 ">
										<input class="form-control" data-rule-required="true" type="text" value="{lanrain:$conf.name}" name="name" id="name" />
								    </div>
								</div>
								<div class="form-group">
									<label class="col-sm-2 control-label must">支付密钥</label>
									<div class="col-sm-3 ">
										<input class="form-control" data-rule-required="true" type="text" value="{lanrain:$conf.key}" name="key" id="key" />
								    </div>
								</div>
								<div class="form-group">
									<label class="col-sm-2 control-label must">Appid</label>
									<div class="col-sm-3 ">
										<input class="form-control" data-rule-required="true" type="text" value="{lanrain:$conf.Appid}" name="Appid" id="icon"/>                            
                                    </div>
									
									
									
								</div>							
								<div class="form-group">
									<label class="col-sm-2 control-label must">Appsecret</label>
									<div class="col-sm-3 ">
										<input class="form-control" data-rule-required="true" type="text" value="{lanrain:$conf.Appsecret}" name="Appsecret" id="icon2"/>                            
                                    </div>
									
									
								</div>	
								
								
								<div class="line line-dashed line-lg pull-in"></div>
								<div class="form-group">
									<div class="col-sm-4 col-sm-offset-2">

										<button type="submit" class="btn btn-primary" data-alert="true"  data-loading-text="保存中...">保存</button>
										<button type="button" class="btn btn-default"  data-toggle="back" onclick="javascript:history.go(-1)">取消</button>
									</div>
								</div>
							</form>
						</div>
					</section>
				</section>
			</section>
	    <aside>
	</section>
	<script>
    var i = 0;	
	var j = $('.js_audit_div').find('.form-group').attr('data-num');
	function addField(){
		var m = ++i;
		var data = {
		m: m,
		};	
		var html = template('js_custom_fields_tem', data);
		$('#js_custom_fields').append(html);
	}						 
	function selectType(obj){
		
		if(obj.parent().parent().find(':last-child').hasClass('col-sm-7')){
			obj.parent().siblings(':last').remove();
		}						
		index = obj.attr('id');
		var data = {	
		index: index,
		};	
		var val = obj.find('option:selected').val();							
		if(val == 5){
			if(!obj.parent().parent().find(':last-child').hasClass('col-sm-offset-2')){
				var html = template('js_field_select_tem',data);
				obj.parent().parent().append(html);								
			}
			
		}
	}
	function delField(obj){
		obj.parent().parent().remove();
	}
	function addLevel(){
		var id = ++j;
		var data = {
		index: id,
		};	
		var html = template('js_audit_tem', data);
		$('.js_audit_div').append(html);
	}
	function delLevel(obj){
	    //alert('tttt');
		obj.parent().parent().remove();
	}	
	function selectAudit(obj){
		if(obj.parent().parent().find(':last-child').hasClass('col-sm-3')){
			obj.parent().siblings(':last').remove();
		}						
		var id = obj.parent().parent().attr('data-num');
		var data = {	
		index: id,
		};	
		var val = obj.find('option:selected').val();							
		if(val == 3){
			if(!obj.parent().parent().find(':last-child').hasClass('col-sm-3')){
				var html = template('js_add_select',data);
				obj.parent().parent().append(html);								
			}
			
		}	
		selectAuto();
	}

	function selectAuto(){
		 $.ajax({
			type:"POST",
			url:"index.php?g=Qyapp&m=Common&a=searchUsers&mid={lanrain::$_GET['mid']}",
			//data:"id="+id,
			dataType:'json',
			success:function(json){
			var status = json.status;
			  if(status==1)
			  {
			    var data = json.data;
                //alert(data);				
				$('#autoComplete div.form-group').each(function(){
					var Obj = $('#autoComplete div.form-group').find('div.col-sm-3 input');
					Obj.AutoComplete({
						'data': data,
						'width':225,
						'listStyle': 'custom',
						'maxHeight': 240,
						'createItemHandler': function(index, data){
							var div = $("<div style='height:36px;padding-top:2px'></div>")
							var cell1 = $("<div style='display:table-cell;vertical-align:top;'></div>").appendTo(div);
							var cell1_1 = $("<img style='width:32px;height:32px;'></img>").attr('src', data.image).appendTo(cell1);
							var cell2 = $("<div style='display:table-cell;vertical-align:middle;padding-right:10px'></div>").appendTo(div);
							var cell2_1 = $("<div></div>").append(data.label).appendTo(cell2);
							var cell2_2 = $("<div style='vertical-align:top;'></div>").appendTo(cell2);
							return div;
						}
					});
					//alert('aaaaaaaaaaaaaa');
				});				
			  }
			  else
			  {
				  alert('删除失败');
			  }
			}
		}); 
			
	}	
	
	//function openModel1(){
	//    $('#myModal').load("{lanrain::U('Common/department')}",function(){
	//	$('#myModal').modal();
	//	$('#departname').attr("value",'');
	//	$('#departid').attr("value",'');		
	//	});
	//}
	
	function openModel(){
		$('#depart').attr("value",'');
		$('#departId').attr("value",'');
		
		$('#myModal').load("{lanrain::U('Tree/myTree')}", function(){
			 $('#myModal').modal();
		});	
	}	

	function cancel(){
		$('#depart').attr("value",'');
		$('#departId').attr("value",'');
		$('#myModal').modal('hide');
		$('#myModal').empty();
	}

	function guanbi(){
	    var departname = $('#departname').attr('value');
	    var departid = $('#departid').attr('value');
        $('#mydepart').attr('value',departname);
        $('#mydepartid').attr('value',departid);		
		$('#myModal').modal('hide');
		$('#myModal').empty();
	}

	</script>
	<script>
	$('body').on('change','.js_select_people1',function(){
	    var auditname = $(this).val();
		 $.ajax({
			type:"POST",
			url:"index.php?g=Qyapp&m=Common&a=isExist",
			data:"auditname="+auditname,
			dataType:'json',
			success:function(json){
			var status = json.status;
			  if(status==1)
			  {
			    return true;
			    //var data = json.data;	
                //alert('该审核人不存在，请输入正确的审核人');				
			  }
			  else
			  {
				  alert('该审核人不存在，请输入正确的审核人');
			  }
			}
		}); 
	});
	</script>
	<script type="text/javascript">
    $('.icon').click(function(){
	    var pic = $(this).find('img').attr('src');
		$('#icon').attr('value',pic);
		$('#preicon').attr('src',pic);	
		$('#iconModal').modal('hide');
		
	});
    </script>	
<include file="Common:footer" />