<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../Tpl/Qyapp/Bonus/css/style.css">
    <script src="../Tpl/Qyapp/Bonus/js/t-slider.js"></script>
	<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<style>
.item-span{font-size: 16px;font-family: microsoft yahei;height: 45px;line-height: 45px;color: #444;}
#add-con{color: #535353;font-size: 14px;font-family: "arial","微软雅黑";background: #fff;width: 100%;overflow: hidden;width: 100%;min-height: 100%;background: #e5e5e5;position: absolute;top: 0;left: 0;z-index: 999;overflow-x: hidden;overflow-y: auto;padding-bottom: 20px;}
.address-content{color: #535353;font-size: 14px;font-family: "arial","微软雅黑";background: #fff;width: 100%;overflow: hidden;width: 100%;min-height: 100%;background: #e5e5e5;position: absolute;top: 0;left: 0;z-index: 999;overflow-x: hidden;overflow-y: auto;padding-bottom: 20px;}
.letter{font-size:16px;height:24px;width:16%;float:left;background-color:#fff;margin:1px;padding:12px 0px 10px 0px;text-align:center;}
.img-status{display:none;}
.bg-circle{float:left;width:40px; border-radius:50%;height:40px; line-height:40px;margin-right:3px;margin-bottom:6px;overflow:hidden;}
.bg-circle-a{float:left;width:40px;height:40px; line-height:40px;margin-right:3px;margin-bottom:6px;overflow:hidden;}
.bg-text{height:40px; line-height:40px; display:block; color:#FFF; text-align:center;font-size:12px;}
</style>	
</head>
<body style="position:relative;">
<!--sec-tou start-->
<section class="sec-tou">
    <img class="bg" src="../Tpl/Qyapp/Bonus/images/bg.png">
    <article>
        <a href="">
            <img src="../Tpl/Qyapp/Bonus/images/01.jpg">
            <div class="txt">joann | 行政 | 行政部</div>
        </a>
    </article>
</section>
<!--sec-tou end-->
<!--sec-main start-->
<section class="sec-main">
    <div id="tabBox1" class="tabBox">
        <div class="hd">
            <ul>
                <li>普通</li>
                <li>拼手气</li>
            </ul>
        </div>
        <div class="bd" id="tabBox1-bd"><!-- 添加id，js用到 -->
            <div class="con"><!-- 高度自适应需添加外层 -->
                <ul>
                    <li><div class="c"><label>单个金额</label><span>元</span> <input id="mon" type="text" placeholder="请填写单个金额" value="" onblur="mon($(this))"><div class="clear"></div></div></li>

                    <li><div class="c"><label>红包个数</label><span>个</span> <input type="text" id="num" value="" placeholder="请填写个数" onblur="num($(this))"><div class="clear"></div></div></li>
                    <li><div class="c"><input type="text" placeholder="恭喜发财，万事如意！" id="info" name="info"  value="恭喜发财，万事如意！" class="input1"></div></li>
                    <li>
                        <div class="c">
                            <div class="t">请选择人员或部门：</div>
                            <div class="cc">
                                <span class="span"><img src="images/01.jpg"><i>-</i></span>
                                <a href="javascript:;"onclick="address('1','follow','n')" id="add-follow"><img src="images/721-01.png"></a>
                                <input type="hidden" name="touser" id="follow" value=""/>
								<div class="clear"></div>
                            </div>
                        </div>
                    </li>
                    <li class="money">￥<span id="monn"> 0.00</span></li>
                </ul>
            </div>
            <div class="con"><!-- 高度自适应需添加外层 -->
                <ul>
                    <li><div class="c"><label>总金额</label><i class="i">拼</i><span>元</span> <input id="mon1" type="text" value="" placeholder="请填写单个金额" onblur="mon1($(this))"><div class="clear"></div></div></li>
                    <li class="li-t">小伙伴们将随机获得红包金额</li>
                    <li><div class="c"><label>红包个数</label><span>个</span> <input type="text" id="num1" value="" placeholder="请填写个数" onblur="num1($(this))"><div class="clear"></div></div></li>
                    <li><div class="c"><input type="text" placeholder="恭喜发财，万事如意！" id="info" name="info" value="恭喜发财，万事如意！" class="input"></div></li>
                    <li>
                        <div class="c">
                            <div class="t">请选择人员或部门：</div>
                            <div class="cc">
                                <span class="span"><img src="images/01.jpg"><i>-</i></span>
                                <a href=""><img src="images/721-01.png"></a>
                                <div class="clear"></div>
                            </div>
                        </div>
                    </li>
                    <li class="money">￥<span id="monn1"> 0.00</span></li>
                </ul>
            </div>
        </div>
    </div>
    <a class="button" href="javascript:;" id="submitImging">立即封包</a>
</section>
<div class="bottom"><img src="../Tpl/Qyapp/Bonus/images/bg1.png"></div>
<div id="address-btn" style="position: fixed;bottom: 0px;width: 100%;height: 36px;line-height: 36px;background: #fff;z-index:10000;padding-bottom: 10px;padding-top:10px;padding-right:2px;display:none;">
	<ul style="margin:0 auto;list-style-type:none;width:100%;height:100%;padding-left:2px;padding-right:2px;margin-right:2px;">
	<a href="javascript:;" id="fanhui" onclick="fanhui()">
		<li style="float:left;background:#de5045;width: 47%;height: 100%;text-align: center;position: relative;font-size: 14px;border-radius: 3px;margin-left:2px;margin-right:2px;"><div style="position: absolute;top: 0px;left: 0px;z-index: 20;width: 100%;height: 100%;color: #fff;">返回</div></li>
	</a>				
	<a href="javascript:;" id="queding" onclick="queding()" data-id="" data-num="">
		<li style="float:right;background:#35aa47;width: 47%;height: 100%;text-align: center;position: relative;font-size: 14px;border-radius: 3px;margin-right:5px;padding-right:5px;"><div style="position: absolute;top: 0px;left: 0px;z-index: 20;width: 100%;height: 100%;color: #fff;">确定</div></li>
	</a>			
	</ul>
</div>
<script type="text/javascript">
    TouchSlide( { slideCell:"#tabBox1",
        endFun:function(i){ //高度自适应
            var bd = document.getElementById("tabBox1-bd");
            bd.parentNode.style.height = bd.children[i].children[0].offsetHeight+"px";
            if(i>0)bd.parentNode.style.transition="200ms";//添加动画效果
        }

    } );
</script>
<script>
function mon(obj){
    var va = obj.val();
    //alert(va);
	var re = /^[0-9]+.?[0-9]*$/;
	if(!re.test(va)){
	    alert('请输入数字');
		obj.val('');
		return false;
	}
	var mon = $('#mon').val();
	var num = $('#num').val();	
	if( mon > 0 && num > 0 ){
	    var total = (num*100*(mon.toFixed(2)))/100;
		$('#monn').text(total);
	}
}
function mon1(obj){
    var va = obj.val();
    //alert(va);
	var re = /^[0-9]+.?[0-9]*$/;
	if(!re.test(va)){
	    alert('请输入数字');
		obj.val('');
		return false;
	}
	var mon = $('#mon1').val();
	var num = $('#num1').val();	
	if( mon > 0 && num > 0 ){
	    var total = (100*(mon.toFixed(2)))/100;
		$('#monn1').text(total);
	}
}
function num(obj){
    var va = obj.val();
    //alert(va);
	//var re = /^[0-9]+.?[0-9]*$/;
	var re = /^[0-9]*[1-9][0-9]*$/;
	if(!re.test(va)){
	    alert('请输入整数');
		obj.val('');
		return false;
	}
	var mon = $('#mon').val();
	var num = $('#num').val();	
	if( mon > 0 && num > 0 ){
	    var total = (num*100*mon)/100;
		$('#monn').text(total);
	}
}
function num1(obj){
    var va = obj.val();
    //alert(va);
	//var re = /^[0-9]+.?[0-9]*$/;
	var re = /^[0-9]*[1-9][0-9]*$/;	
	if(!re.test(va)){
	    alert('请输入整数');
		obj.val('');
		return false;
	}
	var mon = $('#mon1').val();
	var num = $('#num1').val();	
	if( mon > 0 && num > 0 ){
	    var total = (100*mon)/100;
		$('#monn1').text(total);
	}
}
</script>
<script>
$('#submitImging').click(function(){
	var token="{lanrain::$_GET['token']}";
	var wecha_id="{lanrain::$_GET['wecha_id']}";
	var a_id="{lanrain::$_GET['a_id']}";	
	var mon=$('#mon').val();
	var num=$('#num').val();	
	var info=$('#info').val();	
	var total=$('#monn').text();		
	var mon1=$('#mon1').val();	
	var num1=$('#num1').val();	
	var info1=$('#info1').val();	
	var total1=$('#monn1').text();	
	var follow=$('#follow').val();	
	
	$.ajax({
		type: "post",  
		url:"{lanrain::U('wap_add',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id']))}",
		dataType:'json',
		data:{'token':token,'wecha_id':wecha_id,'mon':mon,'num':num,'info':info,'total':total,'mon1':mon1,'num1':num1,'info1':info1,'total1':total1,'follow':follow},
		success:function(json){
			if(json){
				var json = json;
				alert('发送成功');
				window.location.href="index.php?g=Qyapp&m=Bonus&a=wap_index&token={lanrain::$_GET['token']}&wecha_id={lanrain::$_GET['wecha_id']}";
			}else{
				alert('发送失败');
				window.location.href="index.php?g=Qyapp&m=Bonus&a=wap_index&token={lanrain::$_GET['token']}&wecha_id={lanrain::$_GET['wecha_id']}";
			}				
		}
	});
});
</script>
<script>
$('#tab_0').show();
$('#top-menu li:first-child').css('border-bottom','3px solid red');

$('#top-menu li').each(function(){
    $(this).click(function(){
	    $('#top-menu li').css('border-bottom','none');
		$(this).css('border-bottom','3px solid red');	
	    var index = $(this).index();
		if(index == 0){
		    $('#letter').hide();		
		    $('#tab_0').show();
			$('#tab_1').hide();
		    $('#tab_2').hide();
		    $('#tab_3').hide();			
		}else if(index == 1){
		    $('#letter').hide();		
		    $('#tab_0').hide();		
		    $('#tab_1').show();
			$('#tab_2').hide();
		    $('#tab_3').hide();	
            $('div.userletter').show();				
		}else if(index == 2){
		    $('#letter').hide();		
		    $('#tab_0').hide();		
		    $('#tab_1').hide();
			$('#tab_2').show();
		    $('#tab_3').hide();
		}else if(index == 3){
		    $('#letter').show();
		    $('#tab_0').hide();		
		    $('#tab_1').show();
		    $('#tab_2').hide();			
		}
	});
});
function find(letter){
    $('#letter').hide();
    var letter = letter.toLowerCase();
    $('div.userletter').hide();
	$('#'+letter).show();
}
$('.add-user').click(function(){
    if($(this).find('.img-status').is(':visible')){
	    $(this).find('.img-status').hide();
	}else{
	    $(this).find('.img-status').show();
	}
});
function address(type,id,num){
    $('#queding').attr('data-id',id);
	$('#queding').attr('data-num',num);
	var selected = $('#'+id).attr('value');
	var url = "index.php?g=Qyapp&m=Common&a=wap_address&token={lanrain::$_GET['token']}&wecha_id={lanrain::$_GET['wecha_id']}&type="+type+"&sign="+id+"&selected="+selected;
	$.ajax({
		type: "GET",
		cache: false,
		url: url,
		dataType: "html",
		success: function (res) {
			$('body').append(res);
			
		},
		error: function (xhr, ajaxOptions, thrownError) {
		
		}
	});	
    $('#address-btn').show();	
}
function fanhui(){
	$('.address-content').hide();
	$('#address-btn').hide();
}

function queding(){
	var id = $('#queding').attr('data-id');
    var num = $('#queding').attr('data-num');	
	$('#list-'+id+' div.bg-circle').remove();
	var dept_id = '';
	var dept_name = '';
	var users_id = '';
	var users_name = '';
	$('#selected-dept li').each(function(){
		var id_1 = $(this).attr('id');
		var str_1 = id_1.replace('selected-dept-','');		
		var dept_name = $('#selected-dept-name-'+str_1).text();
		var deptcolor = getColor();		
		$('#add-'+id).before('<div class="bg-circle" style="background:'+deptcolor+';" id="my-dept-'+str_1+'"><span class="bg-text">'+dept_name+'</span></div>');	
		users_id += id_1+',';
	});		
	$('#selected-users li').each(function(){
		var id_2 = $(this).attr('id');
		var str_2 = id_2.replace('selected-users-','');		
		var users_name = $('#selected-users-name-'+str_2).text();
		var deptcolor = getColor();		
		$('#add-'+id).before('<div class="bg-circle" style="background:'+deptcolor+';" id="my-users-'+str_2+'"><span class="bg-text">'+users_name+'</span></div>');	
		users_id += id_2+',';
	});		
	$('#'+id).attr('value',users_id);
    $('#address-'+id).remove();
    $('#address-btn').hide();	
}
function getColor(){
	var mycolor=new Array("#008cee","#38adff","#ff4141","#858e99","#929292","#5ec9f6","#78c06e","#f65e8d","#f6bf26","#3bc2b5","#5c6bc0","#f65e5e","#5e97f6","#9a89b9","#bd84cd","#6bb5ce");
	var ran = Math.random();
	var len =mycolor.length;
	var ar =ran*len;
	var rancolor = Math.floor(ar);
	var color = mycolor[rancolor];
    return color;	
}
</script>
</body>
</html>