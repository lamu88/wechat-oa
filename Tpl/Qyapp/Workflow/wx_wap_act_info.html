<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
    <title>审批详情</title>
    <link rel="stylesheet" href="./Tpl/Qyapp/Workflow/css/style.css">
    <link rel="stylesheet" type="text/css" href="./Tpl/Qyapp/Workflow/css/btm.css?v=<?php echo time();?>">	
<style>
section.sec02-01 ul li{position: relative;display: block;z-index: 0;background: #fff;margin:0px;height: 45px;padding:8px 0px;border-top:0px;border-bottom:0px;}
.info{font-family: '微软雅黑';line-height: 45px;font-size: 16px;display: inline-block;text-align:right;}
.info-head{font-family: '微软雅黑';font-size: 18px;display: block;height:40px;}
.info-span{font-family: '微软雅黑';font-size: 18px;display: block;margin-left:30px;}
.info-span img{padding-left:5px;padding-bottom:5px;}
</style>
<style>
.item-span{font-size: 16px;font-family: microsoft yahei;height: 45px;line-height: 45px;color: #444;}
#add-con{color: #535353;font-size: 14px;font-family: "arial","微软雅黑";background: #fff;width: 100%;overflow: hidden;width: 100%;min-height: 100%;background: #e5e5e5;position: absolute;top: 0;left: 0;z-index: 999;overflow-x: hidden;overflow-y: auto;padding-bottom: 20px;}
.address-content{color: #535353;font-size: 14px;font-family: "arial","微软雅黑";background: #fff;width: 100%;overflow: hidden;width: 100%;min-height: 100%;background: #e5e5e5;position: absolute;top: 0;left: 0;z-index: 999;overflow-x: hidden;overflow-y: auto;padding-bottom: 20px;}
.letter{font-size:16px;height:24px;width:16%;float:left;background-color:#fff;margin:1px;padding:12px 0px 10px 0px;text-align:center;}
.img-status{display:none;}
.bg-circle{float:left;width:40px; border-radius:50%;height:40px; line-height:40px;margin-right:3px;margin-bottom:6px;overflow:hidden;}
.bg-circle-a{float:left;width:40px;height:40px; line-height:40px;margin-right:3px;margin-bottom:6px;overflow:hidden;}
.bg-text{height:40px; line-height:40px; display:block; color:#FFF; text-align:center;font-size:12px;}
</style>
</head>
<body class="bg1" style="position:relative;">
<section class="top" >
	<ul style="">
		<li style="width:25%;">
			<if condition="$users['pic']"><img src="{lanrain:$users.pic}" width="72px" height="72px" style="border-radius:10px;"><else/><img src="./Tpl/Qyapp/Workflow/images/que.png" width="72px" height="72px" style="border-radius:10px;"></if>
		</li>
		<li style="width:55%;">
			<p class="top-p" style="font-size:24px;margin-bottom:5px;">{lanrain:$users.name}</p>
			<p class="top-p">职务:{lanrain:$users.position}</p>
			<p class="top-p">部门:{lanrain:$users.department}</p>		
		</li>
		<li style="width:20%;text-align:center;padding-top:10px;position:relative;" tel="{lanrain:$users.mobile}">
		    <a href="tel:{lanrain:$users.mobile}">
		    <img src="./Tpl/Qyapp/Workflow/images/phone.png" width="50px" height="50px">
			</a>
		</li>		
	</ul>
</section>
<section class="sec02-01">
	<ul id="lists">
		<li>
		    <div style="margin-left:10px;border-bottom: 1px solid #dfdfdf;">
				<span class="info">主题:</span>
			   <span class="info">{lanrain:$list.theme}</span>
            </div>		   
		</li>					
	<volist name="info" id="info">
	<if condition="$info['type'] eq 7">	  <!--图片上传-->						
		<li style="line-height:auto;height:auto;">
		    <div style="margin-left:10px;border-bottom: 1px solid #dfdfdf;">
			<span class="info-head">{lanrain:$info.name}:</span>
			<span class="info-span">
			<volist name="info.pic" id="pic">
				<img src="{lanrain:$pic}" width="60px" height="60px">
			</volist>
			</span>	
         </div>			
		</li>					
	<elseif condition="$info['type'] eq 8"/><!--语音-->
		<li>
		    <div style="margin-left:10px;border-bottom: 1px solid #dfdfdf;">
			<span class="info">{lanrain:$info.name}:</span>
			<span class="info">
			<volist name="info.pic" id="pic">
				<img src="{lanrain:$pic}" width="60px" height="60px">
			</volist>
			</span>
          </div>			
		</li>			
	<elseif condition="$info['type'] eq 10"/> <!--复选框-->
		<li style="height:auto;" class="checkbox-li">
		    <div style="margin-left:10px;border-bottom: 1px solid #dfdfdf;">
			<span class="info-head">{lanrain:$info.name}:</span>
			<volist name="info.val" id="item">
			<p class="info-span" style="height:30px;height:30px;">{lanrain:$item}</p>
			</volist>
           </div>			
		</li>			
	<else/>
		<li>
		   <div style="margin-left:10px;border-bottom: 1px solid #dfdfdf;">
			<span class="info">{lanrain:$info.name}:</span>
			<span class="info">{lanrain:$info.val}</span>
           </div>				
		</li>					
	</if>		
	</volist>
	</ul>		
</section>
<section class="sec03-03" style="padding-bottom:160px;">
    <article>
        <ul>
		    <if condition="$audit">
            <li>
                <if condition="$users['pic']"><img src="{lanrain:$users.pic}"><else/><img src="./Tpl/Qyapp/Workflow/images/que.png"></if>			
                <div class="fl">
                    <div class="t">{lanrain:$users.name}</div>
                    <div class="c">{lanrain:$list['time']|date='Y-m-d H:i',###}</div>
				</div>
                <div class="fr">
                    <div class="t">发起申请
					</div>
                    <div class="c"></div>
                </div>
                <div class="clear"></div>
            </li>		
			<volist name="audit" id="vo" k="key">
            <li>
                <if condition="$vo['avatar'] neq ''"><img src="{lanrain:$vo.avatar}"><else/><img src="./Tpl/Qyapp/Workflow/images/que.png"></if>			
                <div class="fl">
                    <div class="t">
					<if condition="$vo['passer']">
					<if condition="$vo['passer'] eq $_GET['wecha_id']">我<else/>{lanrain:$vo.passername}</if>转交给<if condition="$vo['form_wecha_id'] eq $_GET['wecha_id']">我<else/>{lanrain:$vo.name}</if>
					<else/>
					<if condition="$vo['form_wecha_id'] eq $_GET['wecha_id']">我<else/>{lanrain:$vo.name}</if>
					</if>
					
					</div>
                    <div class="c"><if condition="$vo['time']">{lanrain:$vo.time|date='Y-m-d H:i',###}</if></div>
                </div>
                <div class="fr">
                    <div class="t">
					<if condition="$vo['status'] eq 0">审批中</if>
					<if condition="$vo['status'] eq 2">已通过</if>
					<if condition="$vo['status'] eq 3">已驳回</if>
					</div>
                    <div class="c">{lanrain:$vo.content}</div>
                </div>
                <div class="clear"></div>
            </li>
	        </volist>
            </if>			
        </ul>
    </article>
</section>
<!-- <div class="sec03-bottom-top"></div> -->

	<div class="btm_comment" id="com2">
		<div class="comment_row" id="control" style="padding:0px 1%;">
			<div id="operate">
				<ul style="margin:0 auto;list-style-type:none;width:100%;height:100%;padding-left: 0;">
				<if condition="($list['status'] neq 2) OR ($list['status'] neq 6)">
				<if condition="$list['wecha_id'] eq $_GET['wecha_id']">
				<a href="javascript:;" id="chehui" onclick="chehui()"><li style="background:#de5045;"><div class="menu_li" >撤回</div></li></a>
				</if>
                </if>	
				<if condition="($list['status'] eq 6) AND ($list['wecha_id'] eq $_GET['wecha_id'])">
				<a href="javascript:;" id="reapply" onclick="reapply()"><li style="background:#de5045;"><div class="menu_li" >重新申请</div></li></a>
                </if>				
                <if condition="($list['next_wecha_id'] eq $_GET['wecha_id']) AND($list['status'] eq 1)">
				<if condition="($auditsatus[$_GET['wecha_id']] eq 0) AND ()">				
				<a href="javascript:;" id="zhuanjiao" onclick="zhuanjiao('2','zhuanjiaoren','1')"><li style="background:#de5045;"><div class="menu_li">转交</div><input type="hidden" name="zhuanjiaoren" id="zhuanjiaoren" value=""/></li></a>	
				 </if>				
				<if condition="($auditsatus[$_GET['wecha_id']] eq 2) AND ()">
                <a href="javascript:;" id="chexiao"><li style="background:#de5045;"><div class="menu_li" >撤销审批</div></li></a>
				</if>
				<a href="javascript:;" id="jujue"><li style="background:#de5045;"><div class="menu_li" >拒绝</div></li></a>				
				<a href="javascript:;" id="tongyi"><li style="background:#35aa47;"><div class="menu_li">同意</div></li></a>
                </if>				
				</ul>
			</div>
		</div>
		<if condition="($list['next_wecha_id'] eq $_GET['wecha_id']) AND ($state eq 1)">
		<div class="comment_row" style="display:none;" id="yes">
			<p style="text-align:left;padding-left:10px;float:left;">请输入拒绝理由(非必填)</p>
			<p style="float:right;"><!-- 手写输入: --><!-- <span onclick="shurujujue()"><img src="Tpl/Qyapp/Workflow/images/iconfont-shuru.png" width="24px" height="24px"> --><!-- <input type="radio" name="type" value="0" checked="checked"/> --></span><!-- &nbsp;&nbsp;<span onclick="yuyinjujue()"><img src="Tpl/Qyapp/Workflow/images/sec03-07.png" width="24px" height="24px"></span> --></p>		
			<div class="write" id="jujie_write_comment">				
				<textarea class="enter_font" type="text" value="" class="newimg info" id="reason1" name="name" style="width: 98%;height: 75px;background-color: #fff;border: 1px solid #ccc;border-radius: 3px;color: #999;margin-top: 10px;margin-bottom:10px;"></textarea> 
			</div>
			<div class="write" id="jujie_voice_comment" style="display:none;">

				<div class="page-container">
					<div class="title">长按说话</div>
					<div class="icon">
						<!-- <img src="Tpl/Qyapp/Workflow/images/mouth.png" class="mouth img_mouth"> -->
						<a href="javascript:;" id="record"><img src="Tpl/Qyapp/Workflow/images/sec03-10.png" width="80px" height="80px" class="mouth img_mouth"></a>
						<a class="play img_play" href="javascript:playRecord()" style="display:none"><img src="Tpl/Qyapp/Workflow/images/play.png"></a>
						<!-- <img src="Tpl/Qyapp/Workflow/images/playVoice.gif" class="playgif img_recording" style="display:none"> -->
						<img src="Tpl/Qyapp/Workflow/images/iconfont-yuyinshiting.png" class="playgif img_recording" style="display:none">
					</div>
					<!-- <div class="tips div_tips" >&nbsp;</div> -->
					<!-- <div class="btn">
						<a href="javascript:restartRecord()" class="gray div_start" style="font-size: 12px;color: #222;">开始录音</a>
						<a class="green div_stop" href="javascript:stopRecord()" style="display:none">停止录音</a>
					</div>
					<div class="bottomtext div_friendtxt" style="display:none">已保存，可分享</div> -->
				</div>
			
				<input type="hidden" name="jujie_voice">  
			</div>			
			<div id="menu" style="margin-left:0px;margin-right:2px;">
				<ul style="margin:0 auto;list-style-type:none;width:100%;height:100%;padding-left: 0;">
				<a href="javascript:;" id="queding1"><li style="float:left;background:#35aa47;"><div class="menu_li" >确定</div>
				</li></a> 				
				<a href="javascript:;" id="fanhui1"><li style="float:right;background:#de5045;"><div class="menu_li" >返回</div>
				</li></a>				
				</ul>
			</div>
		</div>		
		<div class="comment_row" style="display:none;height:20px;line-height:20px;" id="no">
		     <!-- <span style="text-align:left;padding-left:10px;float:left;">审批意见:</span> -->
			 请输入审批意见(非必填)
			 <span style="float:right;"><!-- 请选择：<span onclick="shurutongyi()"><img src="Tpl/Qyapp/Workflow/images/iconfont-shuru.png" width="22px" height="22px"></span> --><!-- &nbsp;&nbsp;<span onclick="yuyintongyi()"><img src="Tpl/Qyapp/Workflow/images/sec03-07.png" width="22px" height="22px"></span> --></span>
			<div class="write" id="tongyi_write_comment">
				<textarea class="enter_font" type="text" value="" class="newimg info" id="reason2" name="name" style="width: 98%;height: 75px;background-color: #fff;border: 1px solid #ccc;border-radius: 3px;color: #999;margin-top: 10px;margin-bottom:10px;"></textarea> 
			</div>
			<div class="write" id="tongyi_voice_comment" style="display:none;">
			
					<div class="page-container">
						<!-- <div class="title">录制语音</div> -->
						<div class="icon">
							<img src="Tpl/Qyapp/Workflow/images/sec03-10.png" width="80px" height="80px" class="mouth img_mouth">
							<a class="play img_play" href="javascript:playRecord()" style="display:none"><img src="Tpl/Qyapp/Workflow/images/iconfont-yuyinshiting.png"><!-- <img src="Tpl/Qyapp/Workflow/images/play.png"> --></a>
							<img src="Tpl/Qyapp/Workflow/images/playVoice.gif" class="playgif img_recording" style="display:none">
						</div>
						<!-- <div class="tips div_tips" >&nbsp;</div> -->
						<div class="btn">
							<a href="javascript:restartRecord()" class="gray div_start" style="font-size: 12px;color: #222;">开始录音</a>
							<a class="green div_stop" href="javascript:stopRecord()" style="display:none">停止录音</a>
                        </div>
						<div class="bottomtext div_friendtxt" style="display:none">已保存，可分享</div>
					</div>  
					
				<input type="hidden" name="tongyi_voice"> 
			</div>			
			<div id="menu" style="margin-left:0px;margin-right:2px;">
				<ul style="margin:0 auto;list-style-type:none;width:100%;height:100%;padding-left: 0;">
				<a href="javascript:;" id="queding2"><li style="float:left;background:#35aa47;"><div class="menu_li" >确定</div>
				</li></a> 				
				<a href="javascript:;" id="fanhui2"><li style="float:right;background:#de5045;"><div class="menu_li" >返回</div>
				</li></a>				
				</ul>
			</div>
		</div>
      </if>		
	</div>
	
	
	<div id="address-btn" style="position: fixed;bottom: 0px;width: 100%;height: 36px;line-height: 36px;background: #fff;z-index:10000;padding-bottom: 10px;padding-top:10px;padding-right:2px;display:none;">
		<ul style="margin:0 auto;list-style-type:none;width:100%;height:100%;padding-left:2px;padding-right:2px;margin-right:2px;">
		<a href="javascript:;" id="fanhui" onclick="fanhui()">
			<li style="float:left;background:#de5045;width: 47%;height: 100%;text-align: center;position: relative;font-size: 14px;border-radius: 3px;margin-left:2px;margin-right:2px;"><div style="position: absolute;top: 0px;left: 0px;z-index: 20;width: 100%;height: 100%;color: #fff;">返回</div></li>
		</a>				
		<a href="javascript:;" id="queding" onclick="queding()" data-id="" data-num="">
			<li style="float:right;background:#35aa47;width: 47%;height: 100%;text-align: center;position: relative;font-size: 14px;border-radius: 3px;margin-right:5px;padding-right:5px;"><div style="position: absolute;top: 0px;left: 0px;z-index: 20;width: 100%;height: 100%;color: #fff;">确定</div></li>
		</a>			
		</ul>
	</div>	
	<style>
    #operate{width:95%;background:#fff;z-index:999;margin-left:3%;}
	#operate ul li{height:100%;width:100%;height:36px;line-height:36px;text-align:center;position:relative;font-size:14px;border-radius: 3px;margin-bottom:10px;}
	#operate ul li .menu_li{position:absolute;top:0px;left:0px;z-index:20;width:100%;height:100%;color:#fff;}
	a{text-decoration:none;}
	#menu{position:fixed;bottom:0px;width:95%;height:36px;line-height:36px;background:#fff;z-index:999;margin-left:3%;padding-bottom: 10px;}
	#menu ul li{float:left;width:49%;height:100%;text-align:center;position:relative;font-size:14px;border-radius: 3px;}
	#menu ul li .menu_li{position:absolute;top:0px;left:0px;z-index:20;width:100%;height:100%;color:#fff;}
	a{text-decoration:none;}
	</style>
	<input type="text" id="txt_serverID" style="display:none" />
	<input type="text" id="myvoice" name="voice" style="display:none" />
    <input type="hidden" id="token" value="<?php echo $_GET['token']?>"></input>
	<script src="./Tpl/Qyapp/Static/Js/jquery-1.9.1.min.js" type="text/javascript"></script>
<script>
//alert($('#lists').children('li:last').children('div').html());
$('#lists').children().last().children('div').css('border-bottom','none');
//$('#jujie_voice_comment').css('display','none');
//$('#tongyi_voice_comment').css('display','none');
//$('.btm_comment').css('height','155px');
$('#jujue').on('click',function(){
//$('.btm_comment').css('height','180px');
$('#jujie_write_comment').css('display','block');
$('#control').css('display','none');
$('#yes').css('display','block');
$('#no').css('display','none');
});
$('#tongyi').on('click',function(){
//$('.btm_comment').css('height','180px');
$('#tongyi_write_comment').css('display','block');
$('#control').css('display','none');
$('#yes').css('display','none');
$('#no').css('display','block');
});
$('#fanhui1').on('click',function(){
//$('.btm_comment').css('height','55px');
$('#control').css('display','block');
$('#yes').css('display','none');
$('#no').css('display','none');
});
$('#fanhui2').on('click',function(){
//$('.btm_comment').css('height','55px');
$('#control').css('display','block');
$('#yes').css('display','none');
$('#no').css('display','none');
});
</script>
<script>
function shurujujue(){
   $('#jujie_write_comment').css('display','block');
   $('#jujie_voice_comment').css('display','none');
   //$('.btm_comment').css('height','180px');
}
function yuyinjujue(){

    $('#jujie_write_comment').css('display','none');
   $('#jujie_voice_comment').css('display','block');
   //$('.btm_comment').css('height','180px');
}
function shurutongyi(){
    $('#tongyi_write_comment').css('display','block');
    $('#tongyi_voice_comment').css('display','none');
	//$('.btm_comment').css('height','180px');
}
function yuyintongyi(){
    $('#tongyi_write_comment').css('display','none');
    $('#tongyi_voice_comment').css('display','block');
	//$('.btm_comment').css('height','180px');
}
function chehui(){
	$.ajax({
			type: "post",  
			url:"{lanrain::U('wap_chehui',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id'],'status'=>6,'a_id'=>$_GET['pid']))}",
			//data:{'content':content,'voice':voice},
			dataType:'json',
			success:function(json){
			    if(json==1){
				    alert('您已成功撤回申请');
					window.location.reload();
				}else if(json==2){
				    alert('撤回失败');
					//window.location.reload();
				}else{
					alert('发生错误');
				}				
			}
		});
}
function zhuanjiao(){
    alert('ccc');
}
</script>
<script>
//同意
$('#queding2').click(function(){
    var content = $('#reason2').val();
	var voice = '';
    if($('#myvoice').val()){
	    voice = $('#myvoice').val();
	}	
	//alert(voice);
	$.ajax({
			type: "post",  
			url:"{lanrain::U('wap_agree',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id'],'status'=>2,'a_id'=>$witer['id']))}",
			data:{'content':content,'voice':voice},
			dataType:'json',
			//data:{'token':token,'wecha_id':wecha_id,'id':id,'status':status},
			success:function(json){
			    if(json==0){
				    alert('您已经审核过了');
					window.location.reload();
				}
				if(json==1){
				    alert('您同意了报销申请');
					//$('#com2').css('display','none');
					window.location.reload();
				}
				if(json==7){
					alert('审核失败或者您已经审核过了');
				}				
			}
		});
});

//拒绝
$('#queding1').click(function(){
    var content = $('#reason1').val();
	var voice = '';
    if($('#myvoice').val()){
	    voice = $('#myvoice').val();
	}	
	$.ajax({
			type: "post",  
			url:"{lanrain::U('wap_agree',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id'],'status'=>3,'a_id'=>$witer['id']))}",
			data:{'content':content,'voice':voice},			
			dataType:'json',
			//data:{'token':token,'wecha_id':wecha_id,'id':id,'status':status},
			success:function(json){
			    //if(json==0){
				//    alert('您已经审核过了');
				//	window.location.reload();
				//}			
				if(json==1){
				    
				    alert('您拒绝了报销申请');
					window.location.reload();
				}
				if(json==7){
					alert('审核失败或者您已经审核过了');
				}				
			}
		});
});
//取消
function closeLay(){
window.location.reload();
}
//发送理由
function submitLay(m,n){
	var token = "{lanrain::$_GET['token']}";
	var wecha_id = "{lanrain::$_GET['wecha_id']}";
	var content = $('#layContent').val();
	$.ajax({
		type: "post",  
		url:"{lanrain::U('wap_comment',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id']))}",
		dataType:'json',
		data:{'token':token,'wecha_id':wecha_id,'id':m,'status':n,'content':content},
		success:function(json){
			if(json==1){
				alert('修改成功');
				window.location.reload();
			}
			if(json==2){
				alert('修改失败');
				window.location.reload();
			}
			if(json==3){
				alert('发表成功');
				window.location.reload();
			}
			if(json==4){
				alert('发表失败');
				window.location.reload();
			}
		}
	});
}
</script>
<script type="text/javascript">

    //var play_time_ti;
    var is_playing = false;
    function playVoice(id) {
        is_playing = true;
        //play_time_ti = setInterval(function () {
        //    var tt = $('.div_tips').text().replace("s", "");
        //    var ss = tt * 1;
        //    $('.div_tips').text((ss > 1 ? ss - 1 : 0) + "s");
        //}, 1000);

        setTimeout(function () {
            is_playing = false;
            $(".img_recording").hide();
            $('.img_play').show();
            //$('.div_tips').text(voice_record_time * 1 + "s");

            //if (play_time_ti) {
           //     clearInterval(play_time_ti);
            //}

        }, voice_record_time * 1000);
        wx.playVoice({
            localId: id// 需要播放的音频的本地ID，由stopRecord接口获得
        });

    }

    function playVoiceByUser() {
        if (is_playing) return;

        playVoice(last_voice_localId);
    }
    function uploadVoice(localId) {
	    //alert(localId);
        wx.uploadVoice({
            localId: localId, // 需要上传的音频的本地ID，由stopRecord接口获得
            isShowProgressTips: 1, // 默认为1，显示进度提示
            success: function (res) {
                var serverId = res.serverId; // 返回音频的服务器端ID
                $("#txt_serverID").val(serverId);
				$("#myvoice").val(serverId);
				//alert($("#myvoice").val());
                //$("#div_friend").show();
                //$("#div_friendtxt").show();
				//wxShareDataArray[3] = serverId;
                //changeWeixinShareData();
            }
        });
    }

    var last_voice_localId;
    function onRecordDone(localId) {

        voice_record_time = Math.ceil(((new Date()).getTime() - voice_record_start) / 1000);
		//alert(voice_record_time+'aa');
        //$(".div_tips").text(voice_record_time * 1 + "s");
        last_voice_localId = localId;
		//alert(last_voice_localId+'bbbs');
        //wxShareDataArray[2] = voice_record_time * 1 + "\"";
        setTimeout(function () {
            uploadVoice(localId);
        }, 1000);

        playVoice(localId);

    }

    var isRecording = false;
    function startRecord() {
        if (isRecording) return;
        $(".img_mouth").hide();
        $(".div_start").hide();
        $('.img_play').hide();
        $(".img_recording").show();
        //$(".div_tips").show();
        //$(".div_tips").text("正在录音...");
        $(".div_stop").show();
        $(".div_friend").hide();
        $(".div_friendtxt").hide();
        isRecording = true;
        wx.onVoiceRecordEnd({
            // 录音时间超过一分钟没有停止的时候会执行 complete 回调
            complete: function (res) {
                var localId = res.localId;

                isRecording = false;
                onRecordDone(localId);
            }
        });


        voice_record_time = 0;
        voice_record_start = (new Date()).getTime();

        wx.startRecord({
            success: function () {
                isRecording = false;
                voice_record_start = (new Date()).getTime();
            },
            cancel: function () {
                isRecording = false;
            }
        });

    }


    function stopRecord() {
        isRecording = false;
		$('.img_recording').show();
		$('.img_play').show();
        //$(".div_stop").hide();
        $(".div_start").show();
        wx.stopRecord({
            success: function (res) {
                var localId = res.localId;
				//alert(localId);
                onRecordDone(localId);
				$('.img_recording').show();
				$('.img_play').show();
            }
        });
        //$(".img_recording").show();
        //$(".div_tips").show();
        //$(".div_tips").text("正在录音...");
        //$(".div_stop").show();		
		$('.img_recording').show();
		$('.img_play').show();		
    }

    function playRecord() {
        $(".img_recording").show();
        $('.img_play').hide();
        playVoice(last_voice_localId);
    }

    function restartRecord() {
        startRecord();
    }
</script>
<script>
$('#tab_0').show();
$('#top-menu li:first-child').css('border-bottom','3px solid red');

$('#top-menu li').each(function(){
    $(this).click(function(){
	    $('#top-menu li').css('border-bottom','none');
		$(this).css('border-bottom','3px solid red');	
	    var index = $(this).index();
		if(index == 0){
		    $('#letter').hide();		
		    $('#tab_0').show();
			$('#tab_1').hide();
		    $('#tab_2').hide();
		    $('#tab_3').hide();			
		}else if(index == 1){
		    $('#letter').hide();		
		    $('#tab_0').hide();		
		    $('#tab_1').show();
			$('#tab_2').hide();
		    $('#tab_3').hide();	
            $('div.userletter').show();				
		}else if(index == 2){
		    $('#letter').hide();		
		    $('#tab_0').hide();		
		    $('#tab_1').hide();
			$('#tab_2').show();
		    $('#tab_3').hide();
		}else if(index == 3){
		    $('#letter').show();
		    $('#tab_0').hide();		
		    $('#tab_1').show();
		    $('#tab_2').hide();			
		}
	});
});
function find(letter){
    $('#letter').hide();
    var letter = letter.toLowerCase();
    $('div.userletter').hide();
	$('#'+letter).show();
}
$('.add-user').click(function(){
    if($(this).find('.img-status').is(':visible')){
	    $(this).find('.img-status').hide();
	}else{
	    $(this).find('.img-status').show();
	}
});
function zhuanjiao(type,id,num){
    $('#queding').attr('data-id',id);
	$('#queding').attr('data-num',num);
	var selected = $('#'+id).attr('value');
	var url = "index.php?g=Qyapp&m=Common&a=wap_address&token={lanrain::$_GET['token']}&wecha_id={lanrain::$_GET['wecha_id']}&type="+type+"&sign="+id+"&selected="+selected;
	$.ajax({
		type: "GET",
		cache: false,
		url: url,
		dataType: "html",
		success: function (res) {
			$('body').append(res);
		},
		error: function (xhr, ajaxOptions, thrownError) {
		
		}
	});	
    $('#address-btn').show();	
}
function fanhui(){
	$('.address-content').hide();
	$('#address-btn').hide();
}

function queding(){
	var id = $('#queding').attr('data-id');
    var num = $('#queding').attr('data-num');	
	//$('#list-'+id+' div.bg-circle').remove();
	var dept_id = '';
	var dept_name = '';
	var users_id = '';
	var users_name = '';
	$('#selected-users li').each(function(){
		var id_2 = $(this).attr('id');
		var str_2 = id_2.replace('selected-users-','');		
		users_name = $('#selected-users-name-'+str_2).text();
		//var deptcolor = getColor();		
		//$('#add-'+id).before('<div class="bg-circle" style="background:'+deptcolor+';" id="my-users-'+str_2+'"><span class="bg-text">'+users_name+'</span></div>');	
		//users_id += str_2+',';
		users_id += str_2;
	});	
	//alert(users_id);
	//alert(users_name);	
	$.ajax({
			type: "post",  
			url:"{lanrain::U('wap_zhuanjiao',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id'],'pid'=>$_GET['pid'],'a_id'=>$witer['id']))}",
			data:{'passer':users_id},			
			dataType:'json',
			//data:{'token':token,'wecha_id':wecha_id,'id':id,'status':status},
			success:function(json){			
				if(json==1){
				    alert('您已成功将审批转交给'+users_name);
					window.location.reload();
				}else if(json==2){
				    alert('转交失败');
				}else if(json==0){
					alert('出错了');
				}				
			}
		});	
	$('#'+id).attr('value',users_id);
    $('#address-'+id).remove();
    $('#address-btn').hide();	
}
function getColor(){
	var mycolor=new Array("#008cee","#38adff","#ff4141","#858e99","#929292","#5ec9f6","#78c06e","#f65e8d","#f6bf26","#3bc2b5","#5c6bc0","#f65e5e","#5e97f6","#9a89b9","#bd84cd","#6bb5ce");
	var ran = Math.random();
	var len =mycolor.length;
	var ar =ran*len;
	var rancolor = Math.floor(ar);
	var color = mycolor[rancolor];
    return color;	
}
</script>
</body>
</html>