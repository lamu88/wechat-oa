<!DOCTYPE html>

<html lang="en">

<head>
<meta charset="utf-8"/>
<title>编辑公告</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta content="" name="description"/>
<meta content="" name="author"/>
<link href="./Tpl/assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
 <link href="./Tpl/assets/global/css/components.css" id="style_components" rel="stylesheet" type="text/css"/>

<link href="./Tpl/assets/global/css/gfonts1.css" rel="stylesheet" type="text/css"/>
<link href="./Tpl/assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/> 
<link href="./Tpl/assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css"/>
<link href="./Tpl/assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
<link href="./Tpl/assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css"/>
<link href="./Tpl/assets/global/css/plugins.css" rel="stylesheet" type="text/css"/>
<link href="./Tpl/assets/admin/layout/css/layout.css" rel="stylesheet" type="text/css"/>
<link id="style_color" href="./Tpl/assets/admin/layout/css/themes/default.css" rel="stylesheet" type="text/css"/>
<link href="./Tpl/assets/admin/layout/css/custom.css" rel="stylesheet" type="text/css"/>
<link href="./Tpl/assets/admin/layout/css/weiyi.css" rel="stylesheet" type="text/css"/>

<!--独立CSS-->
<link href="./Tpl/Qyapp/Announce/css/ann.css" rel="stylesheet" type="text/css">
<!--END-->
<script type="text/javascript" src="./Tpl/Qyapp/Workflow/js/swipe.js"></script>
<script src="./Tpl/static/scroll/dev/jquery-1.9.1.js"></script>	 
<!-- BEGIN GLOBAL MANDATORY STYLES -->
<link rel="shortcut icon" href="favicon.ico"/>
</head>
<body class="page-quick-sidebar-over-content ">
<!-- BEGIN CONTAINER -->
<div class="page-container">
<!-- BEGIN CONTENT -->
<div class="page-content-wrapper"> 
<div class="page-content">

<div class="page-quick-sidebar-wrapper" style="background-color:#fff;" id="allusers">

</div>
<!-- END QUICK SIDEBAR -->		

<form action="{lanrain::U('Announce/wap_add_task',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id']))}" method="post">
<input type="hidden" value="{lanrain::$_GET['a_id']}"  name="a_id">
<input type="hidden" value="{lanrain::$_GET['token']}"  name="token">
<input type="hidden" value="{lanrain::$_GET['wecha_id']}"  name="wecha_id">
<div class="row">
<div class="col-md-12">
<div class="clearfix">
<!-- <h4 class="block">With List Groups</h4> -->
<div class="panel" style="border-color:#35aa47;background-color:#35aa47;">
<!-- Default panel contents -->
<div class="panel-heading">
<h3 class="panel-title" style="color:#fff;"><i class="fa fa-plus">&nbsp;</i>编辑公告</h3>
</div>

<!-- List group -->
<ul class="list-group">
<li class="list-group-item" onclick="selectDepart('truename','1');">
[发布部门] 
<span style="border:none;color:#35aa47;width:80%;height:30px;" id="myinput">{lanrain:$data.todepart}</span>
<input name="helper" id="truename" value="{lanrain:$order.name}" type="hidden" style="border:none;color:#35aa47;" >
<span class="pull-right"><img src="./Tpl/Qyapp/Task/images/iconfont-tianjia.png" width="20px"></span>
<input type="hidden" value="" todepart="{lanrain:$data.todepartid}" name="todepart" id="todepart">
</li>										
<li class="list-group-item" onclick="selectAll('name','2');">
[指定人员] 
<span style="border:none;color:#35aa47;width:80%;height:30px;" id="myinput2">{lanrain:$data.touser}</span>
<!-- <input name="helper" class="px" id="name" onclick="selectUser('name','2');" value="{lanrain:$follow.name}" type="text" style="border:none;color:#35aa47;"> -->
<input name="touser" class="px" id="name" type="hidden">
<span class="pull-right"><img src="./Tpl/Qyapp/Task/images/iconfont-tianjia.png" width="20px"></span>
<input type="hidden" value="{lanrain:$data.touserid}"  name="touser" id="follow">												 

</li>

<li class="list-group-item">
[公告标题] <input type="text" class="px" name="title" id="dateline" style="border:none;" value="{lanrain:$data.title}">
<!-- <span class="pull-right"><img src="./Tpl/Qyapp/Task/images/iconfont-tianjia.png" width="20px"></span> -->
</li>

<li class="list-group-item" id="liHeader" >
[选择图片]
	<br/>
	<div id="addImg"></div>
	<a href="javascript:;" id="chooseImage"><img src="./Tpl/Qyapp/Announce/images/iconfont-zengjia.png" width="50px" height="50px"></a>
<!-- <span class="pull-right"><img src="./Tpl/Qyapp/Task/images/iconfont-tianjia.png" width="20px"></span> -->
</li>											
											
<li class="list-group-item">
<div class="form-group">
<p>[公告内容]</p>

<textarea class="form-control" rows="10" name="content" id="content">{lanrain:$data.content}</textarea>
</div>
</li>
</ul>
</div>
</div>				
</div>
</div>
<!-- END PAGE CONTENT-->
<div class="row" style="margin-bottom:10px;">
<div class="col-md-12">
<div class="form-actions">
<input type="hidden" value="" id="serveridAdd"/>
<input type="button" class="btn green btn-block" id="submitImg" value="提交"/>
</div>				
</div>
</div>
</form>
</div>
<!--  -->
<!-- END CONTENT -->
</div>

<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
wx.config({
debug: false,
appId: '{lanrain:$jsssdk_info.appId}',
timestamp: {lanrain:$jsssdk_info.timestamp},
nonceStr: '{lanrain:$jsssdk_info.nonceStr}',
signature: '{lanrain:$jsssdk_info.signature}',
jsApiList: [
	'previewImage',
	'chooseImage',
	'uploadImage',
	'downloadImage'
]
});
</script>

<script>
$('#chooseImage').click(function(){
	wx.chooseImage({
		success: function (res) {			
			var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
			$.each(localIds,function(k,v){
				var l = '';
				var num = Math.floor(Math.random()*999+1);
				l += '<div class="choose_pic"  id="appendsImg_'+num+'">';
				l +='<input type="hidden" value="'+v+'" name="pic'+num+'">';
				l += '<img id="img_'+num+'" src="'+v+'" width="35px" height="35px">';
				l += '<a href="javascript:;" onclick="delImg('+num+')">';
				l += '<img class="icon_reduce" src="./Tpl/Qyapp/Announce/images/iconfont-iconfontjian.png" width="15px" height="15px">';
				l += '</a></div>';
				$('#addImg').append(l);	
			});
		}
	});
});
</script>
<script>
function delImg(m){
	$('#appendsImg_'+m).remove();
}
</script>
<script>
$('#submitImg').click(function(){
	var localIds = new Array();
	
	$('#liHeader .choose_pic input').each(function(k,v){
		 var value = $(this).attr('value');	
		 localIds[k] = value;
	});
	if(localIds.length!=0){
		syncUpload(localIds,'');
	}else{
		var token="{lanrain::$_GET['token']}";
		var wecha_id="{lanrain::$_GET['wecha_id']}";
		var a_id="{lanrain::$_GET['a_id']}";
		var news_id = "{lanrain::$_GET['pid']}";
		var touser=$('#follow').val();
		var todepart=$('#todepart').attr('todepart');
		var title=$('#dateline').val();
		var content=$('#content').val();
		$.ajax({
			type: "post",  
			url:"{lanrain::U('wap_add_task',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id']))}",
			dataType:'json',
			data:{'news_id':news_id,'token':token,'wecha_id':wecha_id,'a_id':a_id,'touser':touser,'todepart':todepart,'title':title,'content':content},
			success:function(json){
				if(json){
					alert('修改成功');
					window.location.href="{lanrain::U('wap_index',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id'],'pid'=>"+json+"))}";
				}else{
					alert('修改失败');
					window.location.href="{lanrain::U('wap_index',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id']))}";
				}
			}
		});
	}

	
});
function syncUpload(localIds,id){
	var localId = localIds.pop();
	wx.uploadImage({
		localId: localId,
		isShowProgressTips: 1,
		success: function (res) {
			var serverId = res.serverId;
			id += ''+serverId+',';
			if(localIds.length > 0){
				syncUpload(localIds,id);
			}else{
				var token="{lanrain::$_GET['token']}";
				var wecha_id="{lanrain::$_GET['wecha_id']}";
				var a_id="{lanrain::$_GET['a_id']}";
				var news_id = "{lanrain::$_GET['pid']}";
				var touser=$('#follow').val();
				var todepart=$('#todepart').attr('todepart');
				var title=$('#dateline').val();
				var content=$('#content').val();
				$.ajax({
					type: "post",  
					url:"{lanrain::U('wap_add_task',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id']))}",
					dataType:'json',
					data:{'news_id':news_id,'token':token,'wecha_id':wecha_id,'a_id':a_id,'touser':touser,'todepart':todepart,'title':title,'content':content,'pic':id},
					success:function(json){
						if(json){
							alert('修改成功');
							window.location.href="{lanrain::U('wap_index',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id'],'pid'=>"+json+"))}";
						}else{
							alert('修改失败');
							window.location.href="{lanrain::U('wap_index',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id']))}";
						}
					}
				});
			}
		}
	});
	
};
</script>







<!-- <script src="./Tpl/assets/global/plugins/jquery.min.js" type="text/javascript"></script> -->
<script src="./Tpl/assets/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
<script src="./Tpl/assets/global/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script>
<script src="./Tpl/assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="./Tpl/assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
<script src="./Tpl/assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="./Tpl/assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="./Tpl/assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script src="./Tpl/assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<script src="./Tpl/assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<script type="text/javascript" src="./Tpl/assets/global/plugins/select2/select2.min.js"></script>

<script src="./Tpl/assets/global/scripts/metronic.js" type="text/javascript"></script>
<script src="./Tpl/assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="./Tpl/assets/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>
<script src="./Tpl/assets/admin/layout/scripts/demo.js" type="text/javascript"></script>
<script src="./Tpl/assets/admin/pages/scripts/form-samples.js"></script>

<script>
jQuery(document).ready(function() {    
// initiate layout and plugins
Metronic.init(); // init metronic core components
Layout.init(); // init current layout
QuickSidebar.init(); // init quick sidebar
Demo.init(); // init demo features
FormSamples.init();
$('#tab_0 div.portlet').each(function(){
$(this).children('.portlet-title').click(function(){
//alert($(this).siblings('.portlet-body').html());
if($(this).siblings('.portlet-body').css('display') == 'block'){
$(this).siblings('.portlet-body').css('display','none');
$(this).find('.tools').children().removeClass('collapse');
$(this).find('.tools').children().addClass('expand');
}else{
$(this).siblings('.portlet-body').css('display','block');
$(this).find('.tools').children().addClass('collapse');
$(this).find('.tools').children().removeClass('expand');			   
}
});
});
});
</script>
<script>
function selectDepart(id,type){
$('body').addClass('page-quick-sidebar-open');
$('#allusers').css('width','100%');
$('#allusers').css('top','0');
$('#allusers').load("{lanrain::U('Adlu/wap_depart',array('from'=>'Announce','ai'=>'wap_add_task','wecha_id'=>$_GET['wecha_id'],'token'=>$_GET['token'],'type'=>2))}");
$('#getdata').html('');
$('#submit').attr('mydata',type);
$('#media-list li.media').children('div.media-status').children().children().children().attr("class",'');

}
function selectAll(id,type){
$('body').addClass('page-quick-sidebar-open');
$('#allusers').css('width','100%');
$('#allusers').css('top','0');
$('#allusers').load("{lanrain::U('Adlu/wap_users',array('from'=>'Announce','ai'=>'wap_add_task','wecha_id'=>$_GET['wecha_id'],'token'=>$_GET['token'],'type'=>2))}");
$('#getdata').html('');
$('#submit').attr('mydata',type);
$('#media-list li.media').children('div.media-status').children().children().children().attr("class",'');

}
function closeList(){
$('body').removeClass('page-quick-sidebar-open');
$('#allusers').css('width','0');
$('#getdata').html('');	
$('#allusers').html('');

}
function selectIt(type){
var level = 3;
if(type == 'low'){
$('#low').css('background-color','red');
$('#medium').css('background-color','');
$('#high').css('background-color','');		
level = 3;
}else if(type == 'medium'){
$('#low').css('background-color','');
$('#medium').css('background-color','#e4ca38');	
$('#high').css('background-color','');			
level = 2;		
}else if(type == 'high'){	
$('#low').css('background-color','');
$('#medium').css('background-color','');
$('#high').css('background-color','green');		
level = 1;			
}
$('#ysex').attr('value',level);	
}

</script>	
<!-- END JAVASCRIPTS -->


</body>
<!-- END BODY -->
</html>