
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
    <title>添加日志</title>
	
    <link rel="stylesheet" href="./Tpl/Qyapp/Day/css/style1.css">
	<link rel="stylesheet" href="./Tpl/Qyapp/Day/css/style.css">
    <link rel="stylesheet" href="./Tpl/Qyapp/Day/css/date.css">
	<!-- <script src="./Tpl/Qyapp/Day/js/jquery.js"></script> -->

<script type="text/javascript" charset="utf-8">   
    $(function() {   
	    $('#type').mobiscroll().select({
			theme: 'ios',     // Specify theme like: theme: 'ios' or omit setting to use default 
			mode: 'mixed',       // Specify scroller mode like: mode: 'mixed' or omit setting to use default 
			display: 'bottom', // Specify display mode like: display: 'bottom' or omit setting to use default 
			lang: 'zh'        // Specify language like: lang: 'pl' or omit setting to use default 		
		});
		$('.time').mobiscroll().date({
			theme: 'ios',     // Specify theme like: theme: 'ios' or omit setting to use default 
			mode: 'mixed',       // Specify scroller mode like: mode: 'mixed' or omit setting to use default 
			display: 'bottom', // Specify display mode like: display: 'bottom' or omit setting to use default 
			lang: 'zh'        // Specify language like: lang: 'pl' or omit setting to use default 
		});		
		$('.times').mobiscroll().time({
			theme: 'ios',     // Specify theme like: theme: 'ios' or omit setting to use default 
			mode: 'mixed',       // Specify scroller mode like: mode: 'mixed' or omit setting to use default 
			display: 'bottom', // Specify display mode like: display: 'bottom' or omit setting to use default 
			lang: 'zh'        // Specify language like: lang: 'pl' or omit setting to use default 
		});	
    });   
</script>
<section class="sec01-01">
    <div class="slideTxtBox">
        <div class="hd">
            <ul id="tab">
                <li class="li-status" style="width:33.33%">
                    <div class="li-c" style="margin-left:10px;">
						<span class="span-center" style="color:#C5CB63;" id="rbshu"></span>
						<div class="li-txt" style="color:#575757;" >日报</div>
                    </div>
                </li>
				<li class="li-status" style="width:33.33%">
                    <div class="li-c" style="margin-left:10px;">
						<span class="span-center" style="color:#C5CB63;" id="zbshu"></span>
						<div class="li-txt" style="color:#575757;" >周报</div>
                    </div>
                </li>
				<li class="li-status" style="width:33.33%">
                    <div class="li-c" style="margin-left:10px;">
						<span class="span-center" style="color:#C5CB63;" id="ybshu"></span>
						<div class="li-txt" style="color:#575757;" >月报</div>
                    </div>
                </li>
                <div class="clear"></div>
            </ul>
        </div>
 </div>
  </div>
<!--header start-->
<!--<header class="bg1">
    <a class="pre"><img src="images/header-pre.png"></a>
    <div class="txt">报 销</div>
</header>-->
<!--header end-->
<!--sec02 start-->
<style>
.item-span{
font-size: 16px;
font-family: microsoft yahei;
margin-left: 50px;
height: 45px;
line-height: 45px;
color: #444;
}
</style>
			
		<input type="hidden" value="{lanrain::$_GET['token']}" id="token"  name="token">
		<input type="hidden" id="type1" name="type" value="日报" >
		<input type="hidden" value="{lanrain::$_GET['wecha_id']}"  id="wecha_id" name="wecha_id">	
		<input type="hidden" id="longitude" name="longitude" value=""/>
		<input type="hidden" id="latitude" name="latitude" value=""/>
		
<section class="sec02-01">
		<li class="task_info">
			<span class="item-span">内容:</span>
			<textarea type="text" value="" id="daywork" name="daywork" style="height:300px"></textarea>
        </li>
		<!-- <li class="task_info">
			<span class="item-span">未完成:</span>
			<textarea type="text" value="" id="needwork" name="needwork"></textarea>
        </li> -->
		<!-- <li>
            <i><img src="./Tpl/Qyapp/Day/images/addr.png"></i>
			<span class="item-span log_dz" id="place" name="place" style="color:#888;font-size:12px;" value=""></span>
        </li> -->
		<input type="hidden" id="helper1" name="helper1" value=""/>
		<!-- <ul id="xm" class="day_ul">
        <li class="li2">
            <div class="li-w">
                <div class="fr">
                    <div class="li-c">
                        <div class="fr-c">
                            <div class="ii"></div>
                            <div class="cc">
                                <div class="c" style="position:relative;"><span>今日完成工作:</span><input type="text" value="" name="daywork" id="daywork" onblur="total()"></div>
                                <div class="c" style="position:relative;"><span>未完成工作:</span><input type="text" value="" name="unwork" id="unwork"></div>
                                <div class="c" style="position:relative;"><span>需协调工作:</span><input type="text" value="" name="needwork" id="needwork"></div>
                               <input type="hidden" id="pic_1" name="pic" value="" />
								<div class="add">
									[选择图片]
									<br/>
									<div></div>
									<div id="addImg_1"></div>	
									<a href="javascript:;" class="chooseImage" onclick="chooseImage($(this));" data-n="1"><img src="./Tpl/Qyapp/Day/images/add.png"></a>
								</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="clear"></div>
            </div>
        </li> 
		
    </ul>-->
	
    <div style="width:100%;height:50px;"></div>
    <div class="button-w"><button class="bg1" id="submit">提交</button></div>
</section>
<div id="address-btn" style="position: fixed;bottom: 0px;width: 100%;height: 36px;line-height: 36px;background: #fff;z-index:10000;padding-bottom: 10px;padding-top:10px;padding-right:2px;display:none;">
	<ul style="margin:0 auto;list-style-type:none;width:100%;height:100%;padding-left:2px;padding-right:2px;margin-right:2px;">
	<a href="javascript:;" id="fanhui" onclick="fanhui()">
		<li style="float:left;background:#de5045;width: 47%;height: 100%;text-align: center;position: relative;font-size: 14px;border-radius: 3px;margin-left:2px;margin-right:2px;"><div style="position: absolute;top: 0px;left: 0px;z-index: 20;width: 100%;height: 100%;color: #fff;">返回</div></li>
	</a>				
	<a href="javascript:;" id="queding" onclick="queding()" data-id="" data-num="">
		<li style="float:right;background:#35aa47;width: 47%;height: 100%;text-align: center;position: relative;font-size: 14px;border-radius: 3px;margin-right:5px;padding-right:5px;"><div style="position: absolute;top: 0px;left: 0px;z-index: 20;width: 100%;height: 100%;color: #fff;">确定</div></li>
	</a>			
	</ul>
</div>
<!--sec02 end-->
<script language="javascript" src="http://webapi.amap.com/maps?v=1.3&key=caaa086bdf5666322fba3baf5a6a2c03"></script>
<script type="text/javascript" src="https://g.alicdn.com/ilw/ding/0.2.7/scripts/dingtalk.js" ></script>
	<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="./Tpl/Qyapp/Day/js/mobiscroll-1/js/mobiscroll.core.js"></script>
    <script src="./Tpl/Qyapp/Day/js/mobiscroll-1/js/mobiscroll.frame.js"></script>
    <script src="./Tpl/Qyapp/Day/js/mobiscroll-1/js/mobiscroll.scroller.js"></script>

    <script src="./Tpl/Qyapp/Day/js/mobiscroll-1/js/mobiscroll.util.datetime.js"></script>
    <script src="./Tpl/Qyapp/Day/js/mobiscroll-1/js/mobiscroll.datetimebase.js"></script>
    <script src="./Tpl/Qyapp/Day/js/mobiscroll-1/js/mobiscroll.datetime.js"></script>
    <script src="./Tpl/Qyapp/Day/js/mobiscroll-1/js/mobiscroll.select.js"></script>
    <script src="./Tpl/Qyapp/Day/js/mobiscroll-1/js/mobiscroll.frame.ios.js"></script>
    <script src="./Tpl/Qyapp/Day/js/mobiscroll-1/js/mobiscroll.frame.jqm.js"></script>
    <script src="./Tpl/Qyapp/Day/js/mobiscroll-1/js/i18n/mobiscroll.i18n.zh.js"></script>

    <link href="./Tpl/Qyapp/Day/js/mobiscroll-1/css/mobiscroll.animation.css" rel="stylesheet" type="text/css" />
    <link href="./Tpl/Qyapp/Day/js/mobiscroll-1/css/mobiscroll.icons.css" rel="stylesheet" type="text/css" />
    <link href="./Tpl/Qyapp/Day/js/mobiscroll-1/css/mobiscroll.frame.css" rel="stylesheet" type="text/css" />
    <link href="./Tpl/Qyapp/Day/js/mobiscroll-1/css/mobiscroll.frame.ios.css" rel="stylesheet" type="text/css" />
    <link href="./Tpl/Qyapp/Day/js/mobiscroll-1/css/mobiscroll.frame.jqm.css" rel="stylesheet" type="text/css" />
    <link href="./Tpl/Qyapp/Day/js/mobiscroll-1/css/mobiscroll.scroller.css" rel="stylesheet" type="text/css" />
    <link href="./Tpl/Qyapp/Day/js/mobiscroll-1/css/mobiscroll.scroller.ios.css" rel="stylesheet" type="text/css" />
    <link href="./Tpl/Qyapp/Day/js/mobiscroll-1/css/mobiscroll.scroller.jqm.css" rel="stylesheet" type="text/css" />
<script>
var mapObj;
var result;
var marker = [];
var windowsArr = [];
function mapInit () {
    mapObj = new AMap.Map('iCenter');    //默认定位：初始化加载地图时，center及level属性缺省，地图默认显示用户所在城市范围
};
var MGeocoder;
var key_11;
var key_12;
var key_2;

function geocoder2() {  //POI搜索，关键字查询

	key_11 = document.getElementById("longitude").value;
	key_12 = document.getElementById("latitude").value;;
	//var pic = $('#pic').val();
	//var vakey_11 = $('#longitude').val();
	//var	key_12 = $('#latitude').val();	
	if(key_11 == 'undefined'|| key_12 == 'undefined'){
		alert('获取地理位置失败');return;
	}
	var lnglatXY = new AMap.LngLat(key_11,key_12);
	//alert(lnglatXY);
	//document.getElementById('result').innerHTML = "您输入的是：" + key_1;
	//加载地理编码插件
    mapObj.plugin(["AMap.Geocoder"], function() {  		
        MGeocoder = new AMap.Geocoder({
            radius: 1000,
            extensions: "all"
        });
        //返回地理编码结果
        AMap.event.addListener(MGeocoder, "complete", geocoder_CallBack2);
        //逆地理编码
        MGeocoder.getAddress(lnglatXY);
    });
	//加点
    var marker = new AMap.Marker({
        map:mapObj,
        icon: new AMap.Icon({
            image: "http://api.amap.com/Public/images/js/mark.png",
            size:new AMap.Size(58,30),
            imageOffset: new AMap.Pixel(-32, -0)
        }),
        position: lnglatXY,
        offset: new AMap.Pixel(-5,-30)
    });
    mapObj.setFitView();
}
function geocoder_CallBack2(data) { //回调函数
    var resultStr = "";
    var roadinfo ="";
    var poiinfo="";
    var address;
    //返回地址描述
    address = data.regeocode.formattedAddress;
	//document.getElementById('place').innerHTML = address;
    //document.getElementById('place').value = address;
	//postSubmit01();
} 
function postSubmit(){
	dd.ready(function(){
		dd.device.geolocation.get({	
			onSuccess : function(result) {
			
				/*android2.1及之前版本返回的数据会多嵌套一层location,2.2版本会改成和ios一致，请注意，建议对返回的数据先判断存在location，做向后兼容处理  */
				/* 目前androidJSAPI返回的坐标是高德坐标，ios是标准坐标，如果服务端调用的是高德API，则需要多ios返回的经纬度做下处理，详细请见http://lbsbbs.amap.com/forum.php?mod=viewthread&tid=724&page=2 */
				/* 坐标转换API http://lbs.amap.com/api/javascript-api/example/p/1602-2/ */
				/*
				{
					longitude : Number,
					latitude : Number,
					accuracy : Number,
				}
				*/
				var longitude = result['longitude'];
				var latitude = result['latitude'];
				var accuracy = result['accuracy'];
				document.getElementById('longitude').value = longitude;
				document.getElementById('latitude').value = latitude;
				//alert(longitude);
				//alert(latitude);
				geocoder2();
				
			},
			
		});
	});
}
</script>
<script type="text/javascript">
 $(function(){
	tab();
	mapInit();
	postSubmit();
	dataget();
 });
 function dataget(){
	type = document.getElementById('type1').value;
	//alert(type);
	$.ajax({
		type: "post",  
		url:"{lanrain::U('wap_log_add_ajax',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id']))}",
		dataType:'json',
		data:{'type':type},
		success:function(json){
			if(json.status == 1){
				var list1 = json.daywork;
				var daywork1 = '';
				var daywork2 = '';
				for(var i=0;i<list1.length;i++){
					daywork1 += '    ' + list1[i] + ';'+ '\n';
				}
				var list2 = json.needwork;
				for(var i=0;i<list2.length;i++){
					daywork2 += '    ' + list2[i] + ';'+ '\n';
				}
				//alert(daywork1);
				var work = '已完成:' + '\n' +   daywork1 + '\n' + '未完成:' + '\n' +  daywork2 ; 
				document.getElementById('daywork').value = work;
			}
		}
	});
 }
 function tab(){
	alertsuccess('您选择的是日报');
	var $li = $('#tab li');
	var $ul = $('#content ul');
	$('#tab').each(function(){
	  $("#tab li").removeClass("li-active-status");
	  $(this).children(':first').addClass('li-active-status');
	}) 	
	$li.click(function(){
		var $this = $(this);
		var t = $this.index();
		if(t == 0){
			alertsuccess('您选择的是日报');
			document.getElementById('type1').value = '日报';
		}
		if(t == 1){
			alertsuccess('您选择的是周报');
			document.getElementById('type1').value = '周报';
		}
		if(t == 2){
			alertsuccess('您选择的是月报');
			document.getElementById('type1').value = '月报';
		}
		dataget();
		$li.removeClass();
		$li.addClass('li-status');
		$this.addClass('li-active-status');
		$ul.css('display','none');
		$ul.eq($t).css('display','block');
		
	})
}
</script>
<style>
.item-span{font-size: 16px;font-family: microsoft yahei;height: 45px;line-height: 45px;color: #444;}
#add-con{color: #535353;font-size: 14px;font-family: "arial","微软雅黑";background: #fff;width: 100%;overflow: hidden;width: 100%;min-height: 100%;background: #e5e5e5;position: absolute;top: 0;left: 0;z-index: 999;overflow-x: hidden;overflow-y: auto;padding-bottom: 20px;}
.address-content{color: #535353;font-size: 14px;font-family: "arial","微软雅黑";background: #fff;width: 100%;overflow: hidden;width: 100%;min-height: 100%;background: #e5e5e5;position: absolute;top: 0;left: 0;z-index: 999;overflow-x: hidden;overflow-y: auto;padding-bottom: 20px;}
.letter{font-size:16px;height:24px;width:16%;float:left;background-color:#fff;margin:1px;padding:12px 0px 10px 0px;text-align:center;}
.img-status{display:none;}
.bg-circle{float:left;width:40px; border-radius:50%;height:40px; line-height:40px;margin-right:3px;margin-bottom:6px;overflow:hidden;}
.bg-circle-a{float:left;width:40px;height:40px; line-height:40px;margin-right:3px;margin-bottom:6px;overflow:hidden;}
.bg-text{height:40px; line-height:40px; display:block; color:#FFF; text-align:center;font-size:12px;}
</style>
<script>
var num = 1;
var opt = {
	theme: 'ios',     // Specify theme like: theme: 'ios' or omit setting to use default 
	mode: 'mixed',       // Specify scroller mode like: mode: 'mixed' or omit setting to use default 
	display: 'bottom', // Specify display mode like: display: 'bottom' or omit setting to use default 
	lang: 'zh'        // Specify language like: lang: 'pl' or omit setting to use default
};
</script>
<script>
$('#submit').on('click',function(){
	//alert('sss');
	var daywork = $('#daywork').val();
	var needwork = $('#needwork').val();
	if(daywork == "" && needwork == ""){
		alerterror('至少需要填写一项');
		return false;
	}
	address('2','helper1','n');
	//submitdata();
	//$('#myform').submit();
});

function submitdata(menbers){
	var daywork = $('#daywork').val();
	var type = $('#type1').val();
	var needwork = $('#needwork').val();
	var token = $('#token').val();
	var wecha_id = $('#wecha_id').val();
	
	var subdata = 'token='+token+'&wecha_id='+wecha_id+'&daywork='+ daywork + '&needwork='+ needwork+ '&type='+ type+ '&menbers='+ menbers;
	//alert(subdata);return false;
	$.ajax({
		type: "post",  
		url:"{lanrain::U('wap_log_ajax')}",
		dataType:'json',
		data:subdata,
		success:function(json){
		    var errcode = json.errcode;
			var id = json.id;
			if(errcode == '-1'){
				alert('发送失败');
				
			}else{
			    alert("发送成功");
				window.location.href="index.php?g=Qyapp&m=Day&a=wap_log&token="+token+"&wecha_id="+wecha_id+"&id="+id;
			}
		},
		error:function(){
			window.location.href="index.php?g=Qyapp&m=Day&a=wap_log&token="+token+"&wecha_id="+wecha_id;
		}
	});
}
function alertsuccess(msg){
	dd.ready(function(){
		dd.device.notification.toast({
			icon: 'success', //icon样式，有success和error，默认为空 0.0.2
			text: msg, //提示信息
			duration: '2', //显示持续时间，单位秒，默认按系统规范[android只有两种(<=2s >2s)]
			delay: '0', //延迟显示，单位秒，默认0
			onSuccess : function(result) {
				/*{}*/
			},
			onFail : function(err) {}
		})
	});
}
function alerterror(msg){
	dd.ready(function(){
		dd.device.notification.toast({
			icon: 'error', //icon样式，有success和error，默认为空 0.0.2
			text: msg, //提示信息
			duration: '2', //显示持续时间，单位秒，默认按系统规范[android只有两种(<=2s >2s)]
			delay: '0', //延迟显示，单位秒，默认0
			onSuccess : function(result) {
				/*{}*/
			},
			onFail : function(err) {}
		})
	});
}
</script>
<script>
$('#tab_0').show();
$('#top-menu li:first-child').css('border-bottom','3px solid red');

$('#top-menu li').each(function(){
    $(this).click(function(){
	    $('#top-menu li').css('border-bottom','none');
		$(this).css('border-bottom','3px solid red');	
	    var index = $(this).index();
		if(index == 0){
		    $('#letter').hide();		
		    $('#tab_0').show();
			$('#tab_1').hide();
		    $('#tab_2').hide();
		    $('#tab_3').hide();			
		}else if(index == 1){
		    $('#letter').hide();		
		    $('#tab_0').hide();		
		    $('#tab_1').show();
			$('#tab_2').hide();
		    $('#tab_3').hide();	
            $('div.userletter').show();				
		}else if(index == 2){
		    $('#letter').hide();		
		    $('#tab_0').hide();		
		    $('#tab_1').hide();
			$('#tab_2').show();
		    $('#tab_3').hide();
		}else if(index == 3){
		    $('#letter').show();
		    $('#tab_0').hide();		
		    $('#tab_1').show();
		    $('#tab_2').hide();			
		}
	});
});
function find(letter){
    $('#letter').hide();
    var letter = letter.toLowerCase();
    $('div.userletter').hide();
	$('#'+letter).show();
}
$('.add-user').click(function(){
    if($(this).find('.img-status').is(':visible')){
	    $(this).find('.img-status').hide();
	}else{
	    $(this).find('.img-status').show();
	}
});
function address(type,id,num){
    $('#queding').attr('data-id',id);
	$('#queding').attr('data-num',num);
	var selected = $('#'+id).attr('value');
	var url = "index.php?g=Qyapp&m=Common&a=wap_address&token={lanrain::$_GET['token']}&wecha_id={lanrain::$_GET['wecha_id']}&type="+type+"&sign="+id+"&selected="+selected;
	$.ajax({
		type: "GET",
		cache: false,
		url: url,
		dataType: "html",
		success: function (res) {
			$('body').append(res);
		},
		error: function (xhr, ajaxOptions, thrownError) {
		
		}
	});	
    $('#address-btn').show();	
}
function fanhui(){
	$('.address-content').hide();
	$('#address-btn').hide();
}

function queding(){
	var id = $('#queding').attr('data-id');
    var num = $('#queding').attr('data-num');	
	$('#list-'+id+' div.bg-circle').remove();
	var dept_id = '';
	var dept_name = '';
	var users_id = '';
	var users_name = '';
	$('#selected-users li').each(function(){
		var id_2 = $(this).attr('id');
		var str_2 = id_2.replace('selected-users-','');		
		var users_name = $('#selected-users-name-'+str_2).text();
		var deptcolor = getColor();		
		$('#add-'+id).before('<div class="bg-circle" style="background:'+deptcolor+';" id="my-users-'+str_2+'"><span class="bg-text">'+users_name+'</span></div>');	
		//users_id += str_2+',';
		users_id += id_2+',';
	});	
	submitdata(users_id);
	return false;
	//$('#'+id).attr('value',users_id);
	//$('#address-'+id).remove();
	//$('#address-btn').hide();
	
	
}
function getColor(){
	var mycolor=new Array("#008cee","#38adff","#ff4141","#858e99","#929292","#5ec9f6","#78c06e","#f65e8d","#f6bf26","#3bc2b5","#5c6bc0","#f65e5e","#5e97f6","#9a89b9","#bd84cd","#6bb5ce");
	var ran = Math.random();
	var len =mycolor.length;
	var ar =ran*len;
	var rancolor = Math.floor(ar);
	var color = mycolor[rancolor];
    return color;	
}
</script>
<!--rili start-->
<div id="datePlugin"></div>

<!--rili end-->
<!--js start-->
 <script type="text/javascript" src="./Tpl/Qyapp/Day/js/jquery.js" ></script> 
<!-- <script type="text/javascript" src="./Tpl/Qyapp/Day/js/date.js" ></script> -->
<!-- <script type="text/javascript" src="./Tpl/Qyapp/Day/js/iscroll.js" ></script> -->
<!-- <script src="./Tpl/Qyapp/Day/js/main.js"></script> -->
<!-- <script type="text/javascript">
    $(function(){
        $('#beginTime').date();
    });
</script> -->
<!-- <script type="text/javascript">
    $(".sel_wrap").on("change", function() {
        var o;
        var opt = $(this).find('option');
        opt.each(function(i) {
            if (opt[i].selected == true) {
                o = opt[i].innerHTML;
            }
        })
        $(this).find('label').html(o);
    }).trigger('change');
</script> -->
</body>
</html>